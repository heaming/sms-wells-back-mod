<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.contract.ordermgmt.mapper.WctaOrderDetailMngtMapper">
    <select id="selectOrderDetailRentalPages" resultType="com.kyowon.sms.wells.web.contract.ordermgmt.dvo.WctaOrderDetailRentalPagesDvo">
WITH T11 AS (
        /* 화면 필수 기준으로 대상 조회 */
                      SELECT /*+ MATERIALIZE */
                      		 --T11.*
                              T11.CNTR_NO
                            , T11.CNTR_SN
                            , T11.BASE_PD_CD
                            , T11.PD_QTY
                            , T11.CNTR_DTL_STAT_CD
                            , T11.CNTRW_TP_CD
                            , T11.FRISU_YN
                            , T11.RSTL_YN
                            , T11.SV_PRD
                            , T11.SELL_DSC_DV_CD
                            , T11.CNTR_AMT
                            , T11.FNL_AMT
                            , T11.FST_RGST_DTM
                            , T11.PD_GD_CD
                            , T11.FST_RGST_USR_ID
                            , T11.FST_RGST_PRG_ID
                            , T11.CTT_RS_CD
                            , T11.ALNCMP_CD
                            , T11.ALNCMP_CNTR_DRM_VAL
                            , T11.SELL_DSC_TP_CD
                            , T11.FEE_FXAM_YN
                            , T11.FEE_ACKMT_BASE_AMT
                            , T11.ACKMT_PERF_RT
                            , T11.ACKMT_PERF_AMT
                            , T11.BOO_SELL_TP_CD
                            , T11.DSC_AMT
                            , T11.CNTRAM_DSC_AMT
                            , T11.CNTR_PD_ENDDT
                            , T11.STPL_PTRM
                            , T11.STPL_PTRM_UNIT_CD
                            , T11.CNTR_PTRM
                            , T11.CNTR_PD_STRTDT
                            , T11.SPP_DUEDT
                            , T11.SELL_TP_CD
                            , T10.CNTR_CST_NO
                            , T12.IST_DT
                            , T12.REQD_DT
                            --, T12.RECAP_DUTY_PTRM_N
                            , T11.STPL_PTRM AS RECAP_DUTY_PTRM_N
                            , T12.SELL_EV_CD
                            , T12.FRISU_BFSVC_PTRM_N
                            , T12.IST_AK_ARTC_MO_CN
                            , T12.SCON_CN
                            , T12.USE_ELECT_TP_CD
                            , T12.PRM_APY_DV_CD
                            , T12.WPRS_ITST_TP_CD
                            , T12.WTQLTY_TST_YN
                            , T12.WRFR_IST_MTH_CD
                            , T12.FRISU_RCVRY_TP_CD
                            , T12.SRCWT_TP_CD
                            --, T13.HIST_STRT_DTM
                            , (CASE WHEN T11.CNTR_DTL_STAT_CD IN ('301','302','303')  /* '301' : 고객요청해약,'302' : 연체해약, '303' : 계약취소*/
                                    THEN T11.CNTR_PD_ENDDT
                                    ELSE '' END) AS CAN_DT
		                    , T43.VST_RQDT                                                                                   /* 방문요청일자 - 의뢰일자(LCTRUT,LCTRUY) */
		                    , F_CMZ_CD_NM('TNT_WELLS', 'SPP_MTHD_TP_CD' ,T43.SPP_MTHD_TP_CD) AS SPP_MTHD_TP_NM               /* 배송방식유형코드 - 의뢰구분(LCTGUB, LCTGUB_NM) */
		                    , T44.RCGVP_KNM                                        /* 수령자한글명 - 설치처정보 - 설치자　명(LCWNAM)*/
		                    , T44.CRAL_LOCARA_TNO   AS IST_CRAL_LOCARA_TNO          /* 설치자 - 휴대전화번호1 */
		                    , T44.MEXNO_ENCR        AS IST_MEXNO_ENCR               /* 설치자 - 휴대전화번호2 */
		                    , T44.CRAL_IDV_TNO      AS IST_CRAL_IDV_TNO             /* 설치자 - 휴대전화번호3 */
		                    , T44.CRAL_LOCARA_TNO || '-' || T44.MEXNO_ENCR || '-' || T44.CRAL_IDV_TNO  AS IST_CRAL_TNO /* 설치자 - 휴대전화번호(파라미터) */
		                    , T45.NEW_ADR_ZIP      AS IST_ADR_ZIP                  /* 설치처정보 - 우편번호 : LCWZIP */
		                    , T45.RNADR            AS IST_RNADR                    /* 설치처정보 - 기준주소 : LCWAD1 + LCWAD2 +LCWAD3 */
		                    , T45.RDADR            AS IST_RDADR                    /* 설치처정보 - 상세주소 : LCWAD1 + LCWAD2 +LCWAD3 */
                            , T50.SL_RCOG_DT
                            , T50.RENTAL_TN
                            , T50.RENTAL_PTRM
                            , T50.RENTAL_PTRM2
                        FROM TB_SSCT_CNTR_BAS T10                  /* T.계약기본 */
                       INNER JOIN TB_SSCT_CNTR_DTL T11             /* T.계약상세 */
                          ON T11.CNTR_NO = T10.CNTR_NO              /* 계약번호 */
                         AND T11.SELL_TP_CD IN ('2')   /* 판매유형코드 : 할부,렌탈,멤버십,정기배송*/
                         AND T11.DTA_DL_YN = 'N'
                         AND T10.DTA_DL_YN = 'N'
                      LEFT OUTER JOIN TB_SSCT_CNTR_WELLS_DTL T12  /* T.WELLS상세 */
                        ON T12.CNTR_NO = T11.CNTR_NO              /*계약번호  */
                       AND T12.CNTR_SN = T11.CNTR_SN              /*계약번호  */
                       AND T12.DTA_DL_YN = 'N'
	                  LEFT OUTER JOIN TB_SSCT_CNTR_ADR_REL T43      /* T.계약주소관계 - 설치 */
	                    ON T43.DTL_CNTR_NO = T11.CNTR_NO
	                   AND T43.DTL_CNTR_SN = T11.CNTR_SN
	                   AND T43.ADRPC_TP_CD = '3'                    /* 주소지유형코드 : 설치처(3) */
	                   AND T43.VL_END_DTM = '99991231235959'        /* 유효종료일시 */
	                   AND T43.DTA_DL_YN = 'N'
	                   --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T43.DTL_CNTR_NO AND T11.CNTR_SN = T43.DTL_CNTR_SN)
	                  LEFT OUTER JOIN TB_SSCT_CNTR_ADRPC_BAS T44    /* T.계약주소지기본 - 설치 */
	                    ON T44.CNTR_ADRPC_ID = T43.CNTR_ADRPC_ID
	                   AND T44.DTA_DL_YN = 'N'
	                  LEFT OUTER JOIN TB_GBCO_ADR_BAS T45           /* T.주소기본 - 설치 */
	                    ON T45.ADR_ID = T44.ADR_ID
	                   AND T45.DTA_DL_YN = 'N'
                      LEFT OUTER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T50  /* WELLS매출월마감내역 */
                        ON T50.SL_CL_YM = TO_CHAR(SYSDATE, 'YYYYMM')    /* 매출마감년월 */
                       AND T50.CNTR_NO = T11.CNTR_NO
                       AND T50.CNTR_SN = T11.CNTR_SN
                       AND T50.DTA_DL_YN = 'N'
                       WHERE 1=1
                         AND T11.SELL_TP_CD IN ('2')   /* 판매유형코드 : 할부,렌탈,멤버십,정기배송*/
                    <if test="@MybatisUtils@isNotEmpty(prdEnqry)">
                        <choose>
                            <when test='@MybatisUtils@equals(prdEnqry, "1")'> /* 접수일 */
                                AND T10.CNTR_RCP_FSH_DTM BETWEEN #{strtDt}||'000000' AND #{endDt}||'235959'
                            </when>
                            <when test='@MybatisUtils@equals(prdEnqry, "2")'> /* 매출일 */
                                AND T50.SL_RCOG_DT BETWEEN #{strtDt} AND #{endDt}
                            </when>
                            <when test='@MybatisUtils@equals(prdEnqry, "3")'> /* 취소일 */
                                --AND T13.HIST_STRT_DTM BETWEEN #{strtDt}||'000000' AND #{endDt}||'235959'
                                AND (CASE WHEN T11.CNTR_DTL_STAT_CD IN ('301','302','303')  /* '301' : 고객요청해약,'302' : 연체해약, '303' : 계약취소*/
                                          THEN T11.CNTR_PD_ENDDT
                                          ELSE '' END) BETWEEN #{strtDt}||'000000' AND #{endDt}||'235959'
                            </when>
                            <when test='@MybatisUtils@equals(prdEnqry, "4")'> /* 설치일 */
                                AND T12.IST_DT BETWEEN #{strtDt} AND #{endDt}
                            </when>
                            <when test='@MybatisUtils@equals(prdEnqry, "5")'> /* 만료일 */
                                AND T12.IST_DT IS NOT NULL
                                AND (CASE WHEN 1 >= T11.CNTR_PTRM OR T11.CNTR_PTRM >= 999 THEN ''
                                          ELSE TO_CHAR(ADD_MONTHS(TO_DATE(T12.IST_DT,'YYYYMMDD'), T11.CNTR_PTRM) -1, 'YYYYMMDD')  /* 매출일(설치일) + 계약기간 -1 */
                                          END ) BETWEEN #{strtDt} AND #{endDt}
                                -- 상품시작일자 / 설치일자와 값이 달라서 설치일자 맵핑으로 표시되어 설치일자로 수정
                                --          AND (CASE WHEN 1 >= T11.CNTR_PTRM OR T11.CNTR_PTRM >= 999 THEN ''
                                --                    ELSE TO_CHAR(ADD_MONTHS(TO_DATE(T11.CNTR_PD_STRTDT,'YYYYMMDD'), T11.CNTR_PTRM) -1, 'YYYYMMDD')  /* 매출일(상품시작일) + 계약기간 -1 */
                                --                    END ) BETWEEN #{strtDt} AND #{endDt}
                            </when>
                            <when test='@MybatisUtils@equals(prdEnqry, "6")'> /* 렌탈차월 */
                                AND T50.RENTAL_TN = #{rentalNmn}
                            </when>
                            <when test='@MybatisUtils@equals(prdEnqry, "7")'> /* 예정일 */
                                AND T11.SPP_DUEDT BETWEEN #{strtDt} AND #{endDt}
                            </when>
                        </choose>
                    </if>
                    <if test="@MybatisUtils@isNotEmpty(pdCd)">
                       AND T11.BASE_PD_CD LIKE '%' || #{pdCd} || '%'
                    </if>
                    <if test="@MybatisUtils@isNotEmpty(alncmpCd)">
                       AND T11.ALNCMP_CD = #{alncmpCd}
                    </if>
                    <if test="@MybatisUtils@isNotEmpty(sellEvCd)">
                       AND T12.SELL_EV_CD = #{sellEvCd}
                    </if>
                    <if test="@MybatisUtils@isNotEmpty(sellPrtnrNo)">
                       AND T10.SELL_PRTNR_NO = #{sellPrtnrNo}
                    </if>
                    <if test="@MybatisUtils@isNotEmpty(sellOgTpCd)">
                       AND T10.SELL_OG_TP_CD IN (
                        <foreach collection="sellOgTpCd" item="codeId" separator=",">
                               #{codeId}
                        </foreach>
                           )
                    </if>
                    <if test='@MybatisUtils@equals(booSellYn,"Y")'>
                       AND T11.BOO_SELL_TP_CD = '2'
                    </if>
                    <if test='@MybatisUtils@equals(canYn,"Y")'>
                       AND T11.CNTR_DTL_STAT_CD NOT IN ('302','303')
                    </if>
                    <if test='@MybatisUtils@equals(slYn,"Y")'>
                       AND T50.SL_RCOG_DT IS NOT NULL
                    </if>
                    <if test="@MybatisUtils@isNotEmpty(cntrNo)">
                       AND T11.CNTR_NO = #{cntrNo}
                    </if>
                    <if test="@MybatisUtils@isNotEmpty(cntrSn)">
                       AND T11.CNTR_SN = #{cntrSn}
                    </if>
                    <if test="@MybatisUtils@isNotEmpty(cntrCstNo)">
                       AND T10.CNTR_CST_NO = #{cntrCstNo}
                    </if>
                    <if test="@MybatisUtils@isNotEmpty(cralLocaraTno)">
                        AND T44.CRAL_LOCARA_TNO = #{cralLocaraTno}
                    </if>
                    <if test="@MybatisUtils@isNotEmpty(mexnoEncr)">
                        AND T44.MEXNO_ENCR = #{mexnoEncr}
                    </if>
                    <if test="@MybatisUtils@isNotEmpty(cralIdvTno)">
                        AND T44.CRAL_IDV_TNO = #{cralIdvTno}
                    </if>
                    <if test="@MybatisUtils@isNotEmpty(rcgvpKnm)">
                        AND T44.RCGVP_KNM LIKE '%'||#{rcgvpKnm}||'%'
                    </if>
        )
        , T85 AS (
        SELECT *
          FROM (SELECT /*+ MATERIALIZE USE_NL(T11 T850 T851) */
          			   ROWNUM AS ROW_NUM
                     , T851.PD_NM
                     , T850.FGPT_PD_CD
                     , T850.FGPT_QTY
                     , T850.DTL_CNTR_NO
                     , T850.DTL_CNTR_SN
                  FROM TB_SSCT_FGPT_RCP_IZ T850 /* 사은품접수내역 */
                 INNER JOIN T11
                    ON T850.DTL_CNTR_NO = T11.CNTR_NO
                   AND T850.DTL_CNTR_SN = T11.CNTR_SN
                   AND T850.DTA_DL_YN = 'N'
                  LEFT OUTER JOIN TB_PDBS_PD_BAS T851/* T.상품기본 -  */
                    ON T851.PD_CD = T850.FGPT_PD_CD    /* 상품코드 */
                   AND T851.TEMP_SAVE_YN = 'N'                /* 임시저장여부 */
                   AND T851.DTA_DL_YN = 'N'                   /* 데이터삭제여부 */
               )
          PIVOT (MAX(DTL_CNTR_NO) AS CNTR_NO
               , MAX(DTL_CNTR_SN) AS CNTR_SN
               , MAX(PD_NM)       AS PD_NM
               , MAX(FGPT_PD_CD)  AS PD_CD
               , MAX(FGPT_QTY)    AS QTY
             FOR ROW_NUM IN (1 AS FGPT_1, 2 AS FGPT_2, 3 AS FGPT_3, 4 AS FGPT_4, 5 AS FGPT_5))
        )
                SELECT /*+ USE_NL(T11 T10 T15 T20 T21 T22 T23 T30 T32 T34 T40 T41 T48 T51 T65 T70 T71 T72 T73 T74 T75 T76 T79 T90 T81 T83 T85 T86)
                          INDEX(T51) NO_MERGE(T71) NO_MERGE(T79) NO_MERGE(T90) NO_MERGE(T81) NO_MERGE(T83) */
                       T11.CNTR_NO  /* 계약번호 */
                     , T11.CNTR_SN  /* 계약번호 일련번호 */
                     , CONCAT(CONCAT(T11.CNTR_NO, '-'), T11.CNTR_SN) AS CNTR_DTL_NO /* 계약번호 - 계약일련번호 [계약상세번호] */
                     , T11.SELL_TP_CD                        /* 판매유형코드 */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'SELL_TP_DTL_CD', T20.SELL_TP_DTL_CD ) FROM DUAL) AS SELL_TP_DTL_NM /* 판매유형 */
                     , CASE WHEN T32.OG_LEVL_DV_CD = 2 THEN T32.DGR2_LEVL_DG_PRTNR_NO
                            WHEN T32.OG_LEVL_DV_CD = 1 THEN T32.DGR1_LEVL_DG_PRTNR_NO
                            ELSE T32.DGR3_LEVL_DG_PRTNR_NO END AS DGR3_LEVL_DG_PRTNR_NO /* 지점장사번(LCDBON) - 지점장ID  */
                     , CASE WHEN T32.OG_LEVL_DV_CD = 2 THEN T32.DGR2_LEVL_DG_PRTNR_NM
                            WHEN T32.OG_LEVL_DV_CD = 1 THEN T32.DGR1_LEVL_DG_PRTNR_NM
                            ELSE T32.DGR3_LEVL_DG_PRTNR_NM END AS DGR3_LEVL_DG_PRTNR_NM /* 지점장명(AKDBNM) */
                     , CASE WHEN T32.OG_LEVL_DV_CD = 2 THEN T32.DGR2_LEVL_OG_CD
                            WHEN T32.OG_LEVL_DV_CD = 1 THEN T32.DGR1_LEVL_OG_CD
                            ELSE T32.DGR3_LEVL_OG_CD END AS DGR3_LEVL_OG_CD             /* 지점코드(LCDDPT)  조직코드*/
                     , T30.OG_CD            /* 조직코드(판매자의조직코드) */
                     , T10.SELL_PRTNR_NO    /* 판매자사번 (LCDCDE) */
                     , T30.PRTNR_KNM        /* 판매자명(AKDNAM) */
                     , T40.CRAL_LOCARA_TNO  /* 판매자-휴대지역전화번호 (AKDBTL) */
                     , T40.MEXNO_ENCR       /* 판매자-휴대전화국번호암호화 (AKDBTL) */
                     , T40.CRAL_IDV_TNO     /* 판매자-휴대개별전화번호 (AKDBTL) */
                     , T40.CRAL_LOCARA_TNO || '-' || T40.MEXNO_ENCR || '-' || T40.CRAL_IDV_TNO  AS SELL_PRTNR_CRAL_TNO /* 판매자 - 휴대전화번호(파라미터) */
                     , T30.CNTR_DT          /* 판매자-계약일자 (업무개시일:AKDSTT) */
                     , T30.CLTN_DT          /* 판매자-해약일자 (업무해약일:AKDCAT) */
                     , T40.CST_KNM                                          /* 계약자정보 - 고객명(LCCNAM) */
                     , SUBSTR(T40.BRYY_MMDD, 3, 2) AS BRYY                  /* 생년월일 - 고객생년（ＹＹ）(LCICD1) */
                     , CASE WHEN T40.COPN_DV_CD = '2' THEN T40.BZRNO ELSE '' END AS BZRNO   /* 계약자정보 - 사업자번호(LCCINO) */
                     , NVL((SELECT F_CMZ_CD_NM('TNT_WELLS', 'SEX_DV_CD', T40.SEX_DV_CD) FROM DUAL), T40.SEX_DV_CD) AS SEX_DV_NM /* 계약자정보 - 성별(LCCSEX) */
                     , T10.CNTR_CST_NO                                      /* 계약자정보 - 고객번호(교원키:LCKKEY) */
                     , T41.NEW_ADR_ZIP AS ADR_ZIP                           /* 계약자정보 - 우편번호 : LCCZIP */
                     , T41.RNADR  AS CNTR_CST_RNADR                         /* 계약자정보 - 기준주소 : LCCAD1*/
                     , T41.RDADR  AS CNTR_CST_RDADR                         /* 계약자정보 - 상세주소 : LCCAD1*/
                     , T11.RCGVP_KNM
                     , T11.IST_CRAL_TNO
                     , T11.IST_CRAL_LOCARA_TNO
                     , T11.IST_MEXNO_ENCR
                     , T11.IST_CRAL_IDV_TNO
                     , T11.IST_ADR_ZIP
                     , T11.IST_RNADR
                     , T11.IST_RDADR
                     --, T46.SPP_ORD_NO                                       /* 설치처정보 - 운송장번호 : WBLNUM */
                     , ''  AS SPP_ORD_NO                                    /* 설치처정보 - 운송장번호 : WBLNUM - 물류서비스에서 받아야함 */
                     , (SELECT /*+ NO_UNNEST INDEX(TB_SSSO_PDCT_IDNO_OSTR_IZ PK_SSSO_PDCT_IDNO_OSTR_IZ) */
                              MAX(PDCT_IDNO) KEEP(DENSE_RANK FIRST ORDER BY OSTR_SN DESC)
                         FROM TB_SSSO_PDCT_IDNO_OSTR_IZ  /* T.제품고유번호출고내역 */
                        WHERE 1=1
                          AND CNTR_NO = T11.CNTR_NO              /*계약번호  */
                          AND CNTR_SN = T11.CNTR_SN              /*계약번호  */
                          AND DTA_DL_YN = 'N') AS PDCT_IDNO     /* 제품고유번호설치처정보 - SN번호 LCSRN1, LCSRNO */
                     , T11.IST_DT AS IST_AK_DT                               /* 설치요청일 - 설치일(LCSETY, LCSLRT) - ASIS에서 설치요청=설치일 */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'SELL_CHNL_DTL_CD', T10.SELL_INFLW_CHNL_DTL_CD) FROM DUAL) AS SELL_INFLW_CHNL_DTL_NM /* 판매유입채널상세코드 - 판매구분(LCSALE) */
                     , T10.COPN_DV_CD /* 법인격구분코드(계약자 고객구분 ) 1:개인, 2:법인 */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'COPN_DV_CD', T10.COPN_DV_CD) FROM DUAL) AS COPN_DV_NM /* 법인격구분코드 - 고객구분(LCCGUB) */
                     , T22.PD_CLSF_NM || ' > ' ||T21.PD_CLSF_NM AS PD_CLSF_NM   /* 대분류 + 중분류 - 상품분류명 (상품유형:KAETC1 + KAETC2)*/
                     , T11.BASE_PD_CD AS BASE_PD_CD                             /* 상품코드 (LCICDE) */
                     , T20.PD_NM                                                /* 상품명 (LCINAM) */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'PD_TP_CD', T22.PD_TP_CD ) FROM DUAL) AS PD_TP_NM    /* 상품유형 */
                     , T11.SV_PRD                                               /* 서비스주기 (주기:LCIMON)*/
                     --, T23.PD_PRP_VAL02  AS SV_VST_PRD_CD                     /* 방문주기 (LCVMON) */     TOBE에서는 미사용
                     , T20.SV_PD_TP_CD  AS SV_TP_CD                            /* 서비스유형(TOBE) (용도구분:LCIUSE) */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'SV_TP_CD', T20.SV_PD_TP_CD ) FROM DUAL) AS SV_TP_NM     /* 용도구분 - 상품의 서비스유형 (용도구분명:LCIUSE_NM, LCIUSE) */
                     , SUBSTR(T10.CNTR_RCP_FSH_DTM, 0, 8) AS CNTR_RCP_FSH_DT    /* 계약접수완료일시(접수일:LCCRTT.LCCRTY) */
                     , T11.SPP_DUEDT                                            /* 배송예정일자   (예정일:LCDEMT.LCDEMY) */
                     , T11.IST_DT                                               /* 설치일자     (설치일:LCSETT.LCSETY) */
                     , T11.CNTR_PD_STRTDT AS SL_DT                              /* 매출일자 (매출일:LCSLET.LCSLEY) */
                     , T11.CNTR_PTRM                                            /* 할부개월수 (계약기간:LCMONT)  TODO.20230614 : 항목변경 검토 */
                     , T11.CNTR_PD_ENDDT                                        /* 계약상품종료일자 (만료일:LCMANT.LCMANY)*/
                     --, SUBSTR(T11.HIST_STRT_DTM, 0, 8) AS CAN_DT                /* 취소일(LCCANT.LCCANY, LCCANT) */
                     , T11.CAN_DT AS CAN_DT                                     /* 취소일(LCCANT.LCCANY, LCCANT) */
                     , T11.REQD_DT                                              /* 철거일 (LCCANT.LCREMY, LCREMT) */
                     , CASE WHEN T11.REQD_DT IS NOT NULL  AND T11.SL_RCOG_DT IS NOT NULL
                             AND (T11.REQD_DT   >   (CASE WHEN T11.STPL_PTRM_UNIT_CD = '20' /* 약정기간단위코드:월  -- WELL는 월만 */
                                                      THEN TO_CHAR(ADD_MONTHS(TO_DATE(T11.SL_RCOG_DT, 'YYYYMMDD'), T11.STPL_PTRM),'YYYYMMDD')
                                                      ELSE '' END))
                            THEN SUBSTR(T11.CNTR_PD_ENDDT, 0, 8)
                            ELSE '' END AS EXN_REQD_DT                          /* 회수일 (만료철거일:LCENDT.LCENDY) TODO없음 --> '철거일' 이 만료일(설치일+약정기간) 이후인 경우 종료일로 대체 (https://kyowon.atlassian.net/wiki/spaces/ForKUS/pages/95420433)*/
                     , T11.RECAP_DUTY_PTRM_N                                    /* 유상의무기간수 (의무기간:LCGUB3)*/
                     , T11.CNTR_AMT                                             /* 계약금액 (등록비:LCTAMT) 표기1 */
                     , T11.CNTRAM_DSC_AMT AS CNTR_CTR_AMT                       /* 계약금할인금액 (등록할인:LCRAMT)*/
                     , T11.FNL_AMT AS RENTAL_AMT1                               /* 렌탈료-상품기준금액 (렌탈료１:LCAMT1)  TODO.20230614 : 항목변경 검토(RENTAL_AMT1) */
                     , 0 AS RENTAL_DSC_AMT1                                     /* 렌탈료-할인 조정값 (렌탈할인１:LCRAM1) TODO 할인에 대한 정의가 상품에 없음 TODO.20230614 : 항목변경 검토(RENTAL_DSC_AMT1)*/
                     , 0 AS RENTAL_AMT2                                         /* 렌탈료2-렌탈금액(매출) (렌탈료１:LCAMT2) - 가격최종상세 에서 가져오거나 비거나*/
                     , 0 AS RENTAL_DSC_AMT2                                     /* 렌탈할인금액2 (렌탈할인１:LCRAM2)*/
                     , T11.DSC_AMT AS RENTAL_DSC_DFAM                           /* 헨탈할인차액 (할인차액:LCRAM5) - 가격최종상세 에서 할인 가져온 다음 처리  정상렌탈료할인차액 (렌탈로 - 렌탈할인 계산아님 )*/
                     , CASE WHEN T11.BOO_SELL_TP_CD = '2' THEN 'Y'
                            ELSE 'N' END AS BOO_SELL_YN                         /* 예약판매유형코드 예약(LCCHK2) - 상품예약(1), 배송예약(2), 배송예약인경우 예약으로 표시함.*/
                     , CASE WHEN T70.MCHN_CH_SN IS NOT NULL THEN 'Y' ELSE 'N' END AS MCHN_CH_YN   /* 기변여부/기기변경여부 (기변:LCETC7) */
                     , T70.MCHN_CPS_APYR                                        /* 기기보상적용율 (기변실적율:LCRATE)*/
                     , T11.ACKMT_PERF_AMT                                       /* 인정실적금액 (인정실적액:LCPAMT)*/
                     , T11.ACKMT_PERF_RT                                        /* 인정실적율 (인정실적율:LCPRAT)*/
                     , T51.ACKMT_PERF_CT                                        /* 인정건수 */
                     , T11.FEE_ACKMT_BASE_AMT                                   /* 수수료인정기준금액 (수수료기준금액:LCGUB5)*/
                     , T11.FEE_FXAM_YN                                          /* 수수료정액여부 (수수료정액여부:LCST13)*/
                     , T11.SELL_DSC_DV_CD                                       /* 할인적용유형코드 (할인구분:LCETC3)*/
                     , T11.SELL_DSC_TP_CD                                       /* 할인적용상세코드 (할인유형:LCETC4)*/
                     , T71.PMOT_CD AS DSC_PMOT_CD                               /* 프로모션코드 (할인제도:LCFLG4)*/
                     , T70.MCHN_CH_TP_CD                                        /* 기기변경유형코드 기변유형(LCFLAG)*/
                     , T70.OJ_CNTR_NO ||'-'|| T70.OJ_CNTR_SN AS OJ_CNTR_DTL_NO /*대상계약번호 기변상대코드(LCYER2+LCCOD2 = LCSCDE)*/
                     , T72.BASE_PD_CD AS OJ_BASE_PD_CD                          /* 대상계약상품명 - 기변이전상품 (LCCICD) */
                     , T73.PD_NM AS OJ_PD_NM                                    /* 대상계약상품명 - 기변이전상품명 (LCCINA) */
                     , CASE WHEN T90.CNTR_NO IS NOT NULL AND T71.PMOT_CD = '03' /* 프로모션코드 : 1+1(03)*/
                            THEN T90.CNTR_NO ||'-'|| T90.CNTR_SN
                            ELSE '' END AS BOGO_CD                              /* １＋１연계코드 (ONPCOD) */
                     , T90.BASE_PD_CD   AS BOGO_PD_CD                           /* １＋１이전상품 (LCPICD) */
                     , T90.PD_NM        AS BOGO_PD_NM                           /* １＋１ １이전상품명 (LCPINA) */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'DP_TP_CD', T14.DP_TP_CD) FROM DUAL) AS MPY_MTHD_TP_NM /* 계좌정보-자동이체 : 납부방식유형코드 - 자동이체(LCCHK1) */
                     , CASE WHEN T14.DP_TP_CD = '0102' THEN T14.ACNO_ENCR  /* 계좌정보 */
                            WHEN T14.DP_TP_CD = '0203' THEN T14.CRCDNO_ENCR /* 카드자동이체 */
                            ELSE '' END AS AFTN_INF                                                     /* 계좌정보-카드／계좌번호(ACCNO)*/
                     , T14.OWR_KNM AS AFTN_OWR_KNM                                                      /* 계좌정보-예금／카드주명 (ACCNM) */
                     , T11.SELL_EV_CD                                                                   /* 판매행사코드 (행사코드:LCETC9)*/
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'SELL_EV_CD', T11.SELL_EV_CD) FROM DUAL) AS SELL_EV_NM             /* 판매행사명- 행사코드명(LCET9N) */
                     , T11.ALNCMP_CD                                                                    /* 제휴사코드 (제휴코드:LCETC8)*/
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'ALNCMP_CD', T11.ALNCMP_CD) FROM DUAL) AS ALNCMP_NM                /* 제휴코드명- 제휴코드명(LCET8N) */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'ALNC_STAT_TP_CD', T74.ALNC_STAT_TP_CD) FROM DUAL) AS ALNC_STAT_TP_NM /* 제휴상태유형코드- 제휴상태(LCET2N:LC3100P.LCETC2) TODO.확인필요 */
                     , T11.ALNCMP_CNTR_DRM_VAL   /* 제휴사계약식별값(LCCK11+LCCK12+LCCK13)*/
                       || CASE WHEN T11.ALNCMP_CD = '70' /*상조*/
                               THEN (SELECT BASE_DTL_CNTR_NO || BASE_DTL_CNTR_SN
                                       FROM TB_SSCT_CNTR_REL
                                      WHERE 1=1
                                       AND CNTR_REL_DTL_CD = '22L' /* 계약관계상세코드 : 플래너상조제휴22L) */
                                       AND OTSD_LK_DRM_VAL = T11.ALNCMP_CNTR_DRM_VAL /* 계약관계@외부연계식별값 = 계약기본@제휴사계약식별값*/
                                       AND DTA_DL_YN = 'N'
                                   )
                               ELSE '' END AS ALNCMP_CST_CD                                             /* 제휴고객코드 (제휴고객코드:LCCK11) TODO.확인필요*/
                     , T75.ALNC_PRTNR_DRM_VAL AS ALNCMP_PRTNR_NO                                        /* 제휴판매자(LCCK14) LC3100P.LCCK14 계약파트너관계@파트너번호 가 제휴파트너식별값 처리함 */
                     , T11.CTT_RS_CD                                                                    /* 컨택결과코드 (컨택코드:LCCCDE) */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'LC_CTT_RS_CD', T11.CTT_RS_CD) FROM DUAL) AS CTT_RS_NM             /* 컨택결과코드 (컨택내용:LCCCDE의 명칭:CWCCNM) */
                     , T11.FST_RGST_PRG_ID                                                              /* 최초등록프로그램ID (등록프로그램:LCEPGM)*/
                     , T11.FST_RGST_USR_ID                                                              /* 최초등록사용자ID (업무담당:LCECDE)*/
                     , (SELECT T33.USR_NM
                          FROM T_CMP_USR_ACO_M T33  /* T.사용자 */
                         WHERE 1=1
                           AND T33.USR_ID = T11.FST_RGST_USR_ID
                           AND T33.DEL_YN = 'N' ) AS FST_RGST_USR_NM                                        /* 등록자(LCECNM 업무담당명 AK0200P@AKNAME) */
                     , T81.FST_PERF_YM AS FST_PERF_YM                                                       /* 최초연체(LCSDAM) */
                     , T81.FNL_PERF_YM AS FNL_PERF_YM                                                       /* 최종연체(LCEDAM) */
                     , T83.FST_MNGT_YM AS FST_MNGT_YM                                                       /* 최초매출중지(LCSSTP) LC5000P@LCSTOP 맵핑없음 TODO 확인필요 > 매출문의중 */
                     , T83.FST_MNGT_YM AS FNL_MNGT_YM                                                       /* 최종매출중지(LCESTP) LC5000P@LCSTOP 맵핑없음 TODO 확인필요 > 매출문의중 */
                     , T71.PMOT_CD                                                                      /* TOBE 프로모션 - 프로모션번호 LCCK02 */
                     , T71.PMOT_FVR_MCN                                                                 /* TOBE 프로모션 - 할인개월 :: ASIS의 LC3100P.LCFLG8(프로모션_할인개월수) TODO 맵핑안됨 */
                     , T71.PMOT_FVR_AMT                                                                 /* TOBE 프로모션 - 할인금액 (프로모션혜택금액 인가'20230401' OR LC3100P.LCFLG9(프로모션_할인금액))*/
                     , T11.FRISU_BFSVC_PTRM_N                                                           /* 무상BS기간수 - TOBE 프로모션 - 무료개월 (LC3100P.LCMMON) */
                     --, '연계상품 조회' AS CONN_PD_VIEW  /* 연계상품 조회 */
                     , CASE WHEN T11.CNTR_DTL_STAT_CD = '303' THEN T11.PD_GD_CD
                            ELSE '' END AS CAN_PD_GD_CD                                                 /* 취소등급 : LC3250P@LCIGRD(렌탈취소@상품등급) 상품취소시 등급 맵핑없음으로 취소시 상품등급*/
                     , '' AS FRE_EXPN_YN                                                                   /* 무료체험여부 */
                     , '' AS FRE_EXPN_CNFM_STRTDT                                                       /* 무료체험시작일 (무료체험시작일:LCEXPT.LCEXPY)  TODO 맵핑없음 > 조PRO 확인중 */
                     , CASE WHEN T47.FRE_EXPN_PRGS_STAT_CD = '20' THEN 'Y' ELSE 'N' END AS FRE_EXPN_CNFM_YN     /*체험확정여부 (체험확정여부:LCFGUB)*/
                     , SUBSTR(T47.FRE_EXPN_CNFM_DTM, 0, 8)  AS FRE_EXPN_CNFM_DT                         /* 체험확정일 (체험확정일:LCFIXT.LCFIXY) TODO 맵핑문의*/
                     , NVL2(T76.CNTR_REL_DTL_CD,'결합','') AS COMBI_NM                                   /* 계약관계상세코드명 결합구분(LC3100P.LCST04) 정기배송/모종과의 결합여부  */
                     , SUBSTR(T11.FST_RGST_DTM, 0, 8)  AS FST_RGST_DT                                   /* 최초등록일 (주문등록일자:LC3100P.LCEYMD) */
                     , SUBSTR(T11.FST_RGST_DTM, 9,6)  AS FST_RGST_TM                                    /* 최초등록시 (주문등록일자:LC3100P.LCEHMS) */
                     , T86.Z11_YN                                                                       /* 정보수집　동의 : KW3100P@KWFLG1 */
                     , T86.Z13_YN                                                                       /* 마케팅동의　동의 : KW3100P@KWFLG3 */
                     , T86.Z15_YN                                                                       /* 제3자동의　동의 : KW3100P@KWFLG4 */
                     , T86.W22_YN                                                                       /* 피버 바이크 플러스 이용 동의 LC3490P.LCHGU4 */
                     , T40.CRAL_LOCARA_TNO AS CNTR_CRAL_LOCARA_TNO                                      /* 계약자　휴대폰번호1 LCCNOT. LCCNO1 */
                     , T40.MEXNO_ENCR AS CNTR_MEXNO_ENCR                                                /* 계약자　휴대폰번호2 LCCNOT. LCCNO2 */
                     , T40.CRAL_IDV_TNO AS CNTR_CRAL_IDV_TNO                                            /* 계약자　휴대폰번호3 LCCNOT. LCCNO3 */
                     , T40.CRAL_LOCARA_TNO || '-' || T40.MEXNO_ENCR || '-' || T40.CRAL_IDV_TNO  AS CNTR_CRAL_TNO /* 계약자 - 휴대전화번호(파라미터) */
                     , (SELECT CASE WHEN COUNT(1)   >   0 THEN 'Y' ELSE 'N'END
                          FROM TB_BCBC_FW_IMP_NO_IZ    /* 발송불가번호내역 */
                         WHERE 1=1
                           AND LOCARA_TNO = T40.CRAL_LOCARA_TNO   /* 지역전화번호*/
                           AND EXNO_ENCR = T40.MEXNO_ENCR         /* 전화국번호암호화*/
                           AND IDV_TNO = T40.CRAL_IDV_TNO         /* 개별전화번호*/
                           AND DTA_DL_YN = 'N'/* 데이터삭제여부 */
                       ) AS DNTC_YN                                                                     /*두낫콜　여부(발신제한여부) DNTCYN*/
                     , NVL2(T77.BASE_CNTR_NO, T77.BASE_CNTR_NO || '-' || T77.BASE_CNTR_SN
                        || '/' || T77.CNTR_PD_STRTDT || '/' || T77.MCHN_CH_TP_CD, '') AS BASE_CNTR_INFO      /* 기준 계약번호 (이후) + 매출일 + 기기변경유형코드 이후　기변정보(A_LC229_FLAG) */
                     , T77.PD_NM        AS BASE_PD_NM                                                   /* 이후　기변정보-제품명(LC22_KAINAM) */
                     , T77.RENTAL_AMT   AS BASE_RENTAL_AMT                                              /* 이후　기변정보-사용렌탈료(LC22_LCAMT) */
                     , T77.SV_PRD       AS BASE_SV_PRD                                                  /* 이후　기변정보-관리주기(LC22_LCIMON) */
                     , T78.STPL_DSC_AMT                                                                 /* 약정할인금액 - 재약정 가입 정보-할인금액(LC31_LCRAM3) */
                     , T78.STPL_STRTDT                                                                  /* 약정시작일자 - 재약정 가입 정보-시작일(LC44_LCSTDT) */
                     , SUBSTR(T78.STPL_CAN_DTM, 0, 8) AS STPL_CAN_DT                                    /* 약정취소일자 - 재약정 가입 정보-취소일자(LC44_LCCANT) */
                     , SUBSTR(T78.STPL_RCP_DTM, 0, 8) AS STPL_RCP_DT                                    /* 약정접수일자 - 재약정 가입 정보-접수일자(LC44_ACPG_DT) */
                     , T78.RENTAL_TN  AS STPL_RENTAL_TN                                                 /* 가입차월 - 재약정 가입 정보-재약정 가입차월(LC50_CNT) */
                     , SUBSTR(T79.CNTR_RCP_FSH_DTM,0 ,8)    AS MSH_CNTR_RCP_FSH_DT                      /* 계약접수완료일시-접수일  이후 멤버십정보 - 접수일 (A_L350_CRTT:A_L350.LCCRTY)*/
                     , SUBSTR(T79.CNTR_TEMP_SAVE_DTM,0 ,8)  AS MSH_CNTR_TEMP_SAVE_DT                    /* 계약임시저장일시-가입일  이후 멤버십정보 - 가입일 (A_L350_ENTT:A_L350.LCENTY)*/
                     , T79.REQD_DT                          AS MSH_REQD_DT                              /* 철거일자- 취소일  이후 멤버십정보 - 취소일 (A_L350_CANT:A_L350.LCCANY)*/
                     , T79.CNTR_PD_ENDDT                    AS MSH_CNTR_PD_ENDDT                        /* 탈퇴일  이후 멤버십정보 - 탈퇴일 (A_L350_OUTT:A_L350.LCOUTY)*/
                     , '' AS  LCET13                                                                    /* TODO.타사보상업체 LC3100P@LCET13 항목없음 > 조PRO 확인중 */
                     , T65.FNL_VAL AS SV_AMT                                                            /* 계약가격산출내역 -- 서비스요금(서비스요금 LC3100P@LCSMT1)  TODO*/
                     , T11.RENTAL_TN                                                                    /* 렌탈회차 (렌탈차월:LC5000P.LCRCNT) */
                     , T85.FGPT_1_PD_NM                                                                 /* 선물명 1 (CWGCN1)*/
                     , T85.FGPT_1_PD_CD                                                                 /* 선물코드 1 (CWGC01)*/
                     , T85.FGPT_1_QTY                                                                   /* 선물수량 1 (CWGQ01)*/
                     , T85.FGPT_2_PD_NM                                                                 /* 선물명 2 (CWGCN2)*/
                     , T85.FGPT_2_PD_CD                                                                 /* 선물코드 2 (CWGC02)*/
                     , T85.FGPT_2_QTY                                                                   /* 선물수량 2 (CWGQ02)*/
                     , T85.FGPT_3_PD_NM                                                                 /* 선물명 3 (CWGCN3)*/
                     , T85.FGPT_3_PD_CD                                                                 /* 선물코드 3 (CWGC03)*/
                     , T85.FGPT_3_QTY                                                                   /* 선물수량 3 (CWGQ03)*/
                     , T85.FGPT_4_PD_NM                                                                 /* 선물명 4 (CWGCN4)*/
                     , T85.FGPT_4_PD_CD                                                                 /* 선물코드 4 (CWGC04)*/
                     , T85.FGPT_4_QTY                                                                   /* 선물수량 4 (CWGQ04)*/
                     , T85.FGPT_5_PD_NM                                                                 /* 선물명 5 (CWGCN5)*/
                     , T85.FGPT_5_PD_CD                                                                 /* 선물코드 5 (CWGC05)*/
                     , T85.FGPT_5_QTY                                                                   /* 선물수량 5 (CWGQ05)*/
                     , '' AS LCET15                                                                     /* 포인트몰 지급금액(LC3100P@LCET15) */
                     , '' AS LCRPMN                                                                     /* 빨간펜포인트적용월(LC3100P@LCRPMN) */
                     , '' AS LCRPAM                                                                     /* 빨간펜포인트적용금액(LC3100P@LCRPAM) */
                     , '' AS LCETC6                                                                     /* 백점이 여부(LC3100P@LCETC6) */
                     , T11.IST_AK_ARTC_MO_CN                                                            /* 설치요청사항메모내용 참고사항(LCSCAL) */
                     , T11.SCON_CN                                                                      /* 특약내용(LCSPAL) */
                     , T11.USE_ELECT_TP_CD                                                              /* 사용전력(LC3100P@LCCHK4)  */
                     , '' AS LCCK06                                                                     /* 선물선택(LC3100P@LCCK06) */
                     , '' AS LCCK06_NM                                                                  /* 선물선택명(LC3100P@LCCK06,LCCK06_NM) */
                     , '' AS LCREPT                                                                     /* 송장출력일(LC3100P@LCREPY, LCREPT) */
                     , CASE WHEN (SELECT COUNT(1)
                                    FROM TB_SSCT_CST_GD_ESTM_IZ /* T.고객등급산정내역*/
                                   WHERE 1=1
                                     AND CST_NO = T10.CNTR_CST_NO       /* 고객번호 */
                                     AND CST_GD_CD = '2'
                                     AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') BETWEEN  VL_STRT_DTM AND VL_END_DTM
                                     AND DTA_DL_YN = 'N'               /* 데이터삭제여부*/
                                    ) = 0
                            THEN '일반' ELSE 'VIP' END LEVELS  /* 등급구분(LEVELS) */
                    , (SELECT IDK_VAL
                         FROM TB_CUBS_CUK_DTL
                        WHERE 1=1
                          AND CST_NO = T10.CNTR_CST_NO      /* 고객번호 */
                          AND IDK_KND_CD = '01'             /* 식별키종류코드 : SAFEKEY(01) */
                          AND DTA_DL_YN = 'N'               /* 데이터삭제여부*/
                       ) AS SAFEKEY                         /* 세이프키 (KWSKEY)*/
                    , T34.ALNC_PRTNR_DRM_DV_CD     /* 제휴파트너식별자명 : 판매조직 (조직구분) LCSGUB */
                    , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'ALNC_PRTNR_DRM_DV_CD', T34.ALNC_PRTNR_DRM_DV_CD) FROM DUAL) AS ALNC_PRTNR_DRM_DV_NM    /* 제휴파트너식별자명 : 조직구분 명 (조직구분) LCSGUB_NM */
                    , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'CNTRT_REL_CD', T48.CNTRT_REL_CD) FROM DUAL) AS CNTRT_REL_NM /* 계약자관계코드(본인,자녀등..)  관계구분:LCST17 */
                    , '' AS LCCK07 /* 주문입력구분(LCCK07) TOBE 맵핑없음 */
                --        ,CASE WHEN LC3100P.LCCK07 = '1' THEN '고객만족팀'
                --              WHEN LC3100P.LCCK07 = '2' THEN '서비스관리팀'
                --              WHEN LC3100P.LCCK07 = '3' THEN '회원업무팀'
                --              ELSE LC3100P.LCCK07
                --        END LCCK07  -- 주문입력구분
                     , CASE WHEN T40.COPN_DV_CD = '1' THEN T40.BRYY_MMDD
                            WHEN T40.COPN_DV_CD = '2' THEN T40.BZRNO
                            ELSE '' END AS BRYY_BZRNO   /* 계약자정보 - 생년월일/사업자번호(LCCID1) */
                     , T10.CST_STLM_IN_MTH_CD AS FTF_DV_CD                                       /* 총판대면 LCST03  1대면, 2비대면 */
                     , '' AS LCET10                                                              /* 직원 판매유형 LCET10 1개인 2부서  > TODO */
                     , T11.FNL_AMT                                                               /* 최종금액 계약총액(LCQAMT) */
                     , T11.FNL_AMT - T11.CNTR_AMT AS RENTAL_TAM                                  /* 렌탈총액 = 계약총액-계약금(등록비)(LCAMTT) */
                     , T11.BASE_PD_CD AS FNL_PD_CD                                               /* 최종상품코드 : LCNCDE(LCNCDE) TODO.최종여부'20230421' */
                     , T20.PD_NM AS FNL_PD_NM                                                    /* 최종판매제품 명 (LCNCDE)  TODO.최종여부'20230401' */
                     , T11.RENTAL_PTRM                                                           /* 렌탈기간1(LCMON1) */
                     , T11.RENTAL_PTRM2                                                          /* 렌탈기간2(LCMON2) */
                     , CASE WHEN T20.SELL_TP_DTL_CD IS NOT NULL
                            THEN '금융리스'
                            ELSE '렌탈' END AS LEASE_DV_NM                                        /* 판매유형상세  렌탈/리스 구분 (LCDTYP) */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'PMOT_CD', T71.PMOT_CD) FROM DUAL) AS PMOT_NM               /* (할인옵션(재렌탈/1+1) :할인옵션(재렌탈/1+1):LCFLG4_NM) */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'MCHN_CH_TP_CD', T70.MCHN_CH_TP_CD) FROM DUAL) AS MCHN_CH_TP_NM    /* 기기변경유형코드 기변유형명(LCFLAG_NM) */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', (SELECT TCDD.USER_DFN_02
                                                 FROM T_CMZ_CD_D TCDD
                                                WHERE 1 = 1
                                                  AND TCDD.CD_ID = 'SELL_DSC_DV_CD'
                                                  AND TCDD.CD_VLD_VAL = T11.SELL_TP_CD
                                                  AND TCDD.TENANT_ID = 'TNT_WELLS')
                                             , T11.SELL_DSC_DV_CD) FROM DUAL) AS SELL_DSC_DV_NM             /* 할인적용유형명 - 할인구분 명(LCGUB1) */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS'
                           , (SELECT CM2.USER_DFN_02 AS ID
                                FROM T_CMZ_CD_D CM2
                               WHERE 1 = 1
                                 AND CM2.CD_ID = 'SELL_DSC_TP_CD' --DSC_APY_TP_CD
                                 AND CM2.PRTS_CD_VLD_VAL = T11.SELL_TP_CD
                                 AND CM2.TENANT_ID = 'TNT_WELLS')
                           , T11.SELL_DSC_TP_CD ) FROM DUAL) AS SELL_DSC_TP_NM                             /* 할인적용상세명 (할인유형 명:LCGUB2) */
                     , T11.SV_PRD||'개월 / '||T23.PD_PRP_VAL02||'개월 / '||T23.PD_PRP_VAL03||'개월' AS SV_PRD_INFO      /* 서비스주기/방문주기/택배주기, LCIMON/LCVMON/LCDMON 관리주기(개월)(BS_ADD_INFO) */
                     , T71.PMOT_TP_CD ||'.'|| F_CMZ_CD_NM('TNT_WELLS', 'PMOT_TP_CD', T71.PMOT_TP_CD) AS PMOT_TP_NM    /* 프로모션유형코드명 할인적용상세명 (할인유형 명: 프로모션유형(LCST11)) */
                     , '' AS LCFLG3                                                                                   /* 설치월청구방식유형코드 설치월 면제 (LCFLG3) TODO 상품의 설치월면제 확인'20230421' */
                     , T74.ALNC_STAT_TP_CD                                                                            /* 제휴상태유형코드 제휴상태(LCETC2)*/
                     , T15.CNTR_CH_RSON_CD AS CNTR_CH_DTL_RSON_CD                                                     /* 계약변경상세사유코드 */
                     , T11.RSTL_YN                                                                                    /* 재약정여부(LCCK09) */
                     , T11.FRISU_BFSVC_PTRM_N AS PD_CH_BF_NMN_N                                                       /* 무상BS기간수- 재품교체이전차월:상변이전차월(LCFLG7) */
                     , CASE WHEN (SELECT COUNT(1)
                                    FROM TB_SSCT_RENTAL_ADN_SV_IZ /* T.렌탈부가서비스내역*/
                                   WHERE 1=1
                                     AND CNTR_NO = T11.CNTR_NO      /* 계약번호 */
                                     AND CNTR_SN = T11.CNTR_SN      /* 계약일련번호 */
                                     AND REQD_DT IS NULL            /* 철거일자 */
                                     AND RSG_DT IS NULL             /* 해지일자 */
                                     AND DTA_DL_YN = 'N'            /* 데이터삭제여부*/
                                         ) > 0
                            THEN 'Y' ELSE 'N' END AS ADN_SV_YN                                                        /* 부가서비스여부(LCET16) */
                      , T11.PRM_APY_DV_CD   /*선납적용구분코드 (LCCK10)*/
                     , CASE WHEN T14.DP_TP_CD = '110' THEN (SELECT F_CMZ_CD_NM('TNT_WELLS', 'BNK_CD' , T14.BNK_CD) FROM DUAL)   /* 은행사 */
                            WHEN T14.DP_TP_CD = '120' THEN (SELECT F_CMZ_CD_NM('TNT_WELLS', 'CDCO_CD', T14.CDCO_CD) FROM DUAL) /* 카드사 */
                            ELSE '' END AS STLM_FNIT                                                                  /* 결제금융기관 -(은행/카드사(LCCARD)) */
                     , T14.MPY_BSDT                                                                                   /* 납부기준일자 - 이체일자(LCTRDD) */
                     , (SELECT /*+ NO_UNNEST INDEX(TB_SSCT_RTAS_STAT_IZ PK_SSCT_RTAS_STAT_IZ) */
                     		  MAX(PDCT_REQD_RQDT) KEEP(DENSE_RANK FIRST ORDER BY CH_SN DESC)
                         FROM TB_SSCT_RTAS_STAT_IZ  /* T.렌탈자산상태내역 */
                        WHERE 1=1
                          AND CNTR_NO = T11.CNTR_NO                 /* 계약번호 */
                          AND CNTR_SN = T11.CNTR_SN                 /* 계약일련번호 */
                          AND PDCT_REQD_DT IS NOT NULL              /* 제품철거요청일자 */
                          AND DTA_DL_YN = 'N') AS PDCT_REQD_RQDT                                                      /* 제품철거요청일자 - 철거요청일자(LCREQT,LCREQY) */
                     , T11.FRISU_YN                                                                                   /* 무상여부 (무료체험여부:LCEGUB) */
                     , '' AS LCPGUB_NM                                                                                /* 컨택업체 (컨택업체:LCPGUB_NM) */
                     , F_CMZ_CD_NM('TNT_WELLS', 'PWSUP_WPRS_ITST_TP_CDEYN' ,T11.WPRS_ITST_TP_CD) AS WPRS_ITST_TP_NM   /* 수압강도유형코드(수압유무-LCCHK5) */
                     , T11.WTQLTY_TST_YN                                                                              /* 수질검사여부 - 수질검사(LCCHK7) */
                     , '' AS LCCHK8                                                                                   /* 설치장소(설치장소:LCCHK8 1자택2사무실3업소4학교)) */
                     , F_CMZ_CD_NM('TNT_WELLS', 'WRFR_IST_MTH_CD' ,T11.WRFR_IST_MTH_CD) AS WRFR_IST_MTH_NM            /* 정수기설치방법코드(설치옵션-LCST06) */
                     , F_CMZ_CD_NM('TNT_WELLS', 'FRISU_RCVRY_TP_CD' ,T11.FRISU_RCVRY_TP_CD) AS FRISU_RCVRY_TP_NM      /* 무상복구유형코드(무상복구사용-LCST12) */
                     , T21.REF_PD_CLSF_VAL                                                                            /* 상품분류코드 참조키(대분류+중분류가 포함되어 있음 EX) 02001 */
                     , T10.SELL_OG_TP_CD                                                                              /* 조직구분 - 계약기본@판매조직유형코드 P,M, 전체 라디오 */
                     , CASE WHEN T20.SELL_TP_DTL_CD = '4' THEN '4'  /*'장기할부'*/
                            WHEN T20.SELL_TP_DTL_CD = '3' THEN '3'  /*'환경리스'*/
                            WHEN T11.CNTRW_TP_CD = '9'    THEN '2'  /*'일반리스'*/
                            ELSE                               '1'  /*'렌탈'*/ END AS CNDT_SELL_TP_CD                  /* 조회조건용 판매유형 - 렌탈/일반리스/환경리스/장기할부 (rntlLeaseDiv) */
                     , T32.DGR1_LEVL_OG_ID                                                                            /* 조회조건: 총괄단 - 조직(1차레벨조직ID) */
                     , T32.DGR2_LEVL_OG_ID                                                                            /* 조회조건: 지역단 - 조직(2차레벨조직ID) */
                     , T32.DGR3_LEVL_OG_ID                                                                            /* 조회조건: 지점 - 조직(3차레벨조직ID) */
                     , T11.CNTR_DTL_STAT_CD                                                                           /* 계약상세상태코드 - 조회조건 취소여부에서 사용중 */
                     , T22.PD_CLSF_NM AS HIGH_PD_CLSF_NM                                                              /* 상품-대분류명 상품분류:KAETC1 */
                     , T21.PD_CLSF_NM AS MIDDLE_PD_CLSF_NM                                                            /* 상품-중분류명 상품유형:KAETC2 */
                     , T11.PD_QTY                                                                                     /* 상품수량 (LCIQTY) */
                     , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'SRCWT_TP_CD' ,T11.SRCWT_TP_CD) FROM DUAL) AS SRCWT_TP_NM     /* 상수원유형코드 (LCCHK6) */
                  FROM T11
                 INNER JOIN TB_SSCT_CNTR_BAS T10 /* T.계약기본 */
                    ON T10.CNTR_NO = T11.CNTR_NO /* 계약번호 */
                   AND T10.DTA_DL_YN = 'N'
                  LEFT OUTER JOIN LATERAL ( SELECT T140.CNTR_NO          /* 계약번호 */
                                                 , T140.DP_TP_CD        /* 납부방식유형코드 */
                                                 , T140.BNK_CD
                                                 , T140.CDCO_CD
                                                 , T140.ACNO_ENCR       /* 계좌번호암호화 */
                                                 , T140.CRCDNO_ENCR     /* 신용카드번호암호화 */
                                                 , T140.MPY_BSDT        /* 납부기준일자 */
                                                 , T140.OWR_KNM
                                             FROM TB_SSCT_CNTR_STLM_BAS T140   /* T.계약결제기본 */
                                            WHERE 1=1
                                              AND T140.DP_TP_CD IN ('0102','0203') /* 납부방식유형코드 : 계좌자동이체(110), 카드자동이체(120)  */
                                              AND T140.CNTR_NO = T11.CNTR_NO
                                              AND T140.DTA_DL_YN = 'N'
                                              AND T140.CNTR_STLM_ID = (SELECT CNTR_STLM_ID  /* 결제금액유형코드 으로  99991231235959 가 2개가 존재함.*/
                                                                        FROM (SELECT T141.CNTR_STLM_ID /*계약결제ID*/
                                                                                   , ROW_NUMBER() OVER(ORDER BY T141.FNL_MDFC_DTM DESC) AS RN
                                                                                FROM TB_SSCT_CNTR_STLM_REL T141    /*계약결제관계*/
                                                                               WHERE 1=1
                                                                                 AND T141.DTL_CNTR_NO = T11.CNTR_NO
                                                                                 AND T141.DTL_CNTR_SN = T11.CNTR_SN
                                                                                 AND T141.RVE_DV_CD = '03'        /*결제금액유형코드 : 월납입액(할부금, 렌탈료)(03)*/
                                                                                 AND T141.VL_END_DTM = '99991231235959'
                                                                                 AND T141.DTA_DL_YN = 'N'
                                                                            )
                                                                      WHERE RN = 1)
                                            ) T14
                    ON 1=1 --T14.CNTR_NO = T11.CNTR_NO
                  LEFT OUTER JOIN TB_SSCT_CNTR_CH_RCP_DTL T15    /* T.계약변경접수상세 - 계약변경사유코드 */
                    ON T15.DTL_CNTR_NO = T11.CNTR_NO
                   AND T15.DTL_CNTR_SN = T11.CNTR_SN
                   AND T15.DTA_DL_YN = 'N'                   /* 데이터삭제여부 */
                   --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T15.DTL_CNTR_NO AND T11.CNTR_SN = T15.DTL_CNTR_SN)
                  LEFT OUTER JOIN TB_PDBS_PD_BAS T20         /* T.상품기본 -  */
                    ON T20.TEMP_SAVE_YN = 'N'                /* 임시저장여부 */
                   AND T20.PD_CD = T11.BASE_PD_CD             /* 상품코드 */
                   AND T20.DTA_DL_YN = 'N'                   /* 데이터삭제여부 */
                  LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS T21    /* T.상품분류기본 상품중분류ID =중분류명 */
                    ON T21.PD_CLSF_ID = T20.PD_MCLSF_ID        /* 상품분류ID */
                   AND T21.DTA_DL_YN = 'N'
                  LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS T22    /* T.상품분류기본 상품중분류ID =대분류명 */
                    ON T22.PD_CLSF_ID = T20.PD_HCLSF_ID        /* 상품분류ID */
                   AND T22.DTA_DL_YN = 'N'
                  LEFT OUTER JOIN TB_PDBS_PD_ECOM_PRP_DTL T23    /* T.상품각사속성상세 - 방문서비스의 제공 주기(LC1150P@LCVMON) */
                    ON T23.PD_EXTS_PRP_GRP_CD = 'SCHD' /* 일정관리 */
                   AND T23.PD_CD = T20.PD_CD
                   AND T23.DTA_DL_YN = 'N'
                  LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ T30         /* T.월파트너내역 - 판매자 */
                    --ON T30.BASE_YM = TO_CHAR(SYSDATE, 'YYYYMM')
                    ON T30.BASE_YM = SUBSTR(T10.CNTR_CNFM_DTM,1,6)
                   AND T30.OG_TP_CD = T10.SELL_OG_TP_CD
                   AND T30.PRTNR_NO = T10.SELL_PRTNR_NO
                   AND T30.DTA_DL_YN = 'N'
                  LEFT OUTER JOIN TB_OGBS_MM_OG_IZ T32         /* T.월조직내역 - 지점장 (조직정보) */
                    --ON T32.BASE_YM = TO_CHAR(SYSDATE, 'YYYYMM')
                    ON T32.BASE_YM = SUBSTR(T10.CNTR_CNFM_DTM,1,6)
                   AND T32.OG_ID = T30.OG_ID
                   AND T32.DTA_DL_YN = 'N'
                  LEFT OUTER JOIN TB_SSCT_CNTR_PRTNR_REL T34      /* T.계약파트너관계 - 판매파트너 */
                    ON T34.CNTR_NO = T11.CNTR_NO         /* 계약번호  */
                   AND T34.PRTNR_NO = T10.SELL_PRTNR_NO
                   AND T34.OG_TP_CD = T10.SELL_OG_TP_CD
                   AND T34.CNTR_PRTNR_TP_CD IN ('010','060') /* 계약파트너유형코드 : 판매자(010), TM판매자(060)*/
                   AND T34.VL_END_DTM = '99991231235959'
                   AND T34.DTA_DL_YN = 'N'
                   --AND EXISTS (SELECT T11.CNTR_NO FROM T11 WHERE T11.CNTR_NO = T34.CNTR_NO)
                  LEFT OUTER JOIN TB_CUBS_CST_BAS T40           /* T.고객기본 - 계약자 */
                    ON T40.CST_NO = T10.CNTR_CST_NO/* 고객번호*/
                   AND T40.DTA_DL_YN = 'N'/* 데이터삭제여부 */
                  LEFT OUTER JOIN TB_GBCO_ADR_BAS T41           /* T.주소기본 - 계약자 */
                    ON T41.ADR_ID = T40.ADR_ID
                   AND T41.DTA_DL_YN = 'N'
--                  LEFT OUTER JOIN TB_SSCT_CNTR_ADR_REL T43      /* T.계약주소관계 - 설치 */
--                    ON T43.DTL_CNTR_NO = T11.CNTR_NO
--                   AND T43.DTL_CNTR_SN = T11.CNTR_SN
--                   AND T43.ADRPC_TP_CD = '3'                    /* 주소지유형코드 : 설치처(3) */
--                   AND T43.VL_END_DTM = '99991231235959'        /* 유효종료일시 */
--                   AND T43.DTA_DL_YN = 'N'
--                   AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T43.DTL_CNTR_NO AND T11.CNTR_SN = T43.DTL_CNTR_SN)
--                  LEFT OUTER JOIN TB_SSCT_CNTR_ADRPC_BAS T44    /* T.계약주소지기본 - 설치 */
--                    ON T44.CNTR_ADRPC_ID = T43.CNTR_ADRPC_ID
--                   AND T44.DTA_DL_YN = 'N'
--                  LEFT OUTER JOIN TB_GBCO_ADR_BAS T45           /* T.주소기본 - 설치 */
--                    ON T45.ADR_ID = T44.ADR_ID
--                   AND T45.DTA_DL_YN = 'N'
                  LEFT OUTER JOIN LATERAL (SELECT *
                                            FROM (SELECT B1.CST_NO             /* 고객번호 */
                                                       --, B1.FRE_EXPN_RCP_DTM   /* 무료체험접수일시 */
                                                       , B1.FRE_EXPN_CNFM_DTM  /* 무료체험확정일시 */
                                                       , B1.FRE_EXPN_PRGS_STAT_CD  /* 무료체험진행상태코드 확정(20)*/
                                                       , ROW_NUMBER() OVER(ORDER BY B1.FNL_MDFC_DTM DESC) AS RN
                                                    FROM TB_SSOP_FRE_EXPN_BAS B1 /* 무료체험기본 - (체험시작일 : LC3100P.LCEXPY) */
                                                   WHERE 1=1
                                                     AND B1.CST_NO = T10.CNTR_CST_NO/* 고객번호*/
                                                     AND DTA_DL_YN = 'N'/* 데이터삭제여부 */
                                                     --AND EXISTS (SELECT T11.CNTR_CST_NO FROM T11 WHERE T11.CNTR_CST_NO = B1.CST_NO)
                                                )
                                          WHERE RN = 1
                                          ) T47             /* 무료체험기본 - 체험시작일 */
                    ON 1=1 --T47.CST_NO = T10.CNTR_CST_NO
                  LEFT OUTER JOIN TB_SSCT_CNTR_CST_REL T48    /* T.계약고객관계 - 계약자 */
                    ON T48.DTL_CNTR_NO = T11.CNTR_NO
                   AND T48.DTL_CNTR_SN = T11.CNTR_SN
                   AND T48.CST_NO = T10.CNTR_CST_NO/* 고객번호*/
                   AND T48.CNTR_CST_REL_TP_CD = '10' /*계약자관계코드 : 계약자(10)*/
                   AND T48.VL_END_DTM = '99991231235959'        /* 유효종료일시 */
                   AND T48.DTA_DL_YN = 'N'
                   --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T48.DTL_CNTR_NO AND T11.CNTR_SN = T48.DTL_CNTR_SN)
                  LEFT OUTER JOIN TB_FEAM_WELS_MM_ACU_CNTR_CL T51  /*웰스월누적계약마감 - 인정실적건수 */
                    ON T51.CNTR_NO = T11.CNTR_NO
                   AND T51.CNTR_SN = T11.CNTR_SN
                   AND T51.BASE_YM = TO_CHAR(SYSDATE, 'YYYYMM')    /* 매출마감년월 */
                   AND T51.MM_ACU_PERF_AGRG_CRT_DV_CD = '01'        /* 월누적실적집계생성구분코드 : 총주문월누적(01) */
                   AND T51.DTA_DL_YN = 'N'
                   --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T51.CNTR_NO AND T11.CNTR_SN = T51.CNTR_SN)
--                  LEFT OUTER JOIN TB_SSCT_CNTR_PRC_CMPT_IZ T62   /*계약가격산출내역 -- 입금실적금액 - 목록 미표시 */
--                    ON T62.CNTR_NO = T11.CNTR_NO
--                   AND T62.CNTR_SN = T11.CNTR_SN
--                   AND T62.DTA_DL_YN = 'N'
--                   AND T62.PD_PRC_FNL_DTL_ID = 'TODO...' /*상품가격최종상세ID*/
--                   AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T62.CNTR_NO AND T11.CNTR_SN = T62.CNTR_SN)
--                   --AND T62.PRC_ID = 'TODO.가격ID'
--                  LEFT OUTER JOIN TB_SSCT_CNTR_PRC_CMPT_IZ T63   /*계약가격산출내역 -- 입금실적율 - 목록 미표시*/
--                    ON T63.CNTR_NO = T11.CNTR_NO
--                   AND T63.CNTR_SN = T11.CNTR_SN
--                   AND T63.DTA_DL_YN = 'N'
--                   AND T63.PD_PRC_FNL_DTL_ID = 'TODO...' /*상품가격최종상세ID*/
--                   AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T63.CNTR_NO AND T11.CNTR_SN = T63.CNTR_SN)
--                   --AND T63.PRC_ID = 'TODO.가격ID'
--                  LEFT OUTER JOIN TB_SSCT_CNTR_PRC_CMPT_IZ T64   /*계약가격산출내역 -- 재약정할인금액(렌탈할인3 LC3100P@LCRAM3) --> 렌탈재약정내역 에서 대체중 */
--                    ON T64.CNTR_NO = T11.CNTR_NO
--                   AND T64.CNTR_SN = T11.CNTR_SN
--                   AND T64.DTA_DL_YN = 'N'
--                   AND T64.PD_PRC_FNL_DTL_ID = 'TODO...' /*상품가격최종상세ID*/
--                   AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T64.CNTR_NO AND T11.CNTR_SN = T64.CNTR_SN)
--                   --AND T64.PRC_ID = 'TODO.가격ID'
                  LEFT OUTER JOIN TB_SSCT_CNTR_PRC_CMPT_IZ T65   /*계약가격산출내역 -- 서비스요금(서비스요금 LC3100P@LCSMT1)*/
                    ON T65.CNTR_NO = T11.CNTR_NO
                   AND T65.CNTR_SN = T11.CNTR_SN
                   AND T65.DTA_DL_YN = 'N'
                   AND T65.PD_PRC_FNL_DTL_ID = 'TODO...' /*상품가격최종상세ID*/
                   --AND T65.PRC_ID = 'TODO.가격ID'
                  LEFT OUTER JOIN LATERAL (SELECT /* MCHN_CH_SN 기준 가장 최신값*/
                                                MAX(T701.BASE_CNTR_NO) KEEP(DENSE_RANK FIRST ORDER BY T701.MCHN_CH_SN DESC) AS BASE_CNTR_NO
                                              , MAX(T701.BASE_CNTR_SN) KEEP(DENSE_RANK FIRST ORDER BY T701.MCHN_CH_SN DESC) AS BASE_CNTR_SN
                                              , MAX(T701.MCHN_CH_SN) KEEP(DENSE_RANK FIRST ORDER BY T701.MCHN_CH_SN DESC) AS MCHN_CH_SN
                                              , MAX(T701.MCHN_CPS_APYR) KEEP(DENSE_RANK FIRST ORDER BY T701.MCHN_CH_SN DESC) AS MCHN_CPS_APYR   /*기기보상적용율*/
                                              , MAX(T701.MCHN_CH_TP_CD) KEEP(DENSE_RANK FIRST ORDER BY T701.MCHN_CH_SN DESC) AS MCHN_CH_TP_CD   /*기기변경유형코드*/
                                              , MAX(T701.OJ_CNTR_NO) KEEP(DENSE_RANK FIRST ORDER BY T701.MCHN_CH_SN DESC) AS OJ_CNTR_NO   /*대상계약번호*/
                                              , MAX(T701.OJ_CNTR_SN) KEEP(DENSE_RANK FIRST ORDER BY T701.MCHN_CH_SN DESC) AS OJ_CNTR_SN   /*대상계약일련번호*/
                                           FROM TB_SSCT_MCHN_CH_IZ T701  /* 기기변경내역(이전 정보) */
                                          WHERE 1=1
                                            AND T701.BASE_CNTR_NO = T11.CNTR_NO /* 기준번호=현재계약번호*/
                                            AND T701.BASE_CNTR_SN = T11.CNTR_SN
                                            AND T701.DTA_DL_YN = 'N'
                                            --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T701.BASE_CNTR_NO AND T11.CNTR_SN = T701.BASE_CNTR_SN)
                                          ) T70             /* 기기변경내역 최신 */
                    ON 1=1 --T70.BASE_CNTR_NO = T11.CNTR_NO
                   --AND T70.BASE_CNTR_SN = T11.CNTR_SN
                  LEFT OUTER JOIN LATERAL (
                                         /* 월별혜택은 수량에 표기되나, 해당값은 미정의된 상태임*/
                                          SELECT T701.*
                                               , T702.PMOT_TP_CD    /* 프로모션 유형코드 */
                                            FROM (SELECT /*+ INDEX(I1 IX_SSCT_CNTR_PMOT_IZ_01) */
                                            					 I1.DTL_CNTR_NO
                                                               , I1.DTL_CNTR_SN
                                                               , I1.PMOT_CD
                                                               , MAX(I1.PMOT_FVR_QTY) KEEP(DENSE_RANK FIRST ORDER BY I1.FNL_MDFC_DTM DESC) AS PMOT_FVR_QTY /* 최근값 : 프로모션혜택수량*/
                                                               , MAX(I1.PMOT_FVR_AMT) KEEP(DENSE_RANK FIRST ORDER BY I1.FNL_MDFC_DTM DESC) AS PMOT_FVR_AMT /* 최근값 : 프로모션혜택금액*/
                                                               , SUM(CASE WHEN I1.PMOT_FVR_DTL_ID = (SELECT PMOT_FVR_DTL_ID
                                                                                                FROM TB_PDBS_PMOT_FVR_DTL /*프로모션혜택상세*/
                                                                                               WHERE 1=1
                                                                                                 AND PMOT_FVR_ID = 'TODO' /* 프로모션혜택ID (월별 혜택이 정의된 ID, 아직미정의됨)*/
                                                                                                 AND VL_END_DTM = '99991231235959'
                                                                                                 AND DTA_DL_YN = 'N'
                                                                                              )
                                                                      THEN PMOT_FVR_QTY
                                                                      ELSE 0 END) AS PMOT_FVR_MCN   /*월별 혜택적용시 수량이 월임.*/
                                                            FROM TB_SSCT_CNTR_PMOT_IZ I1 /* T.계약프로모션내역 */
                                                           --INNER JOIN T11
                                                              --ON I1.DTL_CNTR_NO = T11.CNTR_NO
                                                             --AND I1.DTL_CNTR_SN = T11.CNTR_SN
                                                             --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = I1.DTL_CNTR_NO AND T11.CNTR_SN = I1.DTL_CNTR_SN)
                                                           WHERE 1=1
                                                             AND I1.DTA_DL_YN = 'N'
                                                             AND I1.DTL_CNTR_NO = T11.CNTR_NO
                                                             AND I1.DTL_CNTR_SN = T11.CNTR_SN
                                                            GROUP BY I1.DTL_CNTR_NO, I1.DTL_CNTR_SN, I1.PMOT_CD
                                                    ) T701
                                           LEFT OUTER JOIN TB_PDBS_PMOT_BAS T702 /* 프로모션 기본 */
                                             ON T702.PMOT_CD = T701.PMOT_CD
                                            AND T702.VL_END_DTM = '99991231235959'
                                            AND T702.DTA_DL_YN = 'N'
                                          ) T71
                    ON 1=1 --T71.DTL_CNTR_NO = T11.CNTR_NO
                   --AND T71.DTL_CNTR_SN = T11.CNTR_SN
                  LEFT OUTER JOIN TB_SSCT_CNTR_DTL T72      /* T.계약상세 - 기기변경(이전 정보)  */
                    ON T72.CNTR_NO = T70.OJ_CNTR_NO       /* 대상 계약번호  */
                   AND T72.CNTR_SN = T70.OJ_CNTR_SN       /*계약번호  */
                   AND T72.DTA_DL_YN = 'N'
                   --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T72.CNTR_NO AND T11.CNTR_SN = T72.CNTR_SN)
                  LEFT OUTER JOIN TB_PDBS_PD_BAS T73         /* T.상품기본 - 기기변경(이전 정보)  */
                    ON T73.PD_CD = T72.BASE_PD_CD         /* 상품코드 */
                   AND T73.TEMP_SAVE_YN = 'N'             /* 임시저장여부 */
                   AND T73.DTA_DL_YN = 'N'                /* 데이터삭제여부 */
                  LEFT OUTER JOIN TB_SSCT_ACMPAL_CNTR_IZ T74  /* T.관계사제휴계약내역 */
                    ON T74.BASE_CNTR_NO = T11.CNTR_NO  /**/
                   AND T74.BASE_CNTR_SN = T11.CNTR_SN
                   AND T74.SELL_TP_CD = '2' /*판매유형코드 : 렌탈(2)*/
                   AND T74.DTA_DL_YN = 'N'
                   --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T74.BASE_CNTR_NO AND T11.CNTR_SN = T74.BASE_CNTR_SN)
                  LEFT OUTER JOIN TB_SSCT_CNTR_PRTNR_REL T75      /* T.계약파트너관계 - 제휴파트너 */
                    ON T75.CNTR_NO = T11.CNTR_NO         /* 계약번호  */
                   AND T75.CNTR_PRTNR_TP_CD = '040' /* 계약파트너유형코드 : 대리계약판매자(040)*/
                   AND T75.VL_END_DTM = '99991231235959'
                   AND T75.DTA_DL_YN = 'N'
                   --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T75.CNTR_NO)
                  LEFT OUTER JOIN TB_SSCT_CNTR_REL T76       /*계약관계 -- ASIS:정기배송과의 결합을 */
                    ON T76.OJ_DTL_CNTR_NO = T11.CNTR_NO
                   AND T76.OJ_DTL_CNTR_SN = T11.CNTR_SN
                   AND T76.CNTR_REL_DTL_CD IN ('214') /* 계약관계상세코드 : 정기배송(216)*/
                   AND T76.VL_END_DTM = '99991231235959'    /*유효종료일시*/
                   AND T76.DTA_DL_YN = 'N'
                   --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T76.OJ_DTL_CNTR_NO AND T11.CNTR_SN = T76.OJ_DTL_CNTR_SN)
                  LEFT OUTER JOIN LATERAL (SELECT T770.OJ_CNTR_NO
                                                , T770.OJ_CNTR_SN
                                                , T770.BASE_CNTR_NO     /* 기준 계약번호 (이후) */
                                                , T770.BASE_CNTR_SN     /* 기준 계약번호 (이후) */
                                                , T770.MCHN_CH_TP_CD    /* 기기변경유형코드 */
                                                , T773.RENTAL_AMT       /* 렌탈료 */
                                                , T772.PD_NM            /* 상품명 */
                                                , T771.SV_PRD           /* 서비스주기 */
                                                , T771.CNTR_PD_STRTDT   /* 매출일 */
                                             FROM (SELECT MAX(IZ.OJ_CNTR_NO) KEEP(DENSE_RANK FIRST ORDER BY MCHN_CH_SN DESC) AS OJ_CNTR_NO
                                                        , MAX(IZ.OJ_CNTR_SN) KEEP(DENSE_RANK FIRST ORDER BY MCHN_CH_SN DESC) AS OJ_CNTR_SN
                                                        , MAX(IZ.BASE_CNTR_NO) KEEP(DENSE_RANK FIRST ORDER BY MCHN_CH_SN DESC) AS BASE_CNTR_NO
                                                        , MAX(IZ.BASE_CNTR_SN) KEEP(DENSE_RANK FIRST ORDER BY MCHN_CH_SN DESC) AS BASE_CNTR_SN
                                                        , MAX(IZ.MCHN_CH_TP_CD) KEEP(DENSE_RANK FIRST ORDER BY MCHN_CH_SN DESC) AS MCHN_CH_TP_CD
                                                     FROM TB_SSCT_MCHN_CH_IZ IZ /* 기기변경내역(이전정보로 이후 정보 가져오기) */
                                                    WHERE 1=1
                                                      AND IZ.OJ_CNTR_NO = T11.CNTR_NO /* 대상계약번호(이전) = 현재계약번호*/
                                                      AND IZ.OJ_CNTR_SN = T11.CNTR_SN
                                                      AND IZ.DTA_DL_YN = 'N'
                                                      --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = IZ.OJ_CNTR_NO AND T11.CNTR_SN = IZ.OJ_CNTR_SN)
                                                  ) T770
                                          LEFT OUTER JOIN TB_SSCT_CNTR_DTL T771      /* T.계약상세 - 기기변경(이후 정보)  */
                                            ON T771.CNTR_NO = T770.BASE_CNTR_NO         /* 대상 계약번호  */
                                           AND T771.CNTR_SN = T770.BASE_CNTR_SN         /*계약번호  */
                                           AND T771.DTA_DL_YN = 'N'
                                          LEFT OUTER JOIN TB_PDBS_PD_BAS T772         /* T.상품기본 - 기기변경(이후 정보)  */
                                            ON T772.PD_CD = T771.BASE_PD_CD         /* 상품코드 */
                                           AND T772.TEMP_SAVE_YN = 'N'             /* 임시저장여부 */
                                           AND T772.DTA_DL_YN = 'N'                /* 데이터삭제여부 */
                                          LEFT OUTER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T773  /*WELLS매출월마감내역 */
                                            ON T773.SL_CL_YM = TO_CHAR(SYSDATE, 'YYYYMM')    /* 매출마감년월 */
                                           AND T773.CNTR_NO = T770.BASE_CNTR_NO
                                           AND T773.CNTR_SN = T770.BASE_CNTR_SN
                                           AND T773.DTA_DL_YN = 'N'
                                          ) T77             /* 기기변경내역 최신 */
                    ON 1=1 --T77.OJ_CNTR_NO = T11.CNTR_NO
                   --AND T77.OJ_CNTR_SN = T11.CNTR_SN
                  LEFT OUTER JOIN LATERAL (SELECT T780.CNTR_NO
                                                , T780.CNTR_SN
                                                , T780.STPL_DSC_AMT   /* 약정할인금액 */
                                                , T780.STPL_STRTDT    /* 약정시작일자 */
                                                , T780.STPL_CAN_DTM   /* 약정취소일자 */
                                                , T780.STPL_RCP_DTM   /* 약정접수일자 */
                                                , T781.RENTAL_TN      /* 가입차월 */
                                             FROM (SELECT MAX(CNTR_NO) KEEP(DENSE_RANK FIRST ORDER BY STPL_TN DESC) AS CNTR_NO
                                                        , MAX(CNTR_SN) KEEP(DENSE_RANK FIRST ORDER BY STPL_TN DESC) AS CNTR_SN
                                                        , SUM(STPL_DSC_AMT) KEEP(DENSE_RANK FIRST ORDER BY STPL_TN DESC) AS STPL_DSC_AMT   /* 약정할인금액 */
                                                        , MAX(STPL_STRTDT) KEEP(DENSE_RANK FIRST ORDER BY STPL_TN DESC) AS STPL_STRTDT     /* 약정시작일자 */
                                                        , MAX(STPL_CAN_DTM) KEEP(DENSE_RANK FIRST ORDER BY STPL_TN DESC) AS STPL_CAN_DTM   /* 약정취소일자 */
                                                        , MAX(STPL_RCP_DTM) KEEP(DENSE_RANK FIRST ORDER BY STPL_TN DESC) AS STPL_RCP_DTM   /* 약정접수일자 */
                                                     FROM TB_SSCT_RENTAL_RSTL_IZ  /* 렌탈재약정내역 */
                                                    WHERE 1=1
                                                      AND CNTR_NO = T11.CNTR_NO /* 계약번호*/
                                                      AND CNTR_SN = T11.CNTR_SN
                                                      AND RSTL_STAT_CD = '020'    /* 재약정상태코드(확정:020)*/
                                                      AND DTA_DL_YN = 'N'
                                                      --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = CNTR_NO AND T11.CNTR_SN = CNTR_SN)
                                                  ) T780
                                          LEFT OUTER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T781  /*WELLS매출월마감내역 */
                                            ON T781.SL_CL_YM = SUBSTR(T780.STPL_RCP_DTM,1,6)    /* 매출마감년월 = 약정접수일자*/
                                           AND T781.CNTR_NO = T780.CNTR_NO
                                           AND T781.CNTR_SN = T780.CNTR_SN
                                           AND T781.DTA_DL_YN = 'N'
                                          ) T78             /* 기기변경내역 최신 */
                    ON 1=1 --T78.CNTR_NO = T11.CNTR_NO
                   --AND T78.CNTR_SN = T11.CNTR_SN
                  LEFT OUTER JOIN LATERAL(SELECT T790.OJ_DTL_CNTR_NO   /* 대상 - 계약정보(원주문) */
                                               , T790.OJ_DTL_CNTR_SN   /* 대상 - 계약정보(원주문) */
                                               , T791.CNTR_RCP_FSH_DTM    /* 계약접수완료일시-접수일  이후 멤버십정보 - 접수일 (A_L350_CRTT:A_L350.LCCRTY)*/
                                               , T791.CNTR_TEMP_SAVE_DTM  /* 계약임시저장일시-가입일  이후 멤버십정보 - 가입일 (A_L350_ENTT:A_L350.LCENTY)*/
                                               , T793.REQD_DT             /* 철거일자- 취소일  이후 멤버십정보 - 취소일 (A_L350_CANT:A_L350.LCCANY)*/
                                               , T792.CNTR_PD_ENDDT        /* 탈퇴일  이후 멤버십정보 - 탈퇴일 (A_L350_OUTT:A_L350.LCOUTY)*/
                                               /* 연관된 멤버십 정보*/
                                            FROM (SELECT /*+ INDEX(R1 IX_SSCT_CNTR_REL_02) */
                                            			 R1.BASE_CNTR_NO     AS CNTR_NO  /* 기준상세계약번호 */
                                                       , R1.BASE_DTL_CNTR_SN AS CNTR_SN  /* 기준상세계약일련번호 */
                                                       , R1.OJ_DTL_CNTR_NO
                                                       , R1.OJ_DTL_CNTR_SN
                                                    FROM TB_SSCT_CNTR_REL R1 /*계약관계 -- 멤버십가입정보.*/
                                                   WHERE R1.OJ_DTL_CNTR_NO = T11.CNTR_NO /* 대상 - 계약정보(원주문) */
                                                     AND R1.OJ_DTL_CNTR_SN = T11.CNTR_SN /* 대상 - 계약정보(원주문) */
                                                     AND R1.CNTR_REL_DTL_CD IN ('212') /* 계약관계상세코드 : 원주문 - 원주문 - 멤버십(212)*/
                                                     AND R1.DTA_DL_YN = 'N'
                                                     AND R1.VL_END_DTM = '99991231235959'    /*유효종료일시*/
                                                     --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = R1.OJ_DTL_CNTR_NO AND T11.CNTR_SN = R1.OJ_DTL_CNTR_SN)
                                                ) T790
                                          INNER JOIN TB_SSCT_CNTR_BAS T791               /* T.계약기본 */
                                             ON T791.CNTR_NO = T790.CNTR_NO              /*계약번호  */
                                            AND T791.DTA_DL_YN = 'N'
                                          INNER JOIN TB_SSCT_CNTR_DTL T792             /* T.계약상세 */
                                             ON T792.CNTR_NO = T790.CNTR_NO              /*계약번호  */
                                            AND T792.CNTR_SN = T790.CNTR_SN              /*계약번호  */
                                            AND T792.DTA_DL_YN = 'N'
                                           LEFT OUTER  JOIN TB_SSCT_CNTR_WELLS_DTL T793  /* T.WELLS상세 */
                                             ON T793.CNTR_NO = T790.CNTR_NO              /*계약번호  */
                                            AND T793.CNTR_SN = T790.CNTR_SN              /*계약번호  */
                                            AND T793.DTA_DL_YN = 'N'
                                           ) T79             /* 연관된 멤버십 정보 */
                    ON 1=1 --T79.OJ_DTL_CNTR_NO = T11.CNTR_NO
                   --AND T79.OJ_DTL_CNTR_SN = T11.CNTR_SN
                LEFT OUTER JOIN LATERAL(SELECT T900.CNTR_NO         /* 대상 - 계약정보(1+1이전) */
                                             , T900.CNTR_SN         /* 대상 - 계약정보(1+1이전) */
                                             , T901.BASE_PD_CD      /* 상품코드 */
                                             , T902.PD_NM           /* 상품코드명 */
                                             , T900.BASE_CNTR_NO    /* 기준계약정보 */
                                             , T900.BASE_DTL_CNTR_SN /* 기준계약정보 */
                                          FROM (SELECT /*+ INDEX(R1 IX_SSCT_CNTR_REL_03) */
                                          			   R1.OJ_DTL_CNTR_NO AS CNTR_NO  /* 대상 상세계약번호 */
                                                     , R1.OJ_DTL_CNTR_SN AS CNTR_SN  /* 대상 상세계약일련번호 */
                                                     , R1.BASE_CNTR_NO
                                                     , R1.BASE_DTL_CNTR_SN
                                                  FROM TB_SSCT_CNTR_REL R1 /*계약관계 -- 1+1 이전 계약정보.*/
                                                 WHERE R1.BASE_CNTR_NO     = T11.CNTR_NO /* 기준 - 계약정보 */
                                                   AND R1.BASE_DTL_CNTR_SN = T11.CNTR_SN /* 기준 - 계약정보*/
                                                   AND R1.CNTR_REL_DTL_CD IN ('215') /* 계약관계상세코드 : 1+1연계(215)*/
                                                   AND R1.DTA_DL_YN = 'N'
                                                   AND R1.VL_END_DTM = '99991231235959'    /*유효종료일시*/
                                                   --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = R1.BASE_CNTR_NO AND T11.CNTR_SN = R1.BASE_DTL_CNTR_SN)
                                              ) T900
                                         INNER JOIN TB_SSCT_CNTR_DTL T901             /* T.계약상세 */
                                            ON T901.CNTR_NO = T900.CNTR_NO            /*계약번호  */
                                           AND T901.CNTR_SN = T900.CNTR_SN            /*계약번호  */
                                           AND T901.DTA_DL_YN = 'N'
                                          LEFT OUTER JOIN TB_PDBS_PD_BAS T902         /* T.상품기본 - 기기변경(이전 정보)  */
                                            ON T902.PD_CD = T901.BASE_PD_CD          /* 상품코드 */
                                           AND T902.TEMP_SAVE_YN = 'N'             /* 임시저장여부 */
                                           AND T902.DTA_DL_YN = 'N'                /* 데이터삭제여부 */
                                          ) T90             /*계약관계 -- 1+1 이전 계약정보.*/
                    ON 1=1 --T90.BASE_CNTR_NO = T11.CNTR_NO
                   --AND T90.BASE_DTL_CNTR_SN = T11.CNTR_SN
                LEFT OUTER JOIN LATERAL (
                                         SELECT /*+ INDEX(T81 IX_CBCL_DLQ_BAS_01) */
                                                T81.CNTR_NO
                                              , T81.CNTR_SN
                                              , MIN(T81.PERF_YM) AS FST_PERF_YM
                                              , MAX(T81.PERF_YM) AS FNL_PERF_YM
        --                                      , MIN(T81.PERF_YM) KEEP(DENSE_RANK FIRST ORDER BY PERF_YM ASC  NULLS LAST) AS FST_RGST_USR_NM
        --                                      , MAX(T81.PERF_YM) KEEP(DENSE_RANK FIRST ORDER BY PERF_YM DESC NULLS LAST) AS FNL_PERF_YM
                                           FROM TB_CBCL_DLQ_BAS T81 /* 연체기본 - 최초연체 */
                                          WHERE 1=1
                                            AND T81.CNTR_NO = T11.CNTR_NO
                                            AND T81.CNTR_SN = T11.CNTR_SN
        --                                    AND PERF_YM != TO_CHAR(SYSDATE,'YYYYMM')
                                            AND PERF_YM = TO_CHAR(ADD_MONTHS(SYSDATE, -1), 'YYYYMM')
                                            AND THM_OC_DLQ_AMT  > 0   /* 당월발생연체금액 */
                                            --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = T81.CNTR_NO AND T11.CNTR_SN = T81.CNTR_SN)
                                          GROUP BY CNTR_NO, CNTR_SN
                                          ) T81             /* 연체기본 - 최초연체 */
                    ON 1=1 --T81.CNTR_NO = T11.CNTR_NO
                   --AND T81.CNTR_SN = T11.CNTR_SN
                  LEFT OUTER JOIN LATERAL (SELECT /*+ INDEX(IZ IX_CBCL_WELLS_SL_MM_CL_IZ_02) */
                  									 IZ.CNTR_NO ,  IZ.CNTR_SN
                                                   , MIN(IZ.SL_CL_YM) AS FST_MNGT_YM
                                                   , MAX(IZ.SL_CL_YM)  AS FNL_MNGT_YM
                                              FROM TB_CBCL_WELLS_SL_MM_CL_IZ IZ/* WELLS매출월마감내역 */
                                             WHERE 1=1
                                               AND IZ.CNTR_NO = T11.CNTR_NO
                                               AND IZ.CNTR_SN = T11.CNTR_SN
                                               AND IZ.DTA_DL_YN = 'N'
                                               AND IZ.SL_STP_YN = 'Y' /*매출중지*/
                                               --AND EXISTS (SELECT T11.CNTR_NO, T11.CNTR_SN FROM T11 WHERE T11.CNTR_NO = IZ.CNTR_NO AND T11.CNTR_SN = IZ.CNTR_SN)
                                               GROUP BY IZ.CNTR_NO, IZ.CNTR_SN
                                  ) T83             /* 최초매출중지, 최종매출중지 */
                    ON 1=1 --T83.CNTR_NO = T11.CNTR_NO
                  LEFT OUTER JOIN T85
                    ON T85.FGPT_1_CNTR_NO = T11.CNTR_NO
                   AND T85.FGPT_1_CNTR_SN = T11.CNTR_SN
                LEFT OUTER JOIN LATERAL (SELECT T10.AG_DRM_REFK_VAL AS CNTR_NO
                                              , MAX(CASE WHEN T11.AG_ATC_DV_CD = 'Z11' THEN 'Y' ELSE 'N' END) AS Z11_YN  /* 개인정보 수집·이용 동의 */
                                              , MAX(CASE WHEN T11.AG_ATC_DV_CD = 'Z13' THEN 'Y' ELSE 'N' END) AS Z13_YN  /* 마케팅 목적 처리 동의 */
                                              , MAX(CASE WHEN T11.AG_ATC_DV_CD = 'Z15' THEN 'Y' ELSE 'N' END) AS Z15_YN  /* 개인정보 제3자 제공에 대한 동의 */
                                              , MAX(CASE WHEN T11.AG_ATC_DV_CD = 'W22' THEN 'Y' ELSE 'N' END) AS W22_YN  /* 피버 바이크 플러스 이용 동의 */
                                           FROM TB_CUBS_CST_AG_IZ  T10 /* 고객동의내역 */
                                          INNER JOIN TB_CUBS_CST_AG_IZ_DTL T11   /* 고객동의내역상세 */
                                             ON T11.CST_AG_ID = T10.CST_AG_ID
                                            AND T11.AG_STAT_CD = '01' /* 동의상태코드 : 동의(01)*/
                                            AND T11.AG_EXN_PROCS_RSON_CD IS NULL /* 동의만료처리사유코드 */
                                            AND T11.DTA_DL_YN = 'N'
                                          WHERE T10.AG_DRM_DV_CD = '03'  /* 동의식별구분코드 : 계약(03) */
                                            --AND T10.AG_DRM_REFK_VAL = 'W20177564277' --TEST 데어터
                                            AND T10.AG_DRM_REFK_VAL = T11.CNTR_NO
                                            AND T10.DTA_DL_YN = 'N'
                                            --AND EXISTS (SELECT T11.CNTR_NO FROM T11 WHERE T11.CNTR_NO = T10.AG_DRM_REFK_VAL)
                                          GROUP BY T10.AG_DRM_REFK_VAL
                                          ) T86             /* 월별고객서비스대상내역 - 최종중지 */
                    ON 1=1 --T86.CNTR_NO = T11.CNTR_NO
                 WHERE 1=1
                <if test="@MybatisUtils@isNotEmpty(hcsfVal)">
                    AND T21.REF_PD_CLSF_VAL LIKE #{hcsfVal} || '%'
                </if>
                <if test="@MybatisUtils@isNotEmpty(hcsfMcsfVal)">
                    AND T21.REF_PD_CLSF_VAL LIKE #{hcsfMcsfVal} || '%'
                </if>
                <if test="@MybatisUtils@isNotEmpty(pdNm)">
                    AND T20.PD_NM LIKE '%' || #{pdNm} || '%'
                </if>
                <if test="@MybatisUtils@isNotEmpty(dgr1LevlOgId)">
                    AND T32.DGR1_LEVL_OG_ID IN (
                    <foreach collection="dgr1LevlOgId" item="codeId" separator=",">
                           #{codeId}
                    </foreach>
                       )
                </if>
                <if test="@MybatisUtils@isNotEmpty(dgr2LevlOgId)">
                    AND T32.DGR2_LEVL_OG_ID IN (
                    <foreach collection="dgr2LevlOgId" item="codeId" separator=",">
                           #{codeId}
                    </foreach>
                       )
                </if>
                <if test="@MybatisUtils@isNotEmpty(dgr3LevlOgId)">
                    AND T32.DGR3_LEVL_OG_ID IN (
                    <foreach collection="dgr3LevlOgId" item="codeId" separator=",">
                           #{codeId}
                    </foreach>
                       )
                </if>
                <if test="@MybatisUtils@isNotEmpty(cndtSellTpCd)">
                    AND T20.SELL_TP_DTL_CD = #{cndtSellTpCd}
                </if>
    </select>

    <select id="selectOrderDetailMshPages" resultType="com.kyowon.sms.wells.web.contract.ordermgmt.dvo.WctaOrderDetailMembershipPagesDvo">
        SELECT *
          FROM (
        SELECT T11.CNTR_NO  /*계약번호 */
             , T11.CNTR_SN                                          /* 계약번호 일련번호 (LCSEQN) */
             , CONCAT(CONCAT(T11.CNTR_NO, '-'), T11.CNTR_SN) AS CNTR_DTL_NO /* 계약번호 - 계약일련번호 [계약상세번호] */
             , T11.SELL_TP_CD                                       /* 판매유형코드 */
             , T10.COPN_DV_CD /* 법인격구분코드(계약자 고객구분 ) 1:개인, 2:법인 */
             , T40.CST_KNM                                          /* 계약자정보 - 고객명(LCCNAM) */
             , T44.RCGVP_KNM                                        /* 수령자한글명 - 설치처정보 - 설치자　명(LCWNAM)*/
             , F_CMZ_CD_NM('TNT_WELLS', 'SELL_TP_DTL_CD', T11.SELL_TP_DTL_CD ) AS SELL_TP_DTL_NM  /* 판매유형상세코드 (업무구분:LCTYPE,LCTYPENM)  TODO.20230614 : 항목변경 검토  SELL_TP_DTL_NM */
             , T11.CNTRW_TP_CD ||'.' || F_CMZ_CD_NM('TNT_WELLS', 'CNTRW_TP_CD', T11.CNTRW_TP_CD ) AS MSH_DV_NM /* 계약서유형코드 (멤버십구분 LCMTYP,LCMTYPNM) */
             , T22.PD_CLSF_NM || ' > ' ||T21.PD_CLSF_NM AS PD_CLSF_NM                   /* 상품분류(대분류 + 중분류) - 상품분류명 (상품유형:KAETC1 + KAETC2, KAETC1NM, KAETC2NM)*/
             , T11.BASE_PD_CD AS PD_CD                                                  /* 상품코드 (LCICDE) */
             , T20.PD_NM                                                                /* 상품명 (KAINAM) */
             , T11.PD_QTY                                                               /* 상품수량 (LCIQTY)*/
             , F_CMZ_CD_NM('TNT_WELLS', 'SV_TP_CD', T20.SV_PD_TP_CD ) AS SV_TP_NM        /* 용도구분 - 상품의 서비스유형 (용도구분명:LCIUSE)*/
             , T11.STPL_PTRM                                                            /* 약정기간 - 멤버십기간(LCMONT)*/
             , T11.SV_PRD                                                               /* 서비스주기 (관리주기:LCIMON)*/
             , T12.FRISU_BFSVC_PTRM_N                                                   /* 무상BS기간수 - 멤버십/무상멤버십 (LC3500P.LCMMON) */
             , CASE WHEN T14.SELL_TP_CD = '1' THEN T15.FRISU_BFSVC_PTRM_N
                    ELSE NULL END AS SPAY_FRISU_BFSVC_PTRM_N                            /* 일시불-무상BS기간수(일시불/무상멤버십:LC3000P.LCMMON) : 원주문이 일시불인경우 무상멤버십수 */
             , (SELECT PD_CLSF_CD ||'.' || PD_CLSF_NM
                  FROM TB_PDBS_PD_CLSF_BAS    /* T.상품분류기본-소분류명 */
                 WHERE PD_CLSF_ID = T20.PD_LCLSF_ID
                   AND DTA_DL_YN = 'N') AS PD_LCLSF_NM                                  /* (상품구분2 : LCPRT2 : 원베 드/ 투 베드*/
             , (SELECT PD_CLSF_CD ||'.' || PD_CLSF_NM
                  FROM TB_PDBS_PD_CLSF_BAS    /* T.상품분류기본-세분류명 */
                 WHERE PD_CLSF_ID = T20.PD_DCLSF_ID
                   AND DTA_DL_YN = 'N') AS PD_DCLSF_NM                                  /* (상품구분1 : LCPRT1 : 싱글/퀸/킹/싱글.) TODO.필요에 따라 상품구분1,2 대응이 소/세를 순서를 변경할수 있음 */
             , CASE WHEN T11.CNTR_DTL_STAT_CD IS NULL THEN F_CMZ_CD_NM('TNT_WELLS', 'CNTR_PRGS_STAT_CD', T10.CNTR_PRGS_STAT_CD)
                    ELSE F_CMZ_CD_NM('TNT_WELLS', 'CNTR_DTL_STAT_CD', T11.CNTR_DTL_STAT_CD) END AS CNTR_DTL_STAT_NM /*계약상세상태코드 : 멤버십상태(MMSSTNM)*/
             , F_CMZ_CD_NM('TNT_WELLS', (SELECT TCDD.USER_DFN_02
                                         FROM T_CMZ_CD_D TCDD
                                        WHERE 1 = 1
                                          AND TCDD.CD_ID = 'SELL_DSC_DV_CD'
                                          AND TCDD.CD_VLD_VAL = T11.SELL_TP_CD
                                          AND TCDD.TENANT_ID = 'TNT_WELLS')
                                     , T11.SELL_DSC_DV_CD) AS SELL_DSC_DV_NM             /* 할인적용유형명 - 할인구분 명(LCGUB1) TODO.20230614 : 항목변경 검토 (DSC_APY_TP_NM) */
             , F_CMZ_CD_NM('TNT_WELLS'
                   , (SELECT CM2.USER_DFN_02 AS ID
                        FROM T_CMZ_CD_D CM2
                       WHERE 1 = 1
                         AND CM2.CD_ID = 'SELL_DSC_TP_CD' --DSC_APY_TP_CD
                         AND CM2.PRTS_CD_VLD_VAL = T11.SELL_TP_CD
                         AND CM2.TENANT_ID = 'TNT_WELLS')
                   , T11.SELL_DSC_TP_CD ) AS SELL_DSC_TP_NM                             /* 할인적용상세명 (할인유형 명:LCGUB2) TODO.20230614 : 항목변경 검토 (DSC_APY_DTL_NM) */
             , T11.FEE_ACKMT_CT                                                         /* 수수료인정건수 -인정건수(LCPCNT) */
             , T11.ACKMT_PERF_AMT                                                       /* 인정실적금액 - 인정금액(LCPAMT) */
             , T11.DSC_AMT AS CNTR_CTR_AMT                                              /* 조정값 (할인금액:LCRAMT)*/
             , F_CMZ_CD_NM('TNT_WELLS', 'STLM_TP_CD', T11.STLM_TP_CD) AS STLM_TP_NM     /* 결제유형코드 - 납입방법(LCTGUB, 월납/선납 -> 할부/일시불) */
             , T12.PRM_PTRM_MCN                                                         /* 선납기간개월수 - 선납구분(선납개월:LCETC2)*/
             , '' AS ADJ_DV_NM                                                             /* 정산구분(LC3500P@LCETC6 - 1:선정산,2:후정산) TODO.맵핑확인 필요 문의 */
             , CASE WHEN T15.SELL_EV_CD = 'F' AND T24.STPL_PRD_CD ='36' AND T12.FRISU_BFSVC_PTRM_N = '12' AND T11.STPL_PTRM = '36'
                    THEN F_CMZ_CD_NM('TNT_WELLS', 'STPL_PRD_CD', T24.STPL_PRD_CD) ||' 약정'
                    ELSE F_CMZ_CD_NM('TNT_WELLS', 'SELL_EV_CD', T15.SELL_EV_CD) END AS SELL_EV_NM   /*판매행사코드 (약정구분:LCETC3) */
             , T12.FRISU_MSH_CRT_YN                                                         /* 무상멤버십생성여부 -무상멤생성(LCETC7) */
             , SUBSTR(T10.CNTR_RCP_FSH_DTM, 0, 8) AS CNTR_RCP_FSH_DT                        /* 계약접수완료일시 - 접수일자(LCCRYMD,LCCRTY) */
             , CASE WHEN T10.CNTR_CNFM_DTM IS NULL THEN 'N' ELSE 'Y' END AS CNTR_CNFM_YN    /* 계약확정일시 존재여부 - 확정여부(LCFGUB) */
             , SUBSTR(T10.CNTR_CNFM_DTM, 0, 8) AS CNTR_CNFM_DT                              /* 계약확정일시 - 확정일자(LCFIYMD,LCFIXY) */
             --, SUBSTR(T10.CNTR_TEMP_SAVE_DTM, 0, 8) AS CNTR_TEMP_SAVE_DT                    /* 계약임시저장일시 - 가입일(LCENYMD,LCENTY,LCENTT) */
             , SUBSTR(T11.CNTR_PD_STRTDT, 0, 8) AS CNTR_PD_STRTDT                            /* 계약임시저장일시 - 가입일(LCENYMD,LCENTY,LCENTT) */
             , CASE WHEN T11.CNTRW_TP_CD = '5' THEN  T11.SPP_DUEDT ELSE '' END AS HCR_DUEDT /* 홈케어예정일 (홈케어예정일자:LCDEYMD, LCDEMY) 계약서유형이 홈케이일때 예정일*/
             , T12.IST_DT                                                                   /* 설치일자    (설치일: SETYMD, LCSETY  ASIS에서 목록에서는 매출일을 설치일자로 상세팝업에서는 설치일자를 보고 있었음 전부 설치일로 변경함*/
             , T11.CNTR_PD_STRTDT AS SL_DT                                                                    /* 매출일자 (매출일:SLDT.LCSLEY) */
             --, T50.SL_RCOG_DT AS SL_DT                                                                    /* 매출일자 (매출일:SLDT.LCSLEY) */
             , CASE WHEN T10.CNTR_TEMP_SAVE_DTM IS NOT NULL AND T12.FRISU_BFSVC_PTRM_N IS NOT NULL
                    THEN TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(T10.CNTR_CNFM_DTM, 0, 8), 'YYYYMMDD'), T12.FRISU_BFSVC_PTRM_N) -1,'YYYYMMDD')
                    ELSE NULL END AS DUTY_EXN_DT_FRISU    /* 의무만료일자(무상) DUT1YMD  접수일자 + 무상기간 -1일 */
             , CASE WHEN T10.CNTR_TEMP_SAVE_DTM IS NOT NULL AND T11.STPL_PTRM IS NOT NULL AND  (T11.STPL_PTRM - T12.FRISU_BFSVC_PTRM_N > 0)
                    THEN TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(T10.CNTR_CNFM_DTM, 0, 8), 'YYYYMMDD'), T11.STPL_PTRM) -1,'YYYYMMDD')
                    ELSE NULL END AS DUTY_EXN_DT_RECAP    /* 의무만료일자(유상) DUT2YMD  접수일자 + 멤버십약정기간 -1일 */
             , T11.CNTR_PD_ENDDT                                                              /* 계약상품종료일자 - 탈퇴일자(LCOUYMD, LCOUTY) */
             , CASE WHEN T11.CNTR_DTL_STAT_CD IN ('301','302','303')  /* '301' : 고객요청해약,'302' : 연체해약, '303' : 계약취소*/
                    THEN T11.CNTR_PD_ENDDT
                    ELSE '' END AS CAN_DT                                     /* 취소일(LCCAYMD.LCCANY) */
             --, SUBSTR(T17.HIST_STRT_DTM, 0, 8) AS CAN_DT                                     /* 취소일(LCCAYMD.LCCANY) */
             , CASE WHEN T11.CNTRW_TP_CD != '5' THEN  T11.SPP_DUEDT ELSE '' END AS VST_DUEDT /* 방문 예정일 (방문일자:VIDT, LCDEMY) 계약서유형이 홈케어가 아닐때 예정일*/
             , (SELECT SUBSTR(CTT_FSH_DTM, 0, 8)
                  FROM TB_SSOP_CTT_BAS
                 WHERE CTT_OJ_ID = T11.CTT_OJ_ID
                   AND CTT_PRGS_STAT_CD = '20'
                   AND DTA_DL_YN = 'N') AS CTT_FSH_DT                                       /* 컨택완료일시 (컨택일자:CONT, LCCONY)*/
             , T17.CNTR_DTL_STAT_CH_RSON_CD AS CNTR_CAN_RSON_CD                               /* 계약취소사유코드 (탈퇴유형코드:LCCFLG)  TODO.20230614 : 항목변경 검토(CNTR_DTL_STAT_CH_RSON_CD) */
             , F_CMZ_CD_NM('TNT_WELLS', 'CNTR_DTL_STAT_CH_RSON_CD', T17.CNTR_DTL_STAT_CH_RSON_CD) AS CNTR_CAN_RSON_NM   /* 계약취소사유코드 명 - (취소유형 , 탈퇴유형코드:LCCFLG,LCCFNM) TODO.20230614 : 항목변경 검토 CNTR_DTL_STAT_CH_RSON_NM */
             , '' HCR_OSTR_DV_NM                                           /* 홈케어출고구분:CWDLV1NM  TODO.출고여부 알수 없음*/
--             , CASE WHEN T11.CNTRW_TP_CD = '5' AND T46.SPP_ORD_NO IS NOT NULL THEN '정상출고'
--                    WHEN T11.CNTRW_TP_CD = '5' AND T46.SPP_ORD_NO IS NULL THEN '미출고'
--                    ELSE '' END AS HCR_OSTR_DV_NM                                           /* 홈케어출고구분:CWDLV1NM */ --계약서유형코드:홈케어서비스 이면서 배송주문기본@운송장번호가 존재하면 출고
             , CASE WHEN T14.SELL_TP_CD IN ('1','2') THEN T12.IST_DT
                    WHEN T14.SELL_TP_CD = '3' THEN '홈케어멤버십' ELSE '' END AS OJ_IST_DT    /* 원주문-설치일- 원주문매출일자(WLCSLDT) 판매유형코드(할부:1,렌탈:2,멤버십:3) */
             , CASE WHEN T14.SELL_TP_CD IN ('1','2') THEN (CASE WHEN T14.CNTR_DTL_STAT_CD IN ('301','302','303')  /* '301' : 고객요청해약,'302' : 연체해약, '303' : 계약취소*/
                                                                THEN T14.CNTR_PD_ENDDT
                                                                ELSE '' END)
                    WHEN T14.SELL_TP_CD = '3' THEN '홈케어멤버십' ELSE '' END AS OJ_CAN_DT    /* 원주문-- 원주문취소일자(WLCCADT) 판매유형코드(할부:1,렌탈:2,멤버십:3) */
             , CASE WHEN T14.SELL_TP_CD = '1' THEN SUBSTR(T15.CPS_DT, 0, 8)
                    WHEN T14.SELL_TP_CD = '2' THEN ( CASE WHEN T15.REQD_DT IS NOT NULL  AND T15.IST_DT IS NOT NULL -- 철거일(REQD_DT), 설치일(IST_DT)
                                                          AND (T15.REQD_DT > (TO_CHAR(ADD_MONTHS(TO_DATE(T15.IST_DT, 'YYYYMMDD'), T14.STPL_PTRM),'YYYYMMDD')))
                                                         THEN SUBSTR(T14.CNTR_PD_ENDDT, 0, 8)
                                                         ELSE '' END)   /*  (만료철거일:LCENDT.LCENDY) TODO없음 --> '철거일' 이 만료일(설치일+약정기간) 이후인 경우 종료일로 대체 (https://kyowon.atlassian.net/wiki/spaces/ForKUS/pages/95420433)*/
                    WHEN T14.SELL_TP_CD = '3' THEN '홈케어멤버십' END AS OJ_ENDDT          /* 원주문보상/종료일- 원주문취소일자(WLCCADT) 판매유형코드(할부:1,렌탈:2,멤버십:3) */
             , T11.CTT_RS_CD                                                             /* 컨택결과코드 (컨택코드:LCCCDE) */
             , F_CMZ_CD_NM('TNT_WELLS', 'LC_CTT_RS_CD', T11.CTT_RS_CD) AS CTT_RS_NM         /* 컨택결과코드 (컨택내용:LCCCDE의 명칭:CWCCNM) LCCCDENM */
             , (SELECT FNL_MDFC_USR_ID
                  FROM TB_SSOP_CTT_BAS
                 WHERE CTT_OJ_ID = T11.CTT_OJ_ID
                   AND CTT_PRGS_STAT_CD = '20'
                   AND DTA_DL_YN = 'N') AS CTT_RS_NM_USR_ID                                   /* 컨택기본@최종수정사용자ID - (컨택사번:LCCMAN)*/
             , T10.SELL_INFLW_CHNL_DTL_CD ||'.'|| F_CMZ_CD_NM('TNT_WELLS', 'SELL_CHNL_DTL_CD', T10.SELL_INFLW_CHNL_DTL_CD) AS SELL_INFLW_CHNL_DTL_NM /*판매유입채널상세코드 - 판매유형(LCSALE) */
             , T10.SELL_PRTNR_NO                                                        /* 판매파트너번호 - (판매자코드:LCDCDE) */
             , T30.PRTNR_KNM                                                            /* 판매자명(LCDCDENM) */
             , T30.OG_CD                                                                /* 조직코드(판매자의조직코드) LCDDPT*/
             , (SELECT RVE_CD
                 FROM TB_OGBS_PRTNR_DTL /* 파트너상세 */
                WHERE 1=1
                  AND OG_TP_CD = T10.SELL_OG_TP_CD
                  AND PRTNR_NO = T10.SELL_PRTNR_NO
                  AND DTA_DL_YN = 'N' ) AS RVE_CD                                       /* 수납코드(LCSUNA) */
             , T11.FST_RGST_USR_ID  AS ICHR_USR_ID                                      /* 최초등록사용자ID - 업무담당사번(LCECDE)*/
             , F_CMZ_CD_NM('TNT_WELLS', 'DP_TP_CD', T16.DP_TP_CD) AS MPY_MTHD_TP_NM     /* 계좌정보-자동이체 : 납부방식유형코드 - 멤버십이체구분(LCCHK1) */
             , CASE WHEN T16.DP_TP_CD = '110' THEN T16.ACNO_ENCR  /* 계좌정보 */
                    WHEN T16.DP_TP_CD = '120' THEN T16.CRCDNO_ENCR /* 카드자동이체 */
                    ELSE '' END AS AFTN_INF                                            /* 계좌정보-카드／계좌번호(LCCARD-할부이체번호)*/
             , T16.MPY_BSDT                                         /* 납부기준일자 - 이체일자(LCTRDD) */
             , T10.CNTR_CST_NO                                      /* 계약자정보 - 고객번호(교원키:LCKKEY) */
             , T40.CRAL_LOCARA_TNO || '-' || T40.MEXNO_ENCR || '-' || T40.CRAL_IDV_TNO  AS CNTR_CRAL_TNO /* 계약자 - 휴대전화번호(파라미터) */
             , T40.CRAL_LOCARA_TNO AS CNTR_CRAL_LOCARA_TNO          /* 계약자　휴대폰번호1 LCCNOT. LCCNO1 */
             , T40.MEXNO_ENCR AS CNTR_MEXNO_ENCR                    /* 계약자　휴대폰번호2 LCCNOT. LCCNO2 */
             , T40.CRAL_IDV_TNO AS CNTR_CRAL_IDV_TNO                /* 계약자　휴대폰번호3 LCCNOT. LCCNO3 */
             , T41.NEW_ADR_ZIP AS ADR_ZIP                           /* 계약자정보 - 우편번호 : LCZPNO */
             , T41.RNADR  AS CNTR_CST_RNADR                         /* 계약자정보 - 기준주소 : LCCAD1*/
             , T41.RDADR  AS CNTR_CST_RDADR                         /* 계약자정보 - 상세주소 : LCCAD2 LCCAD3*/
             , T44.CRAL_LOCARA_TNO || '-' || T44.MEXNO_ENCR || '-' || T44.CRAL_IDV_TNO  AS IST_CRAL_TNO /* 설치자 - 휴대전화번호(파라미터) */
             , T44.CRAL_LOCARA_TNO AS IST_CRAL_LOCARA_TNO           /* 설치처정보　휴대폰번호1 LCCNOT. LCCNO1 */
             , T44.MEXNO_ENCR AS IST_MEXNO_ENCR                     /* 설치처정보　휴대폰번호2 LCCNOT. LCCNO2 */
             , T44.CRAL_IDV_TNO AS IST_CRAL_IDV_TNO                 /* 설치처정보　휴대폰번호3 LCCNOT. LCCNO3 */
             , T45.NEW_ADR_ZIP      AS IST_ADR_ZIP                  /* 설치처정보 - 우편번호 : WCZPNO */
             , T45.RNADR            AS IST_RNADR                    /* 설치처정보 - 기준주소 : LCWAD1 + LCWAD2 +LCWAD3 */
             , T45.RDADR            AS IST_RDADR                    /* 설치처정보 - 상세주소 : LCWAD1 + LCWAD2 +LCWAD3 */
             , '' AS LCCK05                                         /* 일시불즉시유상M여부 TOBE맵핑없음  원계약의 세트구분(LC3000P@LCCK05) TODO.문의해야함*/
             , CASE WHEN T14.SELL_TP_CD IN ('1','2') THEN T151.CNTR_REL_DTL_CD  /* 일시불,렌탈인경우 정기배송 결합여부*/
                    ELSE '' END COMBI_DV                              /*계약관계상세코드명 결합구분(LC3100P.LCST04:정기배송,214) LC3000P의 결합여부(모종,홈케어,홈케어멤버십)의 결합여부  */
             , T152.CNTR_NO AS SDING_CNTR_NO        /* 웰스팜주문번호(WCCODE)  멤버십계약을 기준으로 정기배송의 대상건중 마지막건을 웰스팜 주문이라함 */
             , T152.CNTR_SN AS SDING_CNTR_SN        /* 웰스팜주문번호(WCCODE)  - 계약번호는 나눠서 보이기로함.*/
             , T11.FEE_FXAM_YN                      /* 수수료정액여부 - 수당제외여부(정액여부:LCET01), ASIS가 정액여부라벨이지만 값은  수당제외여부임 */
             , T12.SCON_CN                          /* 특약내용(LCSPAL)  */
             , '' AS ORD_CNFP                       /* 주문구분 주문확인구분:LCICON - 주문확인처(1:주문처, 2:설치처)  TOBE 맵핑없음 TODO 앱코드만 존재 문의필요 */
            , SUBSTR(T11.FST_RGST_DTM, 0, 8)  AS FST_RGST_DT                                    /* 등록일자 (최초등록일시:LCEYMD)  */
            , SUBSTR(T11.FST_RGST_DTM, 9,6)   AS FST_RGST_TM                                    /* 등록일자 (주문등록일자:LCEHMS)  */
            , T11.FST_RGST_USR_ID                                                               /* 등록자사번 (업무담당:LCECDE) */
            , T11.FST_RGST_PRG_ID                                                               /* 등록프로그램 (등록프로그램:LCEPGM) */
            , SUBSTR(T11.FNL_MDFC_DTM, 0, 8)  AS FNL_MDFC_DT                                    /* 변경일자 (최초등록일시:LCMYMD)  */
            , SUBSTR(T11.FNL_MDFC_DTM, 9,6)   AS FNL_MDFC_TM                                    /* 변경시간 (주문등록일자:LCMHMS)  */
            , T11.FNL_MDFC_USR_ID                                                               /* 변경자사번 (업무담당:LCMCDE) */
            , T11.FNL_MDFC_PRG_ID                                                               /* 변경프로그램 (등록프로그램:LCEPGMGB, LCEPGM) */
            , CASE WHEN (SELECT COUNT(1)
                           FROM TB_SSCT_CST_GD_ESTM_IZ /* T.고객등급산정내역*/
                          WHERE 1=1
                            AND CST_NO = T10.CNTR_CST_NO       /* 고객번호 */
                            AND CST_GD_CD = '2'
                            AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') BETWEEN  VL_STRT_DTM AND VL_END_DTM
                            AND DTA_DL_YN = 'N'               /* 데이터삭제여부*/
                            ) = 0
                    THEN '일반' ELSE 'VIP' END LEVELS  /* 등급구분(LEVELS) */
             , T32.DGR3_LEVL_DG_PRTNR_NO            /* 지점(LCDBON) - 지점장ID */
             , CASE WHEN T40.COPN_DV_CD = '2' THEN T40.BZRNO ELSE T40.BRYY_MMDD END AS BRYY_BZRNO   /* 계약자정보 - 사업자번호(LCCINO) / 생년 */
             , F_CMZ_CD_NM('TNT_WELLS', 'CNTRW_POSND_TP_CD', T43.CNTRW_POSND_TP_CD) AS CNTRW_POSND_TP_NM  /*계약서발송처유형코드 - (우편발송:LCISND) */
             , CASE WHEN T16.DP_TP_CD = '110' THEN F_CMZ_CD_NM('TNT_WELLS', 'BNK_CD' , T16.BNK_CD)   /* 은행사 */
                    WHEN T16.DP_TP_CD = '120' THEN F_CMZ_CD_NM('TNT_WELLS', 'CDCO_CD', T16.CDCO_CD) /* 카드사 */
                    ELSE '' END AS STLM_FNIT                /* 결제금융기관 -(은행/카드사(LCHNAM))*/
             , CASE WHEN T16.DP_TP_CD = '120' THEN SUBSTR(T16.CARD_EXPDT_YM, 0, 2) || '/' || SUBSTR(T16.CARD_EXPDT_YM, 3)
                    ELSE '' END AS CARD_EXPDT_YM                            /* 카드유효기간년월 - 유효년월(EDYYMM) */
             , T11.PD_BASE_AMT                                              /* 상품기준금액 - 회비 LCTAMT_V, LCTAMT */
             , '' AS PY_MCN                                                 /*  [삭제요청예정]납입개월 :LCVAMT ASIS 항목에서 조회하지 않고 '납입개월문구만 표시함' TODO.삭제대상 */
             , '' AS DUTY_PTRM_N                                            /*  [삭제요청예정] 의무사용기간(LCGUB3) , ASIS 데이터 존재하지 않음 : TOBE 이관대상아님 항목 TODO.삭제대상 */
             , T11.DSC_AMT                                                   /* 할인금액  (할인금액:LCRAMT) TODO 할인에 대한 정의가 상품에 없음 TODO.20230614 : 항목 할인액이 2개전부 사용여부 검토 */
             , '' AS PRM_MCN                                                /* [삭제요청예정] 선납개월(LCTMON) , ASIS 전체 데이터 존재하지 않음 : TODO.삭제대상 */
             , T11.TXINV_PBL_OJ_YN                                          /* 세금계산서발행대상여부 - 세금계산서(LCITAX) */
             , (SELECT VST_NMN_N /* 방문차월수 */
                 FROM TB_SVPD_MCBY_CST_SV_OJ_IZ /* T.월별고객서비스대상내역*/
               WHERE 1=1
                 AND CNTR_NO = T11.CNTR_NO
                 AND CNTR_SN = T11.CNTR_SN
                 AND MNGT_YM = TO_CHAR(SYSDATE,'YYYYMM')
                 AND REQD_DT IS NULL    /* 철거일자 */
                 AND CAN_DT IS NULL     /* 취소일자 */
                 AND DTA_DL_YN = 'Y'
                 ) AS VST_NMN_N                                             /* 방문차월수 -방문차월(LCVCNT) */
             , (SELECT PD_PRP_VAL01
                  FROM TB_PDBS_PD_ECOM_PRP_DTL
                 WHERE PD_CD = T11.BASE_PD_CD
                   AND PD_EXTS_PRP_GRP_CD = 'SCHD') AS SV_VST_PRD_CD
             , T40.BRYY_MMDD                    /* 생년월일 - LCICD1) */
             , T40.BZRNO                        /* 계약자정보 - 사업자번호(LCCINO) */
             , T40.SEX_DV_CD                    /* 계약자정보 - 성별(LCCSEX) */
             , T14.SELL_TP_CD       AS OJ_SELL_TP_CD                                              /* 판매유형(원주문) (업무구분:LCTYPE) */
             , T11.CNTRW_TP_CD      AS MSH_DV_CD                                                  /* 계약서유형코드 (멤버십구분 LCMTYP,LCMTYPNM) */
             , T10.SELL_INFLW_CHNL_DTL_CD                                                         /*판매유입채널상세코드 - 판매유형(LCSALE) */
             , T21.REF_PD_CLSF_VAL      /* 상품분류코드 참조키(대분류+중분류가 포함되어 있음 EX) 02001 */
          FROM TB_SSCT_CNTR_BAS T10                     /* T.계약기본 */
         INNER JOIN TB_SSCT_CNTR_DTL T11                /* T.계약상세 */
            ON T11.CNTR_NO = T10.CNTR_NO                /* 계약번호  */
           AND T11.SELL_TP_CD IN ('3')                  /* 판매유형코드 : 멤버십(3)*/
        --   AND T11.CNTRW_TP_CD IN ('4', '5')            /* 계약서유형코드 : 멤버십(4), 홈케어서비스(5) 23.03.13 아직 데이터없어서 주석*/
           AND T11.DTA_DL_YN = 'N'
          LEFT OUTER  JOIN TB_SSCT_CNTR_WELLS_DTL T12   /* T.WELLS상세 */
            ON T12.CNTR_NO = T11.CNTR_NO                /*계약번호  */
           AND T12.CNTR_SN = T11.CNTR_SN                /*계약번호  */
           AND T12.DTA_DL_YN = 'N'
         LEFT OUTER JOIN TB_SSCT_CNTR_REL T13           /*계약관계 맴버십(기준) - 원주문(대상) */
            ON T13.BASE_DTL_CNTR_NO = T11.CNTR_NO
           AND T13.BASE_DTL_CNTR_SN = T11.CNTR_SN
           AND T13.CNTR_REL_DTL_CD IN ('212')           /* 계약관계상세코드 : 원주문 - 멤버십(212)*/
           AND T13.DTA_DL_YN = 'N'
           AND T13.VL_END_DTM = '99991231235959'        /*유효종료일시*/
         LEFT OUTER JOIN TB_SSCT_CNTR_DTL T14           /*T.계약상세 -> 멤버십의 원주문.*/
            ON T14.CNTR_NO = T13.OJ_DTL_CNTR_NO         /*계약번호  */
           AND T14.CNTR_SN = T13.OJ_DTL_CNTR_SN         /*계약번호일련번호  */
           AND T14.DTA_DL_YN = 'N'
          LEFT OUTER  JOIN TB_SSCT_CNTR_WELLS_DTL T15   /* T.WELLS상세-> 멤버십의 원주문. */
            ON T15.CNTR_NO = T14.CNTR_NO                /*계약번호  */
           AND T15.CNTR_SN = T14.CNTR_SN                /*계약번호  */
           AND T15.DTA_DL_YN = 'N'
         LEFT OUTER JOIN TB_SSCT_CNTR_REL T151         /* 계약관계 -- 원계약의 렌탈:정기배송, 일시불:모종/홈케어멤버십/홈케어일시불 결합여부 */
            ON T151.OJ_DTL_CNTR_NO = T14.CNTR_NO       -- 멤버십의 원주문을 대상으로 지정하여 결합된 계약
           AND T151.OJ_DTL_CNTR_SN = T14.CNTR_SN
           AND T151.CNTR_REL_DTL_CD IN ('214','216','219','221')          /* 계약관계상세코드 : 정기배송(214), 모종결합(216), 홈케어(219), 홈케어멤버십(221)*/
           AND T151.DTA_DL_YN = 'N'
           AND T151.VL_END_DTM = '99991231235959'       /* 유효종료일시 */
         LEFT OUTER JOIN LATERAL(SELECT MAX(DTL.CNTR_NO) KEEP(DENSE_RANK FIRST ORDER BY DTL.CNTR_SN DESC) AS CNTR_NO
                                      , MAX(DTL.CNTR_SN) KEEP(DENSE_RANK FIRST ORDER BY DTL.CNTR_SN DESC) AS CNTR_SN
                                  FROM (SELECT BASE_CNTR_NO     AS CNTR_NO  /* 기준상세계약번호 */
                                             , BASE_DTL_CNTR_SN AS CNTR_SN  /* 기준상세계약일련번호 */
                                             , OJ_DTL_CNTR_NO
                                             , OJ_DTL_CNTR_SN
                                          FROM TB_SSCT_CNTR_REL  /*계약관계 -- 멤버십가입정보.*/
                                         WHERE BASE_DTL_CNTR_NO = T11.CNTR_NO  /* 기준 - 계약정보(멤버십) */
                                           AND BASE_DTL_CNTR_SN = T11.CNTR_SN  /* 기준 - 계약정보(멤버십) */
                                           AND CNTR_REL_DTL_CD IN ('214') /* 계약관계상세코드 : 정기배송(214) */
                                           AND DTA_DL_YN = 'N'
                                           AND VL_END_DTM = '99991231235959'    /*유효종료일시*/
                                      ) REL
                                 INNER JOIN TB_SSCT_CNTR_DTL DTL             /* T.계약상세 */
                                    ON DTL.CNTR_NO = REL.CNTR_NO              /*계약번호  */
                                   AND DTL.CNTR_SN = REL.CNTR_SN              /*계약번호  */
                                   AND DTL.CNTR_DTL_STAT_CD = '101'
                                   AND DTL.DTA_DL_YN = 'N'
                                  ) T152    /* 멤버십의 정기배송으로 대상은 모종으로 ASIS에서 판단하여 가장 최근한건을 웰스팜주문번호 으로 칭함. */
            ON T152.CNTR_NO = T14.CNTR_NO       -- 멤버십의 원주문을 대상으로 지정하여 결합된 계약
           AND T152.CNTR_SN = T14.CNTR_SN
          LEFT OUTER JOIN LATERAL ( SELECT CNTR_NO          /* 계약번호 */
                                         , DP_TP_CD        /* 납부방식유형코드 */
                                         , BNK_CD
                                         , CDCO_CD
                                         , ACNO_ENCR       /* 계좌번호암호화 */
                                         , CRCDNO_ENCR     /* 신용카드번호암호화 */
                                         , MPY_BSDT        /* 납부기준일자 */
                                         , OWR_KNM
                                         , CARD_EXPDT_YM    /* 카드유효기간년월 */
                                     FROM TB_SSCT_CNTR_STLM_BAS   /* T.계약결제기본 */
                                    WHERE 1=1
                                      AND DP_TP_CD IN ('0102','0203') /* 납부방식유형코드 : 계좌자동이체(110), 카드자동이체(120)  */
                                      AND CNTR_NO = T11.CNTR_NO
                                      AND DTA_DL_YN = 'N'
                                      AND CNTR_STLM_ID = (SELECT CNTR_STLM_ID /*계약결제ID*/
                                                                 FROM TB_SSCT_CNTR_STLM_REL     /*계약결제관계*/
                                                                WHERE 1=1
                                                                  AND DTL_CNTR_NO = T11.CNTR_NO
                                                                  AND DTL_CNTR_SN = T11.CNTR_SN
                                                                  AND RVE_DV_CD = '04'        /*수납구분코드 : 멤버십회비(04)*/
                                                                  AND VL_END_DTM = '99991231235959'
                                                                  AND DTA_DL_YN = 'N'
                                                               )
                                    ) T16
            ON T16.CNTR_NO = T11.CNTR_NO    /* 자동이체 관계 */
          LEFT OUTER JOIN LATERAL (SELECT MAX(CNTR_NO) KEEP(DENSE_RANK FIRST ORDER BY HIST_STRT_DTM DESC) AS CNTR_NO
                                        , MAX(CNTR_SN) KEEP(DENSE_RANK FIRST ORDER BY HIST_STRT_DTM DESC) AS CNTR_SN
                                        , MAX(HIST_STRT_DTM) KEEP(DENSE_RANK FIRST ORDER BY HIST_STRT_DTM DESC) AS HIST_STRT_DTM
                                        , MAX(CNTR_DTL_STAT_CH_RSON_CD) KEEP(DENSE_RANK FIRST ORDER BY HIST_STRT_DTM DESC) AS CNTR_DTL_STAT_CH_RSON_CD /* 계약상세상태변경사유코드*/
                                     FROM TB_SSCT_CNTR_DTL_STAT_CH_HIST   /* T.계약상세상태변경이력 - 취소일 */
                                    WHERE 1=1
                                      AND CNTR_NO = T11.CNTR_NO              /* 계약번호 */
                                      AND CNTR_SN = T11.CNTR_SN              /* 계약일련번호 */
                                      AND CNTR_DTL_STAT_CD IN ('301','302','303')  /* 계약상세상태코드 (고객요청해약~계약취소) */
                                      AND DTA_DL_YN = 'N'
                                  ) T17             /* 계약번호 취소일 */
            ON T17.CNTR_NO = T11.CNTR_NO
           AND T17.CNTR_SN = T11.CNTR_SN
          LEFT OUTER JOIN TB_PDBS_PD_BAS T20         /* T.상품기본 -  */
            ON T20.PD_CD = T11.BASE_PD_CD             /* 상품코드 */
           AND T20.TEMP_SAVE_YN = 'N'                /* 임시저장여부 */
           AND T20.DTA_DL_YN = 'N'                   /* 데이터삭제여부 */
          LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS T21    /* T.상품분류기본 상품중분류ID =중분류명 */
            ON T21.PD_CLSF_ID = T20.PD_MCLSF_ID        /* 상품분류ID */
           AND T21.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS T22    /* T.상품분류기본 상품중분류ID =대분류명 */
            ON T22.PD_CLSF_ID = T20.PD_HCLSF_ID        /* 상품분류ID */
           AND T22.DTA_DL_YN = 'N'
          LEFT OUTER JOIN LATERAL (SELECT *
                                    FROM (SELECT PD_CD         /* 상품코드 */
                                               , STPL_PRD_CD   /* 상품의 약정주기 LC3500P@LCGUB4(약정구분대체) */
                                               , ROW_NUMBER() OVER(ORDER BY PD_PRC_FNL_DTL_ID, VER_SN DESC) AS RN
                                            FROM TB_PDBS_PD_PRC_FNL_DTL   /* 상품가격최종상세 - 약정주기를 가지고 오기위함 */
                                           WHERE 1=1
                                             AND PD_CD      = T11.BASE_PD_CD         -- 기준/복합상품코드
                                             AND SELL_TP_CD = T11.SELL_TP_CD             -- 판매유형코드
                                             AND SELL_CHNL_CD = '10'         -- 판매채널코드  /* 계약기본:판매유입채널상세코드 참고 > '20230601' 변경될수 있음 */
                                             AND PD_PRC_CNDT_CHRC_VAL02 = T11.SELL_DSC_DV_CD -- 할인유형코드
                                             AND TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') BETWEEN VL_STRT_DTM AND VL_END_DTM
                                             AND DTA_DL_YN = 'N'
                                        )
                                    WHERE RN = 1
                                  ) T24             /* 상품 - 약정주기 */
            ON T24.PD_CD = T11.BASE_PD_CD             /* 상품코드 */
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ T30         /* T.월파트너내역 - 판매자 */
            --ON T30.BASE_YM = TO_CHAR(SYSDATE, 'YYYYMM')
            ON T30.BASE_YM = SUBSTR(T10.CNTR_CNFM_DTM,1,6)
           AND T30.OG_TP_CD = T10.SELL_OG_TP_CD
           AND T30.PRTNR_NO = T10.SELL_PRTNR_NO
           AND T30.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_OGBS_MM_OG_IZ T32         /* T.월조직내역 - 지점장 (조직정보) */
            --ON T32.BASE_YM = TO_CHAR(SYSDATE, 'YYYYMM')
            ON T32.BASE_YM = SUBSTR(T10.CNTR_CNFM_DTM,1,6)
           AND T32.OG_ID = T30.OG_ID
           AND T32.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_CUBS_CST_BAS T40           /* T.고객기본 - 계약자 */
            ON T40.CST_NO = T10.CNTR_CST_NO/* 고객번호*/
           AND T40.DTA_DL_YN = 'N'/* 데이터삭제여부 */
          LEFT OUTER JOIN TB_GBCO_ADR_BAS T41           /* T.주소기본 - 계약자 */
            ON T41.ADR_ID = T40.ADR_ID
           AND T41.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SSCT_CNTR_ADR_REL T43      /* T.계약주소관계 - 설치 */
            ON T43.DTL_CNTR_NO = T11.CNTR_NO
           AND T43.DTL_CNTR_SN = T11.CNTR_SN
           AND T43.ADRPC_TP_CD IN ( '2','3')            /* 주소지유형코드 : 설치처(3) */
           AND T43.VL_END_DTM = '99991231235959'        /* 유효종료일시 */
           AND T43.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SSCT_CNTR_ADRPC_BAS T44    /* T.계약주소지기본 - 설치 */
            ON T44.CNTR_ADRPC_ID = T43.CNTR_ADRPC_ID
           AND T44.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_GBCO_ADR_BAS T45           /* T.주소기본 - 설치 */
            ON T45.ADR_ID = T44.ADR_ID
           AND T45.DTA_DL_YN = 'N'
--          LEFT OUTER JOIN LATERAL (SELECT MAX(T431.CNTR_NO) KEEP(DENSE_RANK FIRST ORDER BY T430.FNL_MDFC_DTM DESC) AS CNTR_NO
--                                        , MAX(T431.CNTR_SN) KEEP(DENSE_RANK FIRST ORDER BY T430.FNL_MDFC_DTM DESC) AS CNTR_SN
--                                        , MAX(T430.SPP_ORD_NO) KEEP(DENSE_RANK FIRST ORDER BY T430.FNL_MDFC_DTM DESC) AS SPP_ORD_NO
--                                        , MAX(T431.SPP_PROCS_BZS_CD) KEEP(DENSE_RANK FIRST ORDER BY T430.FNL_MDFC_DTM DESC) AS SPP_PROCS_BZS_CD /* 배송처리업체코드 */
--                                     FROM TB_SSSO_SPP_ORD_BAS T430  /* 배송주문기본 */
--                                    INNER JOIN TB_SSSO_SPP_ORD_DTL T431           /* T.배송주문상세 */
--                                       ON T431.SPP_ORD_NO = T430.SPP_ORD_NO
--                                      AND T431.CNTR_NO = T11.CNTR_NO
--                                      AND T431.CNTR_SN = T11.CNTR_SN
--                                      AND T431.DTA_DL_YN = 'N'
--                                    WHERE 1=1
--                                      AND T430.IOST_TP_CD = '10'    /* 입출고유형코드 : 출고(10) */
--                                      AND T431.IOST_DTL_CD = '13'    /* 입출고유형코드 : 정상출고(13) RPCOID */
--                                      AND T431.SPP_ORD_RGST_TP_CD = '10'    /* 배송주문등록유형코드 : 정상(10) */
--                                      AND T431.SPP_PRGS_STAT_CD IN ('40','50','60','70')    /* 배송진행상태코드 : 출고요청~배송완료*/
--                                      AND T430.DTA_DL_YN = 'N'
--                                  ) T46             /* 운송장번호(계약일련번호별) */
--            ON T46.CNTR_NO = T11.CNTR_NO
--           AND T46.CNTR_SN = T11.CNTR_SN
--         LEFT OUTER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T50  /* WELLS매출월마감내역 */
--            ON T50.SL_CL_YM = TO_CHAR(SYSDATE, 'YYYYMM')    /* 매출마감년월 */
--           AND T50.CNTR_NO = T11.CNTR_NO
--           AND T50.CNTR_SN = T11.CNTR_SN
--           AND T50.DTA_DL_YN = 'N'
         WHERE 1=1
        <if test="@MybatisUtils@isNotEmpty(rcpDateDv)">
            <choose>
                <when test='@MybatisUtils@equals(rcpDateDv, "1")'> /* 접수일자 */
                    AND T10.CNTR_RCP_FSH_DTM BETWEEN #{strtDt}||'000000' AND #{endDt}||'235959'
                </when>
                <when test='@MybatisUtils@equals(rcpDateDv, "2")'> /* 예정일자 */
                    AND T11.SPP_DUEDT BETWEEN #{strtDt} AND #{endDt}
                </when>
                <when test='@MybatisUtils@equals(rcpDateDv, "3")'> /* 탈퇴일자 */
                    AND T11.CNTR_PD_ENDDT BETWEEN #{strtDt} AND #{endDt}
                </when>
                <when test='@MybatisUtils@equals(rcpDateDv, "4")'> /* 가입일자 */
                    AND T10.CNTR_TEMP_SAVE_DTM BETWEEN #{strtDt}||'000000' AND #{endDt}||'235959'
                </when>
                <when test='@MybatisUtils@equals(rcpDateDv, "5")'> /* 의무만료일자(무상) */
                    AND TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(T10.CNTR_CNFM_DTM, 0, 8), 'YYYYMMDD'), T12.FRISU_BFSVC_PTRM_N) -1,'YYYYMMDD') BETWEEN #{strtDt} AND #{endDt}
                </when>
                <when test='@MybatisUtils@equals(rcpDateDv, "6")'> /* 의무만료일자(유상) */
                    AND TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(T10.CNTR_CNFM_DTM, 0, 8), 'YYYYMMDD'), T11.STPL_PTRM) -1,'YYYYMMDD') BETWEEN #{strtDt} AND #{endDt}
                </when>
            </choose>
        </if>
        <if test="@MybatisUtils@isNotEmpty(dateSeltDv)">
            <choose>
                <when test='@MybatisUtils@equals(dateSeltDv, "1")'> /* 예정일 */
                    AND T11.SPP_DUEDT BETWEEN #{choStrtDt} AND #{choEndDt}
                </when>
                <when test='@MybatisUtils@equals(dateSeltDv, "2")'> /* 탈퇴일 */
                    AND T11.CNTR_PD_ENDDT BETWEEN #{choStrtDt} AND #{choEndDt}
                </when>
                <when test='@MybatisUtils@equals(dateSeltDv, "3")'> /* 가입일 */
                    AND T10.CNTR_TEMP_SAVE_DTM BETWEEN #{choStrtDt}||'000000' AND #{choEndDt}||'235959'
                </when>
                <when test='@MybatisUtils@equals(dateSeltDv, "4")'> /* 의무만료일(무상) */
                    AND TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(T10.CNTR_CNFM_DTM, 0, 8), 'YYYYMMDD'), T12.FRISU_BFSVC_PTRM_N) -1,'YYYYMMDD') BETWEEN #{choStrtDt} AND #{choEndDt}
                </when>
                <when test='@MybatisUtils@equals(dateSeltDv, "5")'> /* 의무만료일(유상) */
                    AND TO_CHAR(ADD_MONTHS(TO_DATE(SUBSTR(T10.CNTR_CNFM_DTM, 0, 8), 'YYYYMMDD'), T11.STPL_PTRM) -1,'YYYYMMDD') BETWEEN #{choStrtDt} AND #{choEndDt}
                </when>
                <when test='@MybatisUtils@equals(dateSeltDv, "6")'> /* 확정일 */
                    AND T10.CNTR_CNFM_DTM BETWEEN #{choStrtDt}||'000000' AND #{choEndDt}||'235959'
                </when>
                <when test='@MybatisUtils@equals(dateSeltDv, "7")'> /* 매출일 */
                    AND T11.CNTR_PD_STRTDT BETWEEN #{choStrtDt} AND #{choEndDt}
                </when>
                <when test='@MybatisUtils@equals(dateSeltDv, "8")'> /* 취소일 */
                    AND (CASE WHEN T11.CNTR_DTL_STAT_CD IN ('301','302','303')  /* '301' : 고객요청해약,'302' : 연체해약, '303' : 계약취소*/
                              THEN T11.CNTR_PD_ENDDT
                              ELSE '' END) BETWEEN #{choStrtDt}||'000000' AND #{choEndDt}||'235959'
                </when>
            </choose>
        </if>
        <if test="@MybatisUtils@isNotEmpty(cntrNo)">
           AND T11.CNTR_NO = #{cntrNo}
        </if>
        <if test="@MybatisUtils@isNotEmpty(cntrSn)">
           AND T11.CNTR_SN = #{cntrSn}
        </if>
        <if test="@MybatisUtils@isNotEmpty(sellTpDtlCd)">
           AND T11.SELL_TP_DTL_CD = #{sellTpDtlCd}
            /*     31	일시불 멤버십   TODO.20230614 : 항목변경 검토
                   32	렌탈 멤버십
                   33	홈케어 멤버십
            */
        </if>
        <if test="@MybatisUtils@isNotEmpty(cntrwTpCd)">
           AND T11.CNTRW_TP_CD = #{cntrwTpCd}
        </if>
        <if test="@MybatisUtils@isNotEmpty(sellInflwChnlDtlCd)">
           AND T10.SELL_INFLW_CHNL_DTL_CD = #{sellInflwChnlDtlCd}
        </if>
        <if test="@MybatisUtils@isNotEmpty(hcsfVal)">
           AND T21.REF_PD_CLSF_VAL LIKE #{hcsfVal} || '%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(hcsfMcsfVal)">
           AND T21.REF_PD_CLSF_VAL LIKE #{hcsfMcsfVal} || '%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(pdCd)">
           AND T11.BASE_PD_CD LIKE '%' || #{pdCd} || '%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(pdNm)">
           AND T20.PD_NM LIKE '%' || #{pdNm} || '%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(sellPrtnrNo)">
           AND T10.SELL_PRTNR_NO = #{sellPrtnrNo}
        </if>
        <if test='@MybatisUtils@equals(cntrRcpFshDtYn,"Y")'>
           AND T10.CNTR_CNFM_DTM IS NULL
        </if>
        <if test='@MybatisUtils@equals(bryyMmddEntrpNoCbno,"1")'>
           AND T40.BRYY_MMDD  = #{bryyMmdd}
            <if test='@MybatisUtils@equals(sexDvCd,"M")'>
                AND T40.SEX_DV_CD IN ('1','3')
            </if>
            <if test='@MybatisUtils@equals(sexDvCd,"F")'>
                AND T40.SEX_DV_CD IN ('2','4')
            </if>
        </if>
        <if test='@MybatisUtils@equals(bryyMmddEntrpNoCbno,"2") or @MybatisUtils@equals(bryyMmddEntrpNoCbno, "3")'>
           AND T40.BZRNO  = #{bzrno}
        </if>
        <if test="@MybatisUtils@isNotEmpty(cstKnm)">
           AND T40.CST_KNM LIKE '%'||#{cstKnm}||'%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(cralLocaraTno)">
           AND T40.CRAL_LOCARA_TNO = #{cralLocaraTno}
        </if>
        <if test="@MybatisUtils@isNotEmpty(mexnoEncr)">
           AND T40.MEXNO_ENCR = #{mexnoEncr}
        </if>
        <if test="@MybatisUtils@isNotEmpty(cralIdvTno)">
           AND T40.CRAL_IDV_TNO = #{cralIdvTno}
        </if>
        <if test="@MybatisUtils@isNotEmpty(cntrCstNo)">
           AND T10.CNTR_CST_NO = #{cntrCstNo}
        </if>
        <if test='@MybatisUtils@equals(cntrPdEnddtYn,"Y")'>
           AND T11.CNTR_PD_ENDDT IS NOT NULL
        </if>
        )
    </select>

    <select id="selectOrderDetailSpayCntrtPages" resultType="com.kyowon.sms.wells.web.contract.ordermgmt.dvo.WctaOrderDetailSinglePaymentPagesDvo">
        SELECT CONCAT(CONCAT(T10.CNTR_NO, '-'), T10.CNTR_SN) AS CNTR_DTL_NO /* 계약번호 - 계약일련번호 [계약상세번호] */
             , T10.CNTR_NO /* 계약번호 [계약번호] */
             , T10.CNTR_SN /* 계약일련번호 [계약번호] */
             , T10.SELL_TP_CD /* 판매유형코드 */
             , T12.CST_KNM /* 고객한글명 [계약자명] */
             , T12.COPN_DV_CD /* 법인격구분코드(계약자 고객구분 ) 1:개인, 2:법인 */
             , F_CMZ_CD_NM ('TNT_WELLS', 'COPN_DV_CD', T12.COPN_DV_CD) AS COPN_DV_NM /* 고객구분명 [고객구분]*/
               /* 개인인경우 생년월일, 사업자인경우 사업자 등록번호로 조회 하려 했으나 실명구분코드와 실명번호 암호화로 대체 처리하여도 되는지 데이터 확인 후 진행 */
             , T12.BZRNO /* 사업자등록번호(계약자) */
             , T12.BRYY_MMDD /* 생년월일(계약자) */
             , T12.SEX_DV_CD /* 성별구분코드(계약자) */
             , CASE WHEN T12.COPN_DV_CD = '1' /* 계약자 고객구분 1(개인) 인 경우 */
                         THEN T12.BRYY_MMDD
                    WHEN T12.COPN_DV_CD = '2' /* 계약자 고객구분 2(법인) 인 경우 */
                         THEN T12.BZRNO
                    ELSE ''
               END AS RNMNO /* [주민/사업자번호] */
             , T12.RNMNO_DV_CD /* 실명번호구분코드 01:주민등록번호, 02:외국인등록번호, 03:법인등록번호, 04:사업자등록번호, 05:단체고유번호 */
             , T12.RNMNO_ENCR /* 실명번호암호화 */
             , T10.BASE_PD_CD /* 기준상품코드[상품코드] */
               /* 기준상품만을 조건으로 조회하려 했으나 복합상품, 기준상품, 서비스, 교재 제품등 해당 상품 유형이 확인 되지 않아 MAX로 조회 */
             , (
                SELECT MAX(T13.PD_NM) /* 상품기본.상품명 */
                  FROM TB_PDBS_PD_BAS T13 /* 상품기본 */
                 WHERE T13.PD_CD = T10.BASE_PD_CD /* 상품기본.상품코드 = 계약상세.기준상품코드 */
                   AND T13.DTA_DL_YN = 'N' /* 상품기본.데이터삭제여부가 'Y'가 아닌 건 */
               ) AS BASE_PD_NM /* [상품명] */
             , T10.SELL_DSC_DV_CD /* 계약상세.할인적용유형코드 [할인구분]*/
             , F_CMZ_CD_NM(  'TNT_WELLS'
                           , (SELECT CT52.USER_DFN_02 AS ID
                                FROM T_CMZ_CD_D CT52
                               WHERE 1 = 1
                                 AND CT52.CD_ID = 'SELL_DSC_DV_CD'
                                 AND CT52.CD_VLD_VAL = T10.SELL_TP_CD
                                 AND CT52.TENANT_ID = 'TNT_WELLS')
                           , T10.SELL_DSC_DV_CD ) AS SELL_DSC_DV_NM
             , T10.SELL_DSC_TP_CD /* 계약상세.할인적용상세코드 [할인유형] */
             /* 할인유형명 계층형으로 되어있음 */
             , F_CMZ_CD_NM(  'TNT_WELLS'
                           , (SELECT CM2.USER_DFN_02
                                FROM T_CMZ_CD_D CM2
                               WHERE 1 = 1
                                 AND CM2.CD_ID = 'SELL_DSC_TP_CD' --DSC_APY_TP_CD
                                 AND CM2.PRTS_CD_VLD_VAL = T10.SELL_TP_CD
                                 AND CM2.TENANT_ID = 'TNT_WELLS')
                           , T10.SELL_DSC_TP_CD ) AS SELL_DSC_TP_NM
             , T11.CNTR_RCP_FSH_DTM /* 계약기본.계약접수완료일시 [접수일] */
             , T10.SPP_DUEDT /* 계약상세.배송예정일자 [예정일] */
             , T10.CNTR_PD_STRTDT AS SL_DT /* 매출일자는 계약상세.계약상품시작일자로 대체 */
             , CASE WHEN TRIM(T11.CNTR_CAN_DTM) IS NOT NULL /* 계약기본.계약취소일시 값이 있으면 */
                         THEN SUBSTR(TRIM(T11.CNTR_CAN_DTM),1,8) /* 계약상세.계약상품종료일자와 길이 맞춰줌 */
                    ELSE
                         CASE WHEN T10.CNTR_DTL_STAT_CD = '303' /* 계약상세.계약상세상태코드 = '303'(계약취소) TODO: 고객요청해약(301), 연체해약(303) 포함여부 확인 필요 */
                                   THEN T10.CNTR_PD_ENDDT /* 계약상품종료일자 */
                              ELSE ''
                         END
               END AS CNTR_CAN_DT /* 계약취소일 [취소일]
             , T15.CPS_DT /* 계약WELLS상세.보상일자 [보상일] */
             /* 매출경과일 항목 조회 기준 확정 이후 처리 - 해당항목 as-is에 없음
              * as-is LC3000.LCDEMY/LCDEMM/LCDEMD 예정년월일 + 14일
              * to-be 매핑정보 기준 배송예정일자 + 14일 */
             , CASE WHEN TRIM(T10.SPP_DUEDT) IS NOT NULL
                         THEN TO_CHAR(TO_DATE(T10.SPP_DUEDT, 'YYYYMMDD')+14, 'YYYYMMDD')
                    ELSE ''
               END AS SL_PASG_DT /* [매출경과일] */
             , CASE WHEN TRIM(T11.CNTR_CNFM_APR_DTM) IS NOT NULL
                         THEN 'Y'
                    ELSE 'N'
               END SL_CNFM_YN /* [매출확정여부] */
             , T11.CNTR_CAN_RSON_CD /* 계약기본.계약취소사유코드 [취소유형] */
             , F_CMZ_CD_NM ('TNT_WELLS', 'CNTR_CAN_RSON_CD', T11.CNTR_CAN_RSON_CD) AS CAN_RSON_NM /* [취소유형명] */
             , T40.CNTR_CH_RSON_CD AS CNTR_CH_DTL_RSON_CD /* , T10.CNTR_CH_DTL_RSON_CD  계약상세.계약변경상세사유코드 TODO: 계약변경 상세변경상세사유코드 삭제 여부 확인 */
             , F_CMZ_CD_NM ('TNT_WELLS', 'CNTR_CH_RSON_CD', T40.CNTR_CH_RSON_CD) AS CNTR_CH_DTL_RSON_NM /* [계약변경명] TODO: 계약변경 상세변경상세사유코드 삭제 여부 확인 */
             , T10.FRISU_YN /* 계약상세.무상여부 [무료체험여부] */
             , '' AS FRE_EXPN_CNFM_DTM /* TODO : 무료체험 확정일 매핑정보 확인 필요 무료체험기본.무료체험확정일시(TB_SSOP_FRE_EXPN_BAS.FRE_EXPN_CNFM_DTM)가 있으나 JOIN 정보 확인 불가 */
             , T10.CTT_RS_CD AS CTT_RS_CD /* 계약상세.컨택결과코드 [컨택코드] */
             , F_CMZ_CD_NM ('TNT_WELLS', 'LC_CTT_RS_CD', T10.CTT_RS_CD) AS CTT_RS_NM /* 컨택코드명 - 공통코드LC컨택결과코드 참조 [컨택코드명] */
--             , (SELECT MAX(T17.SPP_MTHD_TP_CD) KEEP (DENSE_RANK FIRST ORDER BY T18.SPP_DUEDT DESC NULLS LAST, T17.IOST_DTM DESC NULLS LAST) AS IOST_DTL_CD /* 배송주문기본.배송방식유형코드 */
--                  FROM TB_SSSO_SPP_ORD_DTL T17 /* 배송주문상세 */
--                 INNER JOIN TB_SSSO_SPP_ORD_BAS T18 /* 배송주문기본 */
--                    ON T18.SPP_ORD_NO = T17.SPP_ORD_NO /* 배송주문기본.배송주문번호 = 배송주문상세.배송주문번호 */
--                   AND T18.DTA_DL_YN = 'N'
--                   AND T17.DTA_DL_YN = 'N'
--                 WHERE T17.CNTR_NO = T10.CNTR_NO
--                   AND T17.CNTR_SN = T10.CNTR_SN
--                   AND T18.IOST_TP_CD = '10' /* 배송주문기본.입출고유형코드 = 10(출고) */
--                ) AS IOST_DTL_CD /* 매핑은 배송주문기본.배송방식유형코드(TB_SSSO_SPP_ORD_DTL.SPP_MTHD_TP_CD) [출고구분] */
               , '' AS IOST_DTL_CD /* WELLS 출고 알수 없음 */
--             , (
--                SELECT MAX(T51.SPP_FSH_DT)
--                  FROM TB_SSCT_FGPT_RCP_IZ T19 /* 사은품접수내역 */
--                 INNER JOIN TB_SSSO_SPP_PLAN_BAS T50 /* 배송계획기본 */
--                    ON T50.FGPT_RCP_ID = T19.FGPT_RCP_ID /* 배송계획기본.사은품접수ID = 사은품접수내역.사은품접수ID */
--                   AND T50.CNTR_NO = T19.DTL_CNTR_NO
--                   AND T50.CNTR_SN = T19.DTL_CNTR_SN
--                   AND T50.DTA_DL_YN = 'N'
--                   AND T19.DTA_DL_YN = 'N'
--                 INNER JOIN TB_SSSO_SPP_ORD_DTL T171 /* 배송주문상세 */
--                    ON T171.SPP_PLAN_ID = T50.SPP_PLAN_ID
--                   AND T171.CNTR_NO = T19.DTL_CNTR_NO
--                   AND T171.CNTR_SN = T19.DTL_CNTR_SN
--                   AND T171.DTA_DL_YN = 'N'
--                 INNER JOIN TB_SSOP_SPP_BZS_ULD_HIST T51/* 배송업체업로드이력 */
--                    ON T51.CNTR_NO = T171.CNTR_NO
--                   AND T51.CNTR_SN = T171.CNTR_SN
--                   AND T51.BF_ORD_NO = T171.SPP_ORD_NO
--                   AND T51.DTA_DL_YN = 'N'
--                 WHERE T19.DTL_CNTR_NO = T10.CNTR_NO
--                   AND T19.DTL_CNTR_SN = T10.CNTR_SN
--               ) AS SPP_IVC_CRT_DTM /* 배송업체송장처리내역.배송송장생성일시 [사은품택배송장출력일] */
             , '' AS SPP_IVC_CRT_DTM /* 배송업체송장처리내역.배송송장생성일시 [사은품택배송장출력일] */
             , CASE WHEN TRIM(T10.BOO_SELL_TP_CD) IS NOT NULL THEN 'Y'
                    ELSE 'N'
               END BOO_SELL_YN /* 예약판매여부 계약상세.예약판매유형코드가 있으면 Y 그외 N [예약판매여부] */
             , T11.CNTR_TP_CD /* 계약기본.계약유형코드 */
             , F_CMZ_CD_NM ('TNT_WELLS', 'CNTR_TP_CD', T11.CNTR_TP_CD) AS CNTR_TP_NM /* [판매유형] */
               /* AS-IS 업무담당자 최초등록자 */
             , (SELECT T2.CST_KNM FROM TB_CUBS_CST_BAS T2 WHERE CST_NO = T11.SELL_PRTNR_NO) AS SELL_PRTNR_NM /* [파트너명] */
             , T10.FST_RGST_USR_ID /* 계약상세.최초등록사용자 [업무담당자]*/
             , T32.DGR3_LEVL_OG_CD AS FST_RGST_DEPT_ID /* 계약상세.최초등록부서 [조직코드] */
--             , (SELECT MAX(T53.RVE_CD)
--                  FROM T_CMP_USR_ACO_M T53 /* 사용자기본 */
--                 INNER JOIN TB_OGBS_PRTNR_DTL T52 /* 파트너상세 */
--                    ON T52.PRTNR_NO = T53.EPNO  /* 파트너상세.파트너번호 = 사용자기본.사번 */
--                   AND T53.DEL_YN = 'N'
--                  LEFT OUTER JOIN TB_RVDW_RVE_CD T53 /* 수납코드 */
--                    ON T53.RVE_CD = T52.RVE_CD /* 수납코드.수납코드 = 파트너상세.수납코드 */
--                   AND T53.DTA_DL_YN = 'N'
--                 WHERE T53.USR_ID = T10.FST_RGST_USR_ID /* 사용자기본.사용자ID = 계약상세.최초등록사용자 */
--               ) AS RVE_CD /* [수납코드] */
             , T31.RVE_CD /* [수납코드] */
             , '' AS USWY_DV /* TODO : 용도구분 매핑정보 확인 이후 진행 - AS-IS:LC3000P.LCIUSE */
             , T10.SV_PRD /* 계약상세.서비스주기 [관리주기] */
             , T15.FRISU_AS_PTRM_N /* 계약WELLS상세.무상AS기간수 [무상AS기간] */
             , T15.FRISU_BFSVC_PTRM_N /* 계약WELLS상세.무상BS기간수 [무상멤버십개월] */
             , '' AS RECAP_MSH_YN  /* TODO : 즉시유상멤버십여부 매핑정보 확인 이후 진행 - AS-IS:LC3000P.LCCK05 */
             , F_CMZ_CD_NM('TNT_WELLS', 'ALNCMP_CD', T10.ALNCMP_CD) AS ALNCMP_NM /* 제휴사코드명 [제휴코드명] */
             , T15.SELL_EV_CD /* 계약WELLS상세.판매행사코드 */
             , F_CMZ_CD_NM('TNT_WELLS', 'SELL_EV_CD', T15.SELL_EV_CD) AS SELL_EV_NM /* 판매행사코드명 [행사코드명] */
             , '' AS PKG_ORD_NO  /* 패키지주문번호 매핑정보 없음 AS-IS:LC2280P.LCYEAR||'-'||LC2280P.LCCODE,  LC2280P.LCGUBN = 'B' 일경우 패키지 주문번호를 조회 [패키지주문] */
             , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'PMOT_TP_CD', MAX(PIZ.PMOT_TP_CD)) AS PMOT_TP_NM
                  FROM TB_SSCT_CNTR_PMOT_IZ PIZ /* 계약프로모션내역 */
                 WHERE PIZ.CNTR_UNIT_TP_CD = '020' /* 계약프모션내역.계약단위유형코드 = '020'(계약상세) */
                   AND PIZ.DTL_CNTR_NO = T10.CNTR_NO
                   AND PIZ.DTL_CNTR_SN = T10.CNTR_SN
                   AND PIZ.DTA_DL_YN = 'N'
               ) AS PMOT_TP_NM /* 프로모션유형코드명 [프로모션구분] */
             , T10.FNL_AMT /* 계약상세.최종금액 [계약총액] - 판매금과 동일하여 매핑정보 확인필요 */
             , T10.SELL_AMT /* 계약상세.판매금액 [공급가] */
             , T10.VAT /* 계약상세.부가가치세 [부가세] */
             , T10.CNTR_AMT /* 계약상세.계약금액 [청약금] */
             , 0 AS TK_AMT /* 인수금액 매핑정보 확인 필요 AS-IS:LC3000P.LCAAMT, TO-BE:TB_SSCT_CNTR_PRC_CMPT_IZ.FNL_VAL(계약가격산출내역.최종값) [인수금] */
             , 0 AS CRP_UC_AMT /* 법인미수금액 매핑정보 확인 필요 AS-IS:LC3000P.LCGAMT, TO-BE:TB_CBCL_WELLS_SL_MM_CL_IZ.BTD_UC_AMT/EOT_UC_AMT(WELLS매출월마감내역.기초미수금액/기말미수금액)'20230601' [법인미수금] */
             , 0 AS ALNC_FEE /* 제휴수수료 매핑정보 확인 필요 AS-IS:LC3000P.LCFAMT, TO-BE:TB_SSCT_CNTR_PRC_CMPT_IZ.FNL_VAL(계약가격산출내역.최종값) [제휴수수료] */
             , 0 AS LCJ_AMT /* 현금잔액 매핑정보 확인 필요 AS-IS:LC3000P.LCJAMT, TO-BE:TB_SSCT_CNTR_PRC_CMPT_IZ.FNL_VAL(계약가격산출내역.최종값) [현금잔액] */
             , T10.ISTM_INT_AMT /* 계약상세.할부이자금액 매핑정보 기준 AS-IS:LC3000P.LCCAMT [수수료액] */
             , T10.FEE_ACKMT_BASE_AMT /* 계약상세.수수료인정기준금액 [수수료] */
             , '' AS CRP_UC  /* TODO : 법인미수 매핑정보 확인 이후 진행 - AS-IS:LC3000P.LCGAMT TB_SSCT_CNTR_PRC_CMPT_IZ 확인 */
             , '' AS TOT_DSC_AMT  /* TODO : 총할인금 매핑정보 확인 이후 진행 - AS-IS:LC3000P.LCRAMT 230314 매핑정보 및 계산식이 없음, TB_SSCT_CNTR_PRC_CMPT_IZ 확인 */
             , T10.FEE_ACKMT_CT /* 계약상세.수수료인정건수 [인정건수] */
             , T10.ACKMT_PERF_AMT /* 계약상세.인정실적금액(최종금액비율안분) [총인정금] */
             , T10.FEE_ACKMT_BASE_AMT AS FEE_ACKMT_TOT_AMT /* 계약상세.수수료인정기준금액 [총기준수수료] */
             , T10.FEE_FXAM_YN /* 계약상세.수수료정액여부 [수수료정액여부] */
             , '' AS PD_SALE_FEE  /* TODO : 판매수수료 매핑정보 확인 이후 진행 - AS-IS:LC3000P.LCFAMT, TB_SSCT_CNTR_PRC_CMPT_IZ 확인 */
             , '' AS CASH_BLAM /* TODO : 현금잔액 매핑정보 확인 이후 진행 - AS-IS:LC3000P.LCJAMT TB_SSCT_CNTR_PRC_CMPT_IZ 확인 */
             , T10.ISTM_MCN /* 계약상세.할부개월수 [할부개월수] */
             , T10.MM_ISTM_AMT /* 계약상세.월할부금액 [월할부금] */
             , T10.ISTM_PCAM_AMT /* 계약상세.할부원금액(최종금액비율안분) [총할부금액] */
             , T11.CNTR_CST_NO /* 계약기본.계약고객번호 [고객번호] */
             , T12.CRAL_LOCARA_TNO /* 휴대지역전화번호(계약자) [계약자휴대전화번호] */
             , T12.MEXNO_ENCR /* 휴대전화국번호암호화(계약자) [계약자휴대전화번호] */
             , T12.CRAL_IDV_TNO /* 휴대개별전화번호(계약자) [계약자휴대전화번호] */
             , T60.NEW_ADR_ZIP /* 주소기본.신주소우편번호(계약자) [우편번호]*/
             , T60.RNADR /* 주소기본.도로명주소(계약자) [계약자 기준주소] */
             , T60.RDADR /* 주소기본.도로명상세주소(계약자) [계약자 상세주소] */
             , T63.RCGVP_KNM /* 수령자한글명 [설치자명] */
             , T63.CRAL_LOCARA_TNO AS ISTLC_CRAL_LOCARA_TNO/* 휴대지역전화번호 [설치자 휴대전화번호] */
             , T63.MEXNO_ENCR AS ISTLC_MEXNO_ENCR /* 휴대전화국번호암호화 [설치자 휴대전화번호] */
             , T63.CRAL_IDV_TNO AS ISTLC_CRAL_IDV_TNO /*휴대개별전화번호 [설치자 휴대전화번호] */
             , NVL2(T63.NEW_ADR_ZIP, T63.NEW_ADR_ZIP, T63.OLD_ADR_ZIP) AS ISTLC_ADR_ZIP /* [설치자우편번호] */
             , NVL2(T63.RNADR, T63.RNADR, T63.LTN_ADR) AS ISTLC_ADR /* [설치자 기준주소] */
             , NVL2(T63.RDADR, T63.RDADR, T63.LTN_DTL_ADR) AS ISTLC_DADR /* [설치자 상세주소] */
               /* TODO : 결합구분 AS-IS LC3000P.LCST04: 1(모종결합), H(홈케어), M(홈케어멤버십) → 결합구분에 대해 확인 할 수 없으므로 AS-IS와 동일하게 체크 */
             , F_CMZ_CD_NM('TNT_WELLS', 'CNTR_REL_DTL_CD',
               (SELECT MAX(CNTR_REL_DTL_CD) /* 계약관계상세코드 */
                  FROM TB_SSCT_CNTR_REL T64 /* 계약관계 */
                 WHERE T64.CNTR_UNIT_TP_CD = '020' /* 계약관계.계약단위유형코드 = '020'(계약상세) */
                   AND T64.BASE_DTL_CNTR_NO = T10.CNTR_NO /* 기준상세계약번호 */
                   AND T64.BASE_DTL_CNTR_SN = T10.CNTR_SN/* 기준상세계약일련번호*/
                   AND T64.DTA_DL_YN = 'N'
                   AND T64.CNTR_REL_DTL_CD IN ( '216', '219', '221' ) /* 216(모종결합), 219(홈케어), 221(홈페이멤버십)  */
                 )) AS CNTR_REL_DTL_NM /* 계약관계상세코드명 [결합구분]*/
             , T10.ALNCMP_CNTR_DRM_VAL   /* 제휴사계약식별값(LCCK11+LCCK12+LCCK13) MKN*/
             , F_CMZ_CD_NM('TNT_WELLS', 'ALNCMP_CD', T65.ALNCMP_CD) AS ALNCMP_CD /* 제휴사코드명 [제휴코드] */
             , (SELECT MAX(T66.ALNC_PRTNR_DRM_VAL) KEEP (DENSE_RANK FIRST ORDER BY T66.VL_END_DTM DESC NULLS LAST) AS ALNC_PRTNR_DRM_VAL /* 제휴파트너 식별값  */
                  FROM TB_SSCT_CNTR_PRTNR_REL T66 /* 계약파트너관계 */
                 WHERE T66.CNTR_NO = T10.CNTR_NO
                   AND T66.DTA_DL_YN = 'N'
                   AND T66.CNTR_PRTNR_TP_CD IN ('040') /* 계약파트너유형코드 : 대리계약판매자(040)   MKN */
                   AND T66.VL_END_DTM = '99991231235959'
               ) AS ALNC_PRTNR_DRM_VAL /* 제휴판매자코드 */
             , '' AS SPC_ORD_DV  /* TODO : 특별주문구분 매핑정보 확인 이후 진행 - AS-IS:LC3000P.LCET01 P(K포인트), W(W머니), V(W포인트) */
--             , (SELECT MAX(T172.SPP_ORD_IVC_NO) KEEP (DENSE_RANK FIRST ORDER BY T181.SPP_DUEDT DESC NULLS LAST) AS SPP_ORD_IVC_NO /* 배송주문송장번호 */
--                  FROM TB_SSSO_SPP_ORD_DTL T172 /* 배송주문상세 */
--                 INNER JOIN TB_SSSO_SPP_ORD_BAS T181 /* 배송주문기본 */
--                    ON T181.SPP_ORD_NO = T172.SPP_ORD_NO /* 배송주문기본.배송주문번호 = 배송주문상세.배송주문번호*/
--                   AND T172.DTA_DL_YN = 'N'
--                   AND T181.DTA_DL_YN = 'N'
--                 WHERE T172.CNTR_NO = T10.CNTR_NO
--                   AND T172.CNTR_SN = T10.CNTR_SN
--               ) AS SPP_ORD_IVC_NO /* 배송주문송장번호 [송장정보] */
             , '' AS SPP_ORD_IVC_NO /* 배송주문송장번호 [송장정보] */
             , (
                SELECT MAX(T131.PD_ABBR_NM) /* 상품기본.상품명 */
                  FROM TB_PDBS_PD_BAS T131 /* 상품기본 */
                 WHERE T131.PD_CD = T10.BASE_PD_CD /* 상품기본.상품코드 = 계약상세.기준상품코드 */
                   AND T131.DTA_DL_YN = 'N'
               ) ||'('||T10.BASE_PD_CD||'):'||T10.PD_QTY AS BASE_PD_INFO /* [상품명]  MKN */
             , T10.BASE_PD_CD AS BASE_PD_CD2 /* [상품코드] */
             , T10.PD_QTY /* [상품수량] */
             , T69.FGPT_PD_NM1 /* [사은품1] */
             , T69.FGPT_PD_NM2 /* [사은품2] */
             , T69.FGPT_PD_NM3 /* [사은품3] */
             , T69.FGPT_PD_NM4 /* [사은품4] */
             , T15.BFSVC_BZS_DV_CD /* BS업체구분코드 */
             , F_CMZ_CD_NM('TNT_WELLS', 'BFSVC_BZS_DV_CD', T15.BFSVC_BZS_DV_CD) AS BFSVC_BZS_DV_NM /* BS업체구분코드명 [업체BS구분] */
             , T15.SPLY_BZS_DV_CD /* 조달업체구분코드 */
             , F_CMZ_CD_NM('TNT_WELLS', 'SPLY_BZS_DV_CD', T15.SPLY_BZS_DV_CD) AS SPLY_BZS_DV_NM /* 조달업체구분코드명 [업체구분] */
             , T11.CNTR_CAN_DTM /* 계약취소일시 */
          FROM TB_SSCT_CNTR_DTL T10 /* 계약상세 */
         INNER JOIN TB_SSCT_CNTR_BAS T11 /* 계약기본 */
            ON T10.CNTR_NO = T11.CNTR_NO /* 계약상세.계약번호 = 계약기본.계약번호  */
           AND T10.DTA_DL_YN = 'N' /* 계약상세.데이터삭제여부 = 'N' */
           AND T11.DTA_DL_YN = 'N' /* 계약기본.데이터삭제여부 = 'N' */
         INNER JOIN TB_CUBS_CST_BAS T12 /* 고객기본 */
            ON T12.CST_NO = T11.CNTR_CST_NO /* 고객기본.고객번호 = 계약기본.계약고객번호 */
           AND T12.DTA_DL_YN = 'N' /* 고객기본.데이터삭제여부 = 'N' */
           AND T12.TEMP_SAVE_YN = 'N' /* 고객기본.임시저장여부 = 'N' */
          LEFT OUTER JOIN TB_SSCT_CNTR_WELLS_DTL T15 /* 계약WELLS상세 */
            ON T15.CNTR_NO = T10.CNTR_NO
           AND T15.CNTR_SN = T10.CNTR_SN
         LEFT OUTER JOIN TB_PDBS_PD_BAS T20         /* T.상품기본 -  */
           ON T20.PD_CD = T10.BASE_PD_CD             /* 상품코드 */
          AND T20.TEMP_SAVE_YN = 'N'                /* 임시저장여부 */
          AND T20.DTA_DL_YN = 'N'                   /* 데이터삭제여부 */
         LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS T21    /* T.상품분류기본 상품분류 */
           ON T21.PD_CLSF_ID = T20.PD_CLSF_ID        /* 상품분류ID */
          AND T21.DTA_DL_YN = 'N'
         LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ T30         /* T.월파트너내역 - 판매자 */
           --ON T30.BASE_YM = TO_CHAR(SYSDATE, 'YYYYMM')
           ON T30.BASE_YM = SUBSTR(T11.CNTR_CNFM_DTM,1,6)
          AND T30.OG_TP_CD = T11.SELL_OG_TP_CD
          AND T30.PRTNR_NO = T11.SELL_PRTNR_NO
          AND T30.DTA_DL_YN = 'N'
         LEFT OUTER JOIN TB_OGBS_PRTNR_DTL T31         /* T.파트너상세  - 판매자 (수납코드) */
           ON T31.OG_TP_CD = T11.SELL_OG_TP_CD
          AND T31.PRTNR_NO = T11.SELL_PRTNR_NO
          AND T31.DTA_DL_YN = 'N'
         LEFT OUTER JOIN TB_OGBS_MM_OG_IZ T32         /* T.월조직내역 - 지점장 (조직정보) */
           --ON T32.BASE_YM = TO_CHAR(SYSDATE, 'YYYYMM')
           ON T32.BASE_YM = SUBSTR(T11.CNTR_CNFM_DTM,1,6)
          AND T32.OG_ID = T30.OG_ID
          AND T32.DTA_DL_YN = 'N'
         LEFT OUTER JOIN TB_SSCT_CNTR_CH_RCP_DTL T40         /* T.계약변경접수상세 - 계약변경사유코드 */
           ON T40.DTL_CNTR_NO = T10.CNTR_NO
          AND T40.DTL_CNTR_SN = T10.CNTR_SN
          AND T40.DTA_DL_YN = 'N'                   /* 데이터삭제여부 */
         LEFT OUTER JOIN TB_GBCO_ADR_BAS T60 /* 주소기본 - 계약자의 주소정보를 참조 */
           ON T60.ADR_ID = T12.ADR_ID
          AND T60.DTA_DL_YN = 'N'
         LEFT OUTER JOIN LATERAL
            (
             SELECT T61.CNTR_NO
                  , T61.DTL_CNTR_NO
                  , T61.DTL_CNTR_SN
                  , T62.RCGVP_KNM /* 수령자한글명 */
                  , T62.CRAL_LOCARA_TNO /* 휴대지역전화번호 */
                  , T62.MEXNO_ENCR /* 휴대전화국번호암호화 */
                  , T62.CRAL_IDV_TNO /*휴대개별전화번호 */
                  , T62.ADR_DV_CD /* 주소구분코드*/
                  , TRIM(T601.NEW_ADR_ZIP) AS NEW_ADR_ZIP /* 신주소우편번호 */
                  , TRIM(T601.RNADR) AS RNADR /* 도로명주소 */
                  , TRIM(T601.RDADR) AS RDADR /* 도로명상세주소 */
                  , TRIM(T601.OLD_ADR_ZIP) AS OLD_ADR_ZIP /* 구주소우편번호 */
                  , TRIM(T601.LTN_ADR) AS LTN_ADR /* 지번주소 */
                  , TRIM(T601.LTN_DTL_ADR) AS LTN_DTL_ADR /* 지번상세주소 */
               FROM TB_SSCT_CNTR_ADR_REL T61 /* 계약주소관계 */
              INNER JOIN TB_SSCT_CNTR_ADRPC_BAS T62/* 계약주소지기본 */
                 ON T62.CNTR_NO = T61.DTL_CNTR_NO
                AND T62.CNTR_ADRPC_ID = T61.CNTR_ADRPC_ID /* 계약주소지기본.계약주소지ID = 계약주소관계.계약주소지ID */
              INNER JOIN TB_GBCO_ADR_BAS T601 /* 주소 기본 */
                 ON T601.ADR_ID = T62.ADR_ID
              WHERE T61.DTL_CNTR_NO = T10.CNTR_NO
                AND T61.DTL_CNTR_SN = T10.CNTR_SN
                AND T61.CNTR_UNIT_TP_CD = '020' /* 계약주소관계.계약단위유형코드 */
                AND T61.ADRPC_TP_CD = '3' /* 주소지유형코드 = '3'(설치처) */
                AND T61.DTA_DL_YN = 'N'
                AND T601.DTA_DL_YN = 'N'
                AND T62.DTA_DL_YN = 'N'
            ) T63
           ON T63.DTL_CNTR_NO = T10.CNTR_NO
          AND T63.DTL_CNTR_SN = T10.CNTR_SN
         LEFT OUTER JOIN TB_SSCT_ACMPAL_CNTR_IZ T65 /* 관계사제휴계약내역 */
           ON T65.BASE_CNTR_NO = T10.CNTR_NO
          AND T65.BASE_CNTR_SN = T10.CNTR_SN
          AND T65.DTA_DL_YN = 'N'
          AND T65.ALNC_STAT_TP_CD = '10' /* 제휴상태유형코드 = '10'(제휴정상) */
         LEFT OUTER JOIN LATERAL /* 사은품 4개까지 */
              (
               SELECT T68.DTL_CNTR_NO
                    , T68.DTL_CNTR_SN
                    , MAX(T68.FGPT_PD_NT52) AS FGPT_PD_NM1
                    , MAX(T68.FGPT_PD_NM2) AS FGPT_PD_NM2
                    , MAX(T68.FGPT_PD_NM3) AS FGPT_PD_NM3
                    , MAX(T68.FGPT_PD_NM4) AS FGPT_PD_NM4
                 FROM (
                       SELECT T67.DTL_CNTR_NO
                            , T67.DTL_CNTR_SN
                            , CASE WHEN ROWNUM = 1
                                        THEN T67.FGPT_PD_NM
                                   ELSE ''
                              END FGPT_PD_NT52
                            , CASE WHEN ROWNUM = 2
                                        THEN T67.FGPT_PD_NM
                                   ELSE ''
                              END FGPT_PD_NM2
                            , CASE WHEN ROWNUM = 3
                                        THEN T67.FGPT_PD_NM
                                   ELSE ''
                              END FGPT_PD_NM3
                            , CASE WHEN ROWNUM = 4
                                        THEN T67.FGPT_PD_NM
                                   ELSE ''
                              END FGPT_PD_NM4
                         FROM
                              (
                               SELECT T191.DTL_CNTR_NO
                                    , T191.DTL_CNTR_SN
                                    , T191.FGPT_PD_CD /* 사은품상품코드 */
                                    , (
                                       SELECT MAX(T132.PD_NM) /* 상품기본.상품명 */
                                         FROM TB_PDBS_PD_BAS T132 /* 상품기본 */
                                        WHERE T132.PD_CD = T191.FGPT_PD_CD /* 상품기본.상품코드 = 계약상세.기준상품코드 */
                                          AND T132.DTA_DL_YN = 'N'
                                      ) AS FGPT_PD_NM /* [상품명] */
                                 FROM TB_SSCT_FGPT_RCP_IZ T191 /* 사은품접수내역 */
                                INNER JOIN TB_SSSO_SPP_PLAN_BAS T501 /* 배송계획기본 */
                                   ON T501.FGPT_RCP_ID = T191.FGPT_RCP_ID /* 배송계획기본.사은품접수ID = 사은품접수내역.사은품접수ID */
                                  AND T501.DTA_DL_YN = 'N'
                                  AND T191.DTA_DL_YN = 'N'
                                  AND T501.CNTR_NO = T191.DTL_CNTR_NO
                                  AND T501.CNTR_SN = T191.DTL_CNTR_SN
                                INNER JOIN TB_SSSO_SPP_ORD_DTL T173 /* 배송주문상세 */
                                   ON T173.SPP_PLAN_ID = T501.SPP_PLAN_ID
                                  AND T173.CNTR_NO = T191.DTL_CNTR_NO
                                  AND T173.CNTR_SN = T191.DTL_CNTR_SN
                                  AND T173.DTA_DL_YN = 'N'
                                INNER JOIN TB_SSSO_SPP_ORD_BAS T182 /* 배송주문기본 */
                                   ON T182.SPP_ORD_NO = T173.SPP_ORD_NO
                                  AND T182.DTA_DL_YN = 'N'
                                  AND T173.SPP_PRGS_STAT_CD = '70' /* 배송진행상태코드 = '70'(배송완료) */
                                WHERE T191.DTL_CNTR_NO = T10.CNTR_NO
                                  AND T191.DTL_CNTR_SN = T10.CNTR_SN
                                ORDER BY T191.FGPT_PD_CD
                              ) T67
                        WHERE ROWNUM <![CDATA[ <= ]]> 4
                      ) T68
                GROUP BY T68.DTL_CNTR_NO, T68.DTL_CNTR_SN
              ) T69
           ON T69.DTL_CNTR_NO = T10.CNTR_NO
          AND T69.DTL_CNTR_SN = T10.CNTR_SN
        WHERE 1=1
          AND T10.SELL_TP_CD = '1' /* 계약상세.판매유형코드 = '1' (일시불/할부) */
        <if test='@MybatisUtils@equals(searchGbn,"1")'>
          AND T12.BRYY_MMDD = #{bryyMmdd}
            <if test='@MybatisUtils@equals(sexGbn,"M")'>
                AND T12.SEX_DV_CD IN ('1','3')
            </if>
            <if test='@MybatisUtils@equals(sexGbn,"F")'>
                AND T12.SEX_DV_CD IN ('2','4')
            </if>
        </if>
        <if test='@MybatisUtils@equals(searchGbn,"2")'>
          AND T12.BZRNO = #{bzrno}
        </if>
        <if test='@MybatisUtils@equals(searchGbn,"3")'>
          AND T12.BZRNO = #{bzrno}
        </if>
        <if test='@MybatisUtils@isNotEmpty(cstKnm)'>
          AND T12.CST_KNM LIKE '%'||#{cstKnm}||'%'
        </if>
        <if test='@MybatisUtils@isNotEmpty(cralLocaraTno)'>
          AND T12.CRAL_LOCARA_TNO = #{cralLocaraTno}
        </if>
        <if test="@MybatisUtils@isNotEmpty(mexnoEncr)">
          AND T12.MEXNO_ENCR = #{mexnoEncr}
        </if>
        <if test="@MybatisUtils@isNotEmpty(cralIdvTno)">
          AND T12.CRAL_IDV_TNO = #{cralIdvTno}
        </if>
        <if test='@MybatisUtils@isNotEmpty(cntrCstNo)'>
          AND T11.CNTR_CST_NO LIKE #{cntrCstNo}||'%'
        </if>
        <if test='@MybatisUtils@equals(cntrCanYn,"Y")'>
          AND T11.CNTR_CAN_DTM IS NULL
        </if>
        <if test="@MybatisUtils@isNotEmpty(cntrNo)">
          AND T10.CNTR_NO = #{cntrNo}
        </if>
        <if test="@MybatisUtils@isNotEmpty(cntrSn)">
          AND T10.CNTR_SN = #{cntrSn}
        </if>
        <if test="@MybatisUtils@isNotEmpty(prdEnqry)">
            <choose>
                <when test='@MybatisUtils@equals(prdEnqry, "1")'> /* 접수일 */
                    AND T11.CNTR_RCP_FSH_DTM BETWEEN #{strtDt}||'000000' AND #{endDt}||'235959'
                </when>
                <when test='@MybatisUtils@equals(prdEnqry, "2")'> /* 매출일 */
                    AND T15.IST_DT BETWEEN #{strtDt} AND #{endDt}
                </when>
                <when test='@MybatisUtils@equals(prdEnqry, "3")'> /* 취소일 */
                    AND T11.CNTR_CAN_DTM BETWEEN #{strtDt}||'000000' AND #{endDt}||'235959'
                </when>
            </choose>
        </if>
        <if test="@MybatisUtils@isNotEmpty(hcsfVal)"> /* 상품분류(대분류) */
           AND T21.REF_PD_CLSF_VAL LIKE #{hcsfVal} || '%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(hcsfMcsfVal)"> /* 상품분류(소분류) */
           AND T21.REF_PD_CLSF_VAL LIKE #{hcsfMcsfVal} || '%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(pdCd)"> /* 상품코드 */
           AND T10.BASE_PD_CD LIKE '%' || #{pdCd} || '%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(pdNm)"> /* 상품명 */
           AND T20.PD_NM LIKE '%' || #{pdNm} || '%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(alncmpCd)"> /* 제휴코드 */
           AND T65.ALNCMP_CD = #{alncmpCd}
        </if>
        <if test="@MybatisUtils@isNotEmpty(sellEvCd)"> /* 행사코드 */
           AND T15.SELL_EV_CD = #{sellEvCd}
        </if>
        <if test="@MybatisUtils@isNotEmpty(etcDv)"> /* 기타 */
            <foreach collection="etcDv" item="codeId" separator="">
              <if test='@MybatisUtils@equals(codeId,"1")'>
                 AND T40.CNTR_CH_RSON_CD IS NOT NULL
              </if>
              <if test='@MybatisUtils@equals(codeId,"2")'>
                 AND T10.FRISU_YN = 'Y'
              </if>
              <if test='@MybatisUtils@equals(codeId,"3")'>
                 AND TRIM(T10.BOO_SELL_TP_CD) IS NOT NULL
              </if>
            </foreach>
        </if>
        <if test="@MybatisUtils@isNotEmpty(sellPrtnrNo)"> /* 파트너코드 */
           AND T11.SELL_PRTNR_NO = #{sellPrtnrNo}
        </if>
        <if test="@MybatisUtils@isNotEmpty(dgr1LevlOgId)"> /* 조직코드(총괄단) */
           AND T32.DGR1_LEVL_OG_ID IN (
            <foreach collection="dgr1LevlOgId" item="codeId" separator=",">
                   #{codeId}
            </foreach>
               )
        </if>
        <if test="@MybatisUtils@isNotEmpty(dgr2LevlOgId)"> /* 조직코드(지역단) */
           AND T32.DGR2_LEVL_OG_ID IN (
            <foreach collection="dgr2LevlOgId" item="codeId" separator=",">
                   #{codeId}
            </foreach>
               )
        </if>
        <if test="@MybatisUtils@isNotEmpty(dgr3LevlOgId)"> /* 조직코드(지점) */
           AND T32.DGR3_LEVL_OG_ID IN (
            <foreach collection="dgr3LevlOgId" item="codeId" separator=",">
                   #{codeId}
            </foreach>
               )
        </if>
        <if test="@MybatisUtils@isNotEmpty(sellOgTpCd)"> /* 조직구분 */
           AND T11.SELL_OG_TP_CD IN (
            <foreach collection="sellOgTpCd" item="codeId" separator=",">
                   #{codeId}
            </foreach>
               )
        </if>
    </select>

    <select id="selectOrderRegularShippingsPages" resultType="com.kyowon.sms.wells.web.contract.ordermgmt.dvo.WctaOrderDetailRglrDlvrPagesDvo">
        SELECT *
          FROM (
        SELECT /*+ LEADING(T10) NO_MERGE(T25) PUSH_PRED(T25)
                   USE_NL(T10 T11 T12 T14 T15 T18 T20 T21 T24 T25 T30 T32 T33 T34 T40 T41 T43 T44 T45 T80) */
               CONCAT(CONCAT(T11.CNTR_NO, '-'), T11.CNTR_SN) AS CNTR_DTL_NO     /* 계약번호 - 계약일련번호 [계약상세번호] */
             , T11.SELL_TP_CD                                                   /* 판매유형코드 */
             , CASE WHEN T33.OG_LEVL_DV_CD = 2 THEN T33.DGR2_LEVL_DG_PRTNR_NO
                    WHEN T33.OG_LEVL_DV_CD = 1 THEN T33.DGR1_LEVL_DG_PRTNR_NO
                    ELSE T33.DGR3_LEVL_DG_PRTNR_NO END AS DGR3_LEVL_DG_PRTNR_NO /* 지점장사번(LCDBON) - 지점장ID  */
             , CASE WHEN T33.OG_LEVL_DV_CD = 2 THEN T33.DGR2_LEVL_DG_PRTNR_NM
                    WHEN T33.OG_LEVL_DV_CD = 1 THEN T33.DGR1_LEVL_DG_PRTNR_NM
                    ELSE T33.DGR3_LEVL_DG_PRTNR_NM END AS DGR3_LEVL_DG_PRTNR_NM /* 지점장명(AKDBNM) */
             , CASE WHEN T33.OG_LEVL_DV_CD = 2 THEN T33.DGR2_LEVL_OG_CD
                    WHEN T33.OG_LEVL_DV_CD = 1 THEN T33.DGR1_LEVL_OG_CD
                    ELSE T33.DGR3_LEVL_OG_CD END AS DGR3_LEVL_OG_CD             /* 지점코드(LCDDPT)  조직코드*/
             , T10.SELL_OG_TP_CD                    /* 조직구분 : 계약기본@판매조직유형코드 P,M, 전체 라디오 */
             , T10.SELL_PRTNR_NO                    /* 판매자사번 (LCDCDE) 파트너 사번 */
             , T30.PRTNR_KNM                        /* 판매자명(LCDNAM) 파트너 명 */
             , T40.CRAL_LOCARA_TNO || '-' || T40.MEXNO_ENCR || '-' || T40.CRAL_IDV_TNO  AS SELL_PRTNR_CRAL_TNO /* 배송지 - 휴대전화번호(파라미터) */
             , T40.CRAL_LOCARA_TNO                  /* 판매자-휴대지역전화번호 (LCDTEL) - ASIS는 구매부테이블(TL0000P)에서도 참고함(TL0000P/AK0400P/AK0100P 파트너   휴대전화번호 */
             , T40.MEXNO_ENCR                       /* 판매자-휴대전화국번호암호화 (LCDTEL) */
             , T40.CRAL_IDV_TNO                     /* 판매자-휴대개별전화번호 (LCDTEL) */
             , T40.CST_KNM                                          /* 계약자정보 - 고객명(LCCNAM) */
             , DECODE(T40.COPN_DV_CD, '1', T40.BRYY_MMDD, T40.BZRNO ) AS CST_NO /* 개인:생년월일, 법인:사업자번호 LCCINO */
             , T41.NEW_ADR_ZIP AS ADR_ZIP                            /* 계약자정보 - 우편번호 : LCCZIP */
             , T41.RNADR  AS CNTR_CST_RNADR                          /* 계약자정보 - 기준주소 : LCCAD1 */
             , T41.RDADR  AS CNTR_CST_RDADR                          /* 계약자정보 - 상세주소 : LCCAD1 LCCAD1 */
             , T44.RCGVP_KNM                                         /* 수령자한글명 - 설치처정보 - 설치자　명(LCWNAM) */
             , T44.CRAL_LOCARA_TNO || '-' || T44.MEXNO_ENCR || '-' || T44.CRAL_IDV_TNO  AS SHPADR_CRAL_TNO /* 배송지 - 휴대전화번호(파라미터) */
             , T44.CRAL_LOCARA_TNO   AS SHPADR_CRAL_LOCARA_TNO      /* 배송지 - 휴대전화번호1 LCWNOT */
             --, T44.EXNO_ENCR        AS SHPADR_MEXNO_ENCR           /* 배송지 - 휴대전화번호2 */
             , NVL(T44.MEXNO_ENCR,'') AS SHPADR_MEXNO_ENCR           /* 배송지 - 휴대전화번호2 */
             , T44.CRAL_IDV_TNO      AS SHPADR_CRAL_IDV_TNO         /* 배송지 - 휴대전화번호3 */
             , T45.NEW_ADR_ZIP      AS SHPADR_ADR_ZIP                  /* 배송지 - 우편번호 : LCWZIP */
             , T45.RNADR            AS SHPADR_RNADR                    /* 배송지 - 기준주소 : LCWAD1 */
             , T45.RDADR            AS SHPADR_RDADR                    /* 배송지 - 상세주소 : LCWAD2 */
             , F_CMZ_CD_NM('TNT_WELLS', 'SELL_CHNL_DTL_CD', T10.SELL_INFLW_CHNL_DTL_CD) AS SELL_INFLW_CHNL_DTL_NM       /* 판매유입채널상세코드 - (판매구분:LCSALE_NM, LCSALE)*/
             , CASE WHEN T10.SELL_INFLW_CHNL_DTL_CD IN ('9020','9040')
                    THEN (SELECT EMP_DV_VAL
                            FROM TB_GBCO_EMP_BAS /* T.직원기본 */
                          WHERE SAP_EMPNO = T10.SELL_PRTNR_NO
                            AND DTA_DL_YN = 'N')
                    ELSE '' END AS EMP_DV_VAL /* (직원구분:LCST08_NM) 직원구매,직원판매(ASIS:LCSALE-8,9) 경우 직원구분을 표시 */
             , T10.COPN_DV_CD /* 법인격구분코드(계약자 고객구분 ) 1:개인, 2:법인 */
             , F_CMZ_CD_NM('TNT_WELLS', 'COPN_DV_CD', T40.COPN_DV_CD) AS COPN_DV_NM     /* 계약자구분-법인격구분코드 - (고객구분:LCCGUB)*/
             , T14.SELL_TP_CD ||'.' || F_CMZ_CD_NM('TNT_WELLS', 'SELL_TP_CD', T14.SELL_TP_CD ) AS MCHN_SELL_TP_NM /* 기기정보-판매유형(원주문) (업무구분:LCJTYP,LCJTYP_NM) */
             , T14.CNTR_NO      AS MCHN_CNTR_NO                                         /* 기기정보-계약번호  ORYRCD*/
             , T14.CNTR_SN      AS MCHN_CNTR_SN                                         /* 기기정보-계약번호일련번호 ORYRCD(LCJYER-LCJCOD) */
             , T16.RCGVP_KNM    AS MCHN_RCGVP_KNM                                       /* 기기정보- 수령자한글명 ORCNAM(LCCNAM) */
             , T14.BASE_PD_CD   AS MCHN_PD_CD                                           /* 기기정보- 기기상품 - ORICDE(LCICDE) */
             , T16.PD_NM        AS MCHN_PD_NM                                           /* 기기정보- 기기상품명 - ORINA3 (LCICDE,KAINA1) */
             , F_CMZ_CD_NM('TNT_WELLS', 'SV_TP_CD', T16.SV_PD_TP_CD) AS MCHN_SV_TP_NM   /* 용도구분 - 상품의 서비스유형 (용도구분명:ORIUSE_NM, LCIUSE) */
             , T14.SV_PRD       AS MCHN_SV_PRD              /* 기기정보- 서비스주기 (관리주기:ORIMON, LCIMON)*/
             --, T16.PD_MCLSF_NM  AS MCHN_PD_MCLSF_NM         /* 기기정보-상품중분류 기기종류:LCPRD1_NM, LCPRD1 (웰스팜, 커피머신) */
             , F_CMZ_CD_NM('TNT_WELLS', 'SELL_TP_DTL_CD', T11.SELL_TP_DTL_CD) AS MCHN_PD_MCLSF_NM   /* 기기정보-상품중분류 기기종류:LCPRD1_NM, LCPRD1 (웰스팜, 커피머신) */
             , T16.PD_DCLSF_NM  AS MCHN_PD_LCLSF_NM         /* 기기정보-상품소분류 기기구분:LCPRD2_NM , LCPRD2*/
             , F_CMZ_CD_NM('TNT_WELLS', 'PD_TP_CD', T20.PD_TP_CD) AS PD_TP_CM           /* 상품유형코드(C:복합-패키지) - 제품선택유형(LCST09)*/
             , T11.STPL_PTRM                                                            /* 유상의무기간수 - (의무기간:LCDUTY)*/
             , T11.CNTR_PTRM                                                            /* 약정기간 - (계약기간:LCMONT) */
             , T11.FNL_AMT                                                              /* 최종금액 - (판매가격:LCTAMT) */
             , T11.CNTR_AMT - T11.VAT AS SELL_AMT                                       /* 공급가 - (공급가:LCNAMT) = 계약총액 - 부가세*/
             , T11.VAT                                                                  /* 부가세 - (부가세:LCIVAT) */
             , T11.CNTR_AMT                                                             /* 계약금액 - (계약총액:LCQAMT) */
             , T11.CNTR_AMT / T11.SV_PRD AS MM_BIL_AMT                                  /* 계약총액 / 서비스주기 : 월청구액:LCMAMT = (M.LCTAMT - M.LCRAMT) / M.LCIMON ) */
             , T11.PD_BASE_AMT                                                          /* 상품기준금액 - (제품정상가격:LCIAMT) */
             , T11.ACKMT_PERF_RT                                                        /* 인정실적율(LCPRAT) */
             , T11.ACKMT_PERF_AMT                                                       /* 인정실적액(LCPAMT) */
             , '' AS DSC_MCN                                                            /* 할인개월(LD3000P@LCDMON) TODO.맵핑문의(특성,맵핑없음) */
             , T11.DSC_AMT AS CTR_AMT                                                   /* 조정값 (할인금액:LD3000P@LCDAMT) TODO.문의해야함. */
             , F_CMZ_CD_NM('TNT_WELLS', 'SV_TP_CD', T20.SV_PD_TP_CD ) AS SV_TP_NM       /* 용도구분 - 상품의 서비스유형 (용도구분명:LCIUSE_NM, LCIUSE) TODO.재확인필요*/
             , CASE WHEN T21.REF_PD_CLSF_VAL LIKE '05001002%' THEN 'Y'                  /* 스페셜판매-씨앗 */
                    ELSE '' END AS SPC_YN                                               /* 스페셜 구분:LCCK04 TOBE맵핑없어서 판매상품중에서 스페셜을 찾음 */
             , T11.SV_PRD                                                                               /* 상품정보 - 서비스주기 (배송주기:LCIMON) */
             --, SUBSTR(T46.SPP_FSH_DTM, 7, 2) AS SPP_FSH_DT                                              /* 배송완료일시 - 배송일자(LCDDAY) 일만표시 */
             , '' AS SPP_FSH_DT                                                                         /* 배송완료일시 - 배송일자(LCDDAY) 일만표시 */
             , F_CMZ_CD_NM('TNT_WELLS', 'SPP_MTHD_TP_CD', T43.SPP_MTHD_TP_CD) AS SPP_MTHD_TP_NM         /* 배송방식유형코드 (배송구분: LCTGUB_NM, LCTGUB)*/
             , '' AS LCTJOB_NM                                                                          /* 배송부서 LCTJOB_NM LD3000P@LCTJOB 데이터미존재로 TOBE 미사용 항목. TODO.화면에서 삭제 요청 */
             , F_CMZ_CD_NM('TNT_WELLS', 'RGLR_SPP_BIL_DV_CD', (SELECT PD_PRP_VAL10
                                                                 FROM TB_PDBS_PD_ECOM_PRP_DTL
                                                                WHERE PD_CD = T11.BASE_PD_CD
                                                                  AND PD_EXTS_PRP_GRP_CD = 'CNTR') ) AS RGLR_SPP_BIL_DV_NM   /* 청구구분(후납/ 당월납) LD3000P@LCIPAY, LCIPAY_NM */
             , F_CMZ_CD_NM('TNT_WELLS', 'DP_TP_CD', T17.DP_TP_CD) AS MPY_MTHD_TP_NM                     /* 납부방식유형코드 - 자동이체(LCCK01) */
             , T11.TXINV_PBL_OJ_YN                                                                      /* 세금계산서발행대상여부 - 세금계산서 발행:LCITAX*/
             , T12.FRISU_BFSVC_PTRM_N                                                                   /* 무상BS기간수(LCMMON + LCST13) - (무료개월:LCMMON)*/
             , '' AS LCMCNT                                                                             /* 무료회수(LD3000P@LCMCNT) TODO.맵핑문의(특성,맵핑없음) */
             , '' AS LCCK05_NM                                                                          /* 가격유형  LD1010P@LCAGUB, LD3000P@LCCK05 TODO.맵핑문의(맵핑없음) */
             , CASE WHEN T25.HGR_PD_CD IS NOT NULL THEN 'Y' ELSE 'N' END AS RCP_PKG_YN                  /* 접수기준-패키지 여부 (LD3000P@LCPKYN) 맵핑없어서 패키지코드존재여부로 체크함 TODO.재문의 확인필요 */
             , T25.HGR_PD_CD AS RCP_PKG_CD                                                              /* 접수기준-(패키지 번호:LCPKAG)*/
             , T25.PD_NM AS RCP_PKG_NM                                                                  /* 접수기준-(패키지명:LCPKAG_NM) */
             , CASE WHEN T11.HGR_PD_CD IS NOT NULL THEN 'Y' ELSE 'N' END AS PKG_YN                      /* 현재기준-패키지 여부 (LD3000P@LCST07) 맵핑없어서 패키지코드존재여부로 체크함 TODO.재문의 확인필요 */
             , CASE WHEN T11.HGR_PD_CD IS NOT NULL THEN 'Y' ELSE 'N' END AS PKG_PRC_APY                 /* 현재기준-패키지가격 적용(LD3000P@LCST06) 맵핑없음. TODO.재문의 패키지코드면 전부 캐피지가격이 적용인가?*/
             , T24.PD_CLSF_NM AS PKGCLSF_NM                                                             /* 현재기준-(패키지군:LCST10,LCST10_NM)  맵핑없음. TODO.재문의 제품분류명으로 대체가 맞는가? 함축됨*/
             , T11.HGR_PD_CD AS PKG_CD                                                                  /* 현재기준-(패키지 번호:LCST12)*/
             , T24.PD_NM AS PKG_NM                                                                      /* 현재기준-(패키지명:LCST12_NM) */
             , '' AS LCSCNT                                                                             /* 배송기준횟수:LD3000P@LCSCNT TODO.맵핑문의(맵핑없음) */
             , CASE WHEN T47.FRE_EXPN_CNFM_DTM IS NOT NULL THEN 'Y' ELSE 'N' END AS FRE_CNFM_YN         /* 확정유무(무료체험확정여부):LD3000P@LCFGUB 대체(맵핑없음) */
             , CASE WHEN T10.CNTR_PRGS_STAT_CD = '60' THEN 'Y' ELSE '' END AS ORD_CNFM_YN               /* 주문확정유무:LD3000P@LCUGUB TODO.맵핑문의(계약진행상태코드로 대체) */
             , CASE WHEN T51.SL_DT IS NOT NULL THEN 'Y' ELSE '' END AS D_CNFM_YN                        /* 일매출 확정(LCIGUB) 맵핑없어서 일매출테이블에서 매출일자가 있는지 존재여부 대체 */
             , T11.FRISU_YN                                                                             /* (계약상세.무상여부) - 체험유무(LCEGUB) */
             , '' AS LCECDD                                                                             /* 체험센터배송(일자):LD3000P@LCECDD (2017년에 한건데이터만 존재함) 삭제가능확인요청 */
             , SUBSTR(T10.CNTR_RCP_FSH_DTM, 0, 8) AS CNTR_RCP_FSH_DT                        /* 계약접수완료일시 - 접수일자(LCCRTT,LCCRTY) */
             , T11.SPP_DUEDT                                                                /* 예정일자 : LCCRTT, LCDEMY*/
             --, SUBSTR(T46.FST_SPP_FSH_DTM, 0, 8) AS FST_SPP_FSH_DT                          /* 최초배송일자 - 배송일자(LCDLVT,LCDLVY) */
             , '' AS FST_SPP_FSH_DT                          /* 최초배송일자 - 배송일자(LCDLVT,LCDLVY) */
             , SUBSTR(T11.CNTR_PD_STRTDT, 1, 8) AS IST_DT                                   /* 설치일자 - 매출일자 (매출일:LCSLET.LCSLEY) -> 계약시작일자  T12.IST_DT-> T50.SL_DT ->  T11.CNTR_PD_STRTDT */
             , T11.CNTR_PD_ENDDT                                                            /* 계약상품종료일자 - 만료일자(LCMANT = LCSLEY + LCMONT ) */
             , (SELECT
                       MAX(HIST_STRT_DTM)
                     FROM TB_SSCT_CNTR_DTL_STAT_CH_HIST
                    WHERE CNTR_NO = T11.CNTR_NO
                      AND CNTR_SN = T11.CNTR_SN
                      AND CNTR_DTL_STAT_CD = '203'
                      AND DTA_DL_YN = 'N'
                    ) AS CLTN_RQDT                                                          /* 해약요청일자:LCREQT,LCREQY - 고객쵸엉해약(301) 의 이력시작일자*/
             , T12.REQD_DT                                                                  /* 철거일자 - (해약일:LCCANT,LCCANY)*/
             --, SUBSTR(T46.SPP_FSH_DTM, 5, 2) AS SPP_FSH_M                                   /* 배송완료월 - 배송기준년월(LCSCHM) */
             , '' AS SPP_FSH_M                                                              /* 배송완료월 - 배송기준년월(LCSCHM) */
             , T10.CNTR_CNFM_DTM                                                            /* 계약확정일시 - 주문확정일시(LCUDTE) */
             , T51.SL_DT || T51.SL_TM AS SL_DTM                                             /* 일매줄확정일시(LD3500P@LCIDTE) - 최근 일매출일자(시간) - 2017년 4분기만 자료 있음 나머지 없음 */
             , T47.SPP_FSH_DT AS FRE_SPP_FSH_D                                              /* 체험배송일자(LCEXPD) - 2018년자료있음 TODO.맵핑문의(맵핑없음) */
             , T18.OJ_DTL_CNTR_NO || '-' || T18.OJ_DTL_CNTR_SN AS LK_CNTR_DTL_NO            /* 연계정보 - 계약상세번호 (주문번호:RLYRCD) */
             , T18.CST_KNM AS LK_CST_KNM                                                    /* 연계정보 - 계약자명 (주문자 명 :RLYRCD) */
             , T18.BASE_PD_CD AS LK_PD_CD                                                   /* 연계정보 - 상품코드 (상품코드:RLYRCD) */
             , T18.PD_NM AS LK_PD_NM                                                        /* 연계정보 - 상품명 (상품명:RLYRCD) */
             , T18.IST_DT AS LK_IST_DT                                                      /* 연계정보 - 설치일자 (설치일자:RLYRCD) */
             , T18.IST_NMN_N AS LK_IST_NMN_N                                                /* 연계정보 - 설치차월 (설치차월:RLYRCD) */
             , T18.REQD_DT AS LK_REQD_DT                                                    /* 연계정보 - 철거일자 (철거일자:RLYRCD) */
             , T26.PMOT_NM                                                                  /* 연계정보 - 프로모션명 (프로모션명:LCST02) */
             , T26.PMOT_TP_CD                                                               /* 연계정보 - 프로모션유형 (프로모션유형:LCTEXT) */
             , T26.PMOT_CD                                                                  /* 연계정보 - 프로모션코드 (프로모션코드:LCPCOD) TOBE에서는 프로모션순번 표시하기 어려움 */
             , '' AS PMOT_SN                                                                /* 연계정보 - 프로모션순번 */
             , SUBSTR(T11.FST_RGST_DTM, 0, 8)  AS FST_RGST_DT                               /* 등록일자 (최초등록일시:LCEYMD)  */
             , SUBSTR(T11.FST_RGST_DTM, 9,6)   AS FST_RGST_TM                               /* 등록일자 (주문등록일자:LCEHMS)  */
             , T40.SFK_VAL /* 세이프키값  KWSKEY SAFE-KEY */
             , CASE WHEN (SELECT COUNT(1)
                            FROM TB_SSCT_CST_GD_ESTM_IZ /* T.고객등급산정내역*/
                           WHERE 1=1
                             AND CST_NO = T10.CNTR_CST_NO       /* 고객번호 */
                             AND CST_GD_CD = '2'
                             AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') BETWEEN  VL_STRT_DTM AND VL_END_DTM
                             AND DTA_DL_YN = 'N'               /* 데이터삭제여부*/
                            ) = 0
                    THEN '일반' ELSE 'VIP' END LEVELS  /* 등급구분(LEVELS) */
             , T32.RVE_CD                                                                           /* 수납코드(LCSUNA) */
             , F_CMZ_CD_NM('TNT_WELLS', 'RVE_CD', T32.RVE_CD) AS RVE_NM                             /* 수납코드명 - LCSUNA, IFSNA1) */
             , T11.FST_RGST_USR_ID  AS BIZ_USR_ID                                                   /* 최초등록사용자ID - 업무담당(LCECDE)*/
             , T34.USR_NM           AS BIZ_USR_NM                                                   /* 최초등록사용자NM 업무담당명 NM */
             , T40.CRAL_LOCARA_TNO  AS CNTR_CRAL_LOCARA_TNO                                         /* 계약자　휴대폰번호1 LCCNOT. LCCNO1 */
             , T40.MEXNO_ENCR       AS CNTR_MEXNO_ENCR                                              /* 계약자　휴대폰번호2 LCCNOT. LCCNO2 */
             , T40.CRAL_IDV_TNO     AS CNTR_CRAL_IDV_TNO                                            /* 계약자　휴대폰번호3 LCCNOT. LCCNO3 */
             , T40.CRAL_LOCARA_TNO || '-' || T40.MEXNO_ENCR || '-' || T40.CRAL_IDV_TNO  AS CNTR_CRAL_TNO /* 계약자 - 휴대전화번호(LCCNOT) */
             , F_CMZ_CD_NM('TNT_WELLS', 'CNTRT_REL_CD', T44.CNTRT_REL_CD) AS CNTRT_REL_NM           /* 계약자 기준 배송처 관계 - LCST11_NM, LCST11) */
             , '' AS LCMMDC                                                                         /* 최초 배송월 무료 - LD3000P@LCMMDC TODO.맵핑없음 값이 0또는 빈값만 있음. 화면 삭제요청 */
             , T80.ALNC_STAT_TP_CD                                                                  /* 제휴상태유형명 -제휴상태:LCCK08 */
             , F_CMZ_CD_NM('TNT_WELLS', 'ALNC_STAT_TP_CD', T80.ALNC_STAT_TP_CD) AS ALNC_STAT_TP_NM  /* 제휴상태유형명 -제휴상태명:LCCK08_ST */
             , T80.ALNCMP_CD                                                                        /* 제휴상태유형명 -제휴업체:LCCK08 */
             , F_CMZ_CD_NM('TNT_WELLS', 'ALNCMP_CD', T80.ALNCMP_CD) AS ALNCMP_NM                    /* 제휴상태유형명 -제휴업체명:LCCK08 */
             , CASE WHEN REGEXP_LIKE(T11.CNTR_DTL_STAT_CD, '^2|^3') THEN F_CMZ_CD_NM('TNT_WELLS', 'CNTR_DTL_STAT_CD', T11.CNTR_DTL_STAT_CD)
                    ELSE '' END AS CLTN_CNTR_DTL_STAT_NM                                            /* 계약상세상태코드(해약) -  해약유형:LCCFLG */
             , T11.CTT_RS_CD                                                                        /* 컨택결과코드 (컨택코드:LCCCDE) */
             , F_CMZ_CD_NM('TNT_WELLS', 'LC_CTT_RS_CD', T11.CTT_RS_CD) AS CTT_RS_NM                 /* 컨택결과코드 (컨택내용:LCCCDE의 명칭:CWCCNM) LCCCDE_NM */
             , T12.SCON_CN                                                                          /* 특약내용(특약:LCSCAL) */
             , T10.CNTR_CST_NO          /* 계약자정보 - 고객번호(교원키:LCKKEY) */
             , T21.REF_PD_CLSF_VAL      /* 상품분류코드 참조키(대분류+중분류가 포함되어 있음 EX) 02001 */
             , T33.DGR1_LEVL_OG_ID      /* 조회조건: 총괄단 - 조직(1차레벨조직ID) */
             , T33.DGR2_LEVL_OG_ID      /* 조회조건: 지역단 - 조직(2차레벨조직ID) */
             , T33.DGR3_LEVL_OG_ID      /* 조회조건: 지점 - 조직(3차레벨조직ID) */
             , T16.SV_PD_TP_CD MCHN_PD_PRP_VAL01 /* 기기용도 상품참조키 */
          FROM TB_SSCT_CNTR_BAS T10                     /* T.계약기본 */
         INNER JOIN TB_SSCT_CNTR_DTL T11                /* T.계약상세 */
            ON T11.CNTR_NO = T10.CNTR_NO                /* 계약번호  */
           AND T11.SELL_TP_CD IN ('6')                  /* 판매유형코드 : 정기배송(6) */
           AND T11.DTA_DL_YN = 'N'
          LEFT OUTER  JOIN TB_SSCT_CNTR_WELLS_DTL T12   /* T.WELLS상세 */
            ON T12.CNTR_NO = T11.CNTR_NO                /*계약번호  */
           AND T12.CNTR_SN = T11.CNTR_SN                /*계약번호  */
           AND T12.DTA_DL_YN = 'N'
          LEFT OUTER JOIN LATERAL (SELECT BASE_DTL_CNTR_NO
                                        , BASE_DTL_CNTR_SN
                                        , OJ_DTL_CNTR_NO
                                        , OJ_DTL_CNTR_SN
                                    FROM TB_SSCT_CNTR_REL
                                   WHERE BASE_DTL_CNTR_NO = T11.CNTR_NO
                                     AND BASE_DTL_CNTR_SN = T11.CNTR_SN
                                     AND CNTR_REL_DTL_CD IN ('214')           /* 계약관계상세코드 : 원주문 - 정기배송(214) */
                                     AND DTA_DL_YN = 'N'
                                     AND VL_END_DTM = (SELECT MAX(VL_END_DTM)
                                                           FROM TB_SSCT_CNTR_REL T131
                                                          WHERE  1=1
                                                            AND T131.BASE_DTL_CNTR_NO = T11.CNTR_NO
                                                            AND T131.BASE_DTL_CNTR_SN = T11.CNTR_SN
                                                            AND T131.CNTR_REL_DTL_CD IN ('214')     /* 계약관계상세코드 : 원주문 - 정기배송(214) */
                                                            AND T131.DTA_DL_YN = 'N')               /*유효종료일시*/
              ) T13
            ON T13.BASE_DTL_CNTR_NO = T11.CNTR_NO
           AND T13.BASE_DTL_CNTR_SN = T11.CNTR_SN
          LEFT OUTER JOIN TB_SSCT_CNTR_DTL T14           /*T.계약상세 -> 정기배송 원주문.*/
            ON T14.CNTR_NO = T13.OJ_DTL_CNTR_NO         /*계약번호  */
           AND T14.CNTR_SN = T13.OJ_DTL_CNTR_SN         /*계약번호일련번호  */
           AND T14.DTA_DL_YN = 'N'
          LEFT OUTER  JOIN TB_SSCT_CNTR_WELLS_DTL T15   /* T.WELLS상세-> 정기배송 원주문. */
            ON T15.CNTR_NO = T14.CNTR_NO                /*계약번호  */
           AND T15.CNTR_SN = T14.CNTR_SN                /*계약번호  */
           AND T15.DTA_DL_YN = 'N'
          LEFT OUTER JOIN LATERAL (SELECT /* 기기정보 추가정보 */
                                          T161.DTL_CNTR_NO
                                        , T161.DTL_CNTR_SN
                                        , T162.RCGVP_KNM    /* 수령자한글명 */
                                        , T164.PD_NM        /* 상품명 */
                                        , T164.SV_PD_TP_CD /* 기기용도 */
                                        , T165.PD_CLSF_NM AS PD_MCLSF_NM    /* 상품중분류 */
                                        , T166.PD_CLSF_NM AS PD_DCLSF_NM    /* 상품소분류 */
                                     FROM TB_SSCT_CNTR_ADR_REL T161      /* T.계약주소관계 - 설치지 */
                                     LEFT OUTER JOIN TB_SSCT_CNTR_ADRPC_BAS T162    /* T.계약주소지기본 - 설치지 */
                                       ON T162.CNTR_ADRPC_ID = T161.CNTR_ADRPC_ID
                                      AND T162.DTA_DL_YN = 'N'
                                     LEFT OUTER JOIN TB_GBCO_ADR_BAS T163           /* T.주소기본 - 설치지 */
                                       ON T163.ADR_ID = T162.ADR_ID
                                      AND T163.DTA_DL_YN = 'N'
                                     LEFT OUTER JOIN TB_PDBS_PD_BAS T164            /* T.상품기본 -  */
                                       ON T164.PD_CD = T14.BASE_PD_CD               /* 상품코드 */
                                      AND T164.TEMP_SAVE_YN = 'N'                   /* 임시저장여부 */
                                      AND T164.DTA_DL_YN = 'N'                      /* 데이터삭제여부 */
                                     LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS T165       /* T.상품분류기본 중분류명 =중분류명 */
                                       ON T165.PD_CLSF_ID = T164.PD_MCLSF_ID        /* 상품분류ID */
                                      AND T165.DTA_DL_YN = 'N'
                                     LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS T166       /* T.상품분류기본 상품소분류ID 소분류명 */
                                       ON T166.PD_CLSF_ID = T164.PD_DCLSF_ID        /* 상품분류ID */
                                      AND T166.DTA_DL_YN = 'N'
                                    WHERE T161.DTL_CNTR_NO = T14.CNTR_NO
                                      AND T161.DTL_CNTR_SN = T14.CNTR_SN
                                      AND T161.ADRPC_TP_CD IN ('2', '3')                    /* 주소지유형코드 : 설치지(3)  */
                                      AND T161.VL_END_DTM = '99991231235959'        /* 유효종료일시 */
                                      AND T161.DTA_DL_YN = 'N'
                                   ) T16    /* 기기정보의 설치정보*/
            ON T16.DTL_CNTR_NO = T14.CNTR_NO       /* 멤버십의 원주문을 대상으로 지정하여 결합된 계약 */
           AND T16.DTL_CNTR_SN = T14.CNTR_SN
          LEFT OUTER JOIN LATERAL (SELECT
                                          REL.OJ_DTL_CNTR_NO  /* 계약번호 */
                                        , REL.OJ_DTL_CNTR_SN  /* 계약일련번호 */
                                        , CST.CST_KNM       /* 주문자 명 */
                                        , DTL.BASE_PD_CD    /* 상품코드 */
                                        , PD.PD_NM /* 상품명 */
                                        , WDTL.IST_DT  /* 설치일자  IST_DT*/
                                        , TRUNC(MONTHS_BETWEEN(SYSDATE, TO_DATE(DTL.CNTR_PD_STRTDT,'YYYYMMDD')))  AS IST_NMN_N  /* 설치차월 */
        --                                  ASIS 설치차월 (LCSETT)
        --                                LCSLEY * 10000 + LCSLEM * 100 + LCSLED AS LCSETT    LC3000P 설치일자    계약상품시작일자  매출일
        --                                LCSETY * 10000 + LCSETM * 100 + LCSETD AS LCSETT    LC3100P 설치일자    계약상품시작일자 - 설치일
        --                                LCENTY * 10000 + LCENTM * 100 + LCENTD AS LCSETT    LC3500P 가입년     계약임시저장일시
                                        , WDTL.REQD_DT      /* 철거일자   REQD_DT */
                                     FROM TB_SSCT_CNTR_REL REL                      /*계약관계 -- 1+1연계(대상) - 정기배송(기준) */
                                     LEFT OUTER JOIN TB_SSCT_CNTR_BAS BAS           /* T.계약기본 */
                                       ON BAS.CNTR_NO = REL.OJ_DTL_CNTR_NO
                                     LEFT OUTER JOIN TB_SSCT_CNTR_DTL DTL           /*T.계약상세 -> 1+1연계(대상)*/
                                       ON DTL.CNTR_NO = REL.OJ_DTL_CNTR_NO
                                      AND DTL.CNTR_SN = REL.OJ_DTL_CNTR_SN
                                      AND DTL.DTA_DL_YN = 'N'
                                     LEFT OUTER  JOIN TB_SSCT_CNTR_WELLS_DTL WDTL   /* T.WELLS상세-> 1+1연계(대상) */
                                       ON WDTL.CNTR_NO = DTL.CNTR_NO
                                      AND WDTL.CNTR_SN = DTL.CNTR_SN
                                      AND WDTL.DTA_DL_YN = 'N'
                                     LEFT OUTER JOIN TB_CUBS_CST_BAS CST           /* T.고객기본 - 계약자 */
                                        ON CST.CST_NO = BAS.CNTR_CST_NO
                                       AND CST.DTA_DL_YN = 'N'
                                     LEFT OUTER JOIN TB_PDBS_PD_BAS PD            /* T.상품기본 -  */
                                       ON PD.PD_CD = DTL.BASE_PD_CD               /* 상품코드 */
                                      AND PD.TEMP_SAVE_YN = 'N'                   /* 임시저장여부 */
                                      AND PD.DTA_DL_YN = 'N'                       /* 데이터삭제여부 */
                                    WHERE 1=1
                                      AND REL.BASE_DTL_CNTR_NO = T11.CNTR_NO              /*계약번호  */
                                      AND REL.BASE_DTL_CNTR_SN = T11.CNTR_SN              /*계약번호  */
                                      AND REL.CNTR_REL_DTL_CD IN ('215')        /* 계약관계상세코드(1+1연계:215) */
                                      AND REL.DTA_DL_YN = 'N'
                                      AND REL.VL_END_DTM = '99991231235959'        /*유효종료일시*/
                                  ) T18             /* 계약번호 고객해약요청일*/
            ON 1 = 1
          LEFT OUTER JOIN LATERAL ( SELECT CNTR_NO          /* 계약번호 */
                                         , DP_TP_CD        /* 납부방식유형코드 */
                                         , BNK_CD
                                         , CDCO_CD
                                         , ACNO_ENCR       /* 계좌번호암호화 */
                                         , CRCDNO_ENCR     /* 신용카드번호암호화 */
                                         , MPY_BSDT        /* 납부기준일자 */
                                         , OWR_KNM
                                         , CARD_EXPDT_YM    /* 카드유효기간년월 */
                                     FROM TB_SSCT_CNTR_STLM_BAS   /* T.계약결제기본 */
                                    WHERE 1=1
                                      AND DP_TP_CD IN ('0102','0203') /* 납부방식유형코드 : 계좌자동이체(0102), 카드자동이체(0203)  */
                                      AND CNTR_NO = T11.CNTR_NO
                                      AND DTA_DL_YN = 'N'
                                      AND CNTR_STLM_ID = (SELECT MAX(CNTR_STLM_ID) /*계약결제ID*/
                                                                 FROM TB_SSCT_CNTR_STLM_REL     /*계약결제관계*/
                                                                WHERE 1=1
                                                                  AND DTL_CNTR_NO = T11.CNTR_NO
                                                                  AND DTL_CNTR_SN = T11.CNTR_SN
                                                                  AND RVE_DV_CD IN ('03')         /*수납구분코드 : 정기배송회비(05), 월납입액(할부금, 렌탈료)(03)*/
                                                                  AND VL_END_DTM = '99991231235959'
                                                                  AND DTA_DL_YN = 'N'
                                                               )
                                    ) T17
            ON T17.CNTR_NO = T11.CNTR_NO    /* 자동이체 관계 */
          LEFT OUTER JOIN TB_PDBS_PD_BAS T20         /* T.상품기본 -  */
            ON T20.PD_CD = T11.BASE_PD_CD             /* 상품코드 */
           AND T20.TEMP_SAVE_YN = 'N'                /* 임시저장여부 */
           AND T20.DTA_DL_YN = 'N'                   /* 데이터삭제여부 */
          LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS T21    /* T.상품분류기본 상품분류 */
            ON T21.PD_CLSF_ID = T20.PD_CLSF_ID        /* 상품분류ID */
           AND T21.DTA_DL_YN = 'N'
          LEFT OUTER JOIN LATERAL (SELECT /* 현재 패키지 - 정보 명칭/패키지분류*/
                                          T240.PD_CD         /* 패키지코드 데체*/
                                        , T240.PD_NM         /* 패키지명 데체*/
                                        , T241.PD_CLSF_NM    /* 패키지군명(분류명) 데체*/
                                     FROM TB_PDBS_PD_BAS T240                /* T.상품기본 -  */
                                     INNER JOIN TB_PDBS_PD_CLSF_BAS T241     /* T.상품분류기본 상품중분류ID = */
                                        ON T241.PD_CLSF_ID = T240.PD_CLSF_ID/* 상품분류ID */
                                       AND T241.DTA_DL_YN = 'N'
                                     WHERE 1=1
                                       AND T240.TEMP_SAVE_YN = 'N'                /* 임시저장여부 */
                                       AND T240.DTA_DL_YN = 'N'                   /* 데이터삭제여부 */
                                       AND T240.PD_CD = T11.HGR_PD_CD
                                  ) T24
            ON T24.PD_CD = T11.HGR_PD_CD
          LEFT OUTER JOIN LATERAL (SELECT /*+LEADING(DHIST) INDEX(DHIST ARR_TB_SSCT_CNTR_DCH_HIST) USE_NL(DHIST PBAS)*/
                                          /* 최초 접수시 패키지 정보 */
                                           DHIST.HGR_PD_CD   /* 접수기준 - 패키지번호 */
                                         , PBAS.PD_NM       /* 접수기준 - 패키지명 */
                                         , DHIST.CNTR_NO
                                         , DHIST.CNTR_SN
                                      FROM TB_SSCT_CNTR_DCH_HIST DHIST /* 계약상세변경이력 */
                                     INNER JOIN TB_PDBS_PD_BAS PBAS /* 상품기본 */
                                        ON PBAS.PD_CD = DHIST.HGR_PD_CD
                                       AND PBAS.DTA_DL_YN = 'N'
                                      WHERE 1=1
                                        --AND DHIST.CNTR_NO = T11.CNTR_NO
                                        --AND DHIST.CNTR_SN = T11.CNTR_SN
                                        AND DHIST.HIST_STRT_DTM IN (SELECT NVL(MIN(HIST_STRT_DTM) ,'') /* 이력시작일시 */
                                                                   FROM TB_SSCT_CNTR_CH_HIST
                                                                  WHERE 1=1
                                                                    AND CNTR_NO = DHIST.CNTR_NO
                                                                    AND CNTR_PRGS_STAT_CD = '60' /*계약진행상태코드:확정(60)*/
                                                                    AND DTA_DL_YN = 'N')
                                 ) T25
            ON T25.CNTR_NO = T11.CNTR_NO
           AND T25.CNTR_SN = T11.CNTR_SN
        LEFT OUTER JOIN LATERAL (SELECT PIZ.DTL_CNTR_NO
                                      , PIZ.DTL_CNTR_SN
                                      , LISTAGG(PBAS.PMOT_NM,',')    WITHIN GROUP (ORDER BY PBAS.PMOT_NM ASC)    AS PMOT_NM      /* 프로모션 명 */
                                      , LISTAGG(PBAS.PMOT_TP_CD,',') WITHIN GROUP (ORDER BY PBAS.PMOT_TP_CD ASC) AS PMOT_TP_CD   /* 프로모션 유형코드 */
                                      , LISTAGG(PIZ.PMOT_CD ,',')    WITHIN GROUP (ORDER BY PIZ.PMOT_CD  ASC)    AS PMOT_CD      /* 프로모션 코드 */
                                   FROM TB_SSCT_CNTR_PMOT_IZ PIZ    /* T.계약프로모션내역 */
                                   LEFT OUTER JOIN TB_PDBS_PMOT_BAS PBAS  /* T.프로모션 기본 */
                                     ON PBAS.PMOT_CD = PIZ.PMOT_CD
                                    AND PBAS.VL_END_DTM = '99991231235959'
                                    AND PBAS.DTA_DL_YN = 'N'
                                  WHERE 1=1
                                    AND PIZ.DTL_CNTR_NO = T11.CNTR_NO
                                    AND PIZ.DTL_CNTR_SN = T11.CNTR_SN
                                    AND PIZ.DTA_DL_YN = 'N'
                                  GROUP BY PIZ.DTL_CNTR_NO, PIZ.DTL_CNTR_SN
                                  ) T26
            ON T26.DTL_CNTR_NO = T11.CNTR_NO
           AND T26.DTL_CNTR_SN = T11.CNTR_SN
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ T30         /* T.월파트너내역 - 판매자 */
            --ON T30.BASE_YM = TO_CHAR(SYSDATE, 'YYYYMM')
            ON T30.BASE_YM = SUBSTR(T10.CNTR_CNFM_DTM,1,6)
           AND T30.OG_TP_CD = T10.SELL_OG_TP_CD
           AND T30.PRTNR_NO = T10.SELL_PRTNR_NO
           AND T30.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_OGBS_PRTNR_DTL T32         /* T.파트너상세  - 판매자 (수납코드) */
            ON T32.OG_TP_CD = T10.SELL_OG_TP_CD
           AND T32.PRTNR_NO = T10.SELL_PRTNR_NO
           AND T32.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_OGBS_MM_OG_IZ T33          /* T.월조직내역 - 지점장 (조직정보) */
            --ON T33.BASE_YM = TO_CHAR(SYSDATE, 'YYYYMM')
            ON T33.BASE_YM = SUBSTR(T10.CNTR_CNFM_DTM,1,6)
           AND T33.OG_ID = T30.OG_ID
           AND T33.DTA_DL_YN = 'N'
          LEFT OUTER JOIN T_CMP_USR_ACO_M T34           /* T.사용자(사용자명)*/
            ON T34.USR_ID = T11.FST_RGST_USR_ID
           AND T34.DEL_YN = 'N'
          LEFT OUTER JOIN TB_CUBS_CST_BAS T40           /* T.고객기본 - 계약자 */
            ON T40.CST_NO = T10.CNTR_CST_NO/* 고객번호*/
           AND T40.DTA_DL_YN = 'N'/* 데이터삭제여부 */
          LEFT OUTER JOIN TB_GBCO_ADR_BAS T41
            ON T41.ADR_ID = T40.ADR_ID
           AND T41.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SSCT_CNTR_ADR_REL T43      /* T.계약주소관계 - 배송지 */
            ON T43.DTL_CNTR_NO = T11.CNTR_NO
           AND T43.DTL_CNTR_SN = T11.CNTR_SN
           AND T43.ADRPC_TP_CD = '2'                    /* 주소지유형코드 : 배송지(2) : 정기배송, 홈케어 멤버십 */
           AND T43.VL_END_DTM = '99991231235959'        /* 유효종료일시 */
           AND T43.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SSCT_CNTR_ADRPC_BAS T44    /* T.계약주소지기본 - 배송지 */
            ON T44.CNTR_ADRPC_ID = T43.CNTR_ADRPC_ID
           AND T44.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_GBCO_ADR_BAS T45           /* T.주소기본 - 배송지 */
            ON T45.ADR_ID = T44.ADR_ID
           AND T45.DTA_DL_YN = 'N'
          LEFT OUTER JOIN LATERAL (SELECT *
                                    FROM (SELECT BAS.CST_NO                 /* 고객번호 */
                                               --, BAS.FRE_EXPN_RCP_DTM       /* 무료체험접수일시 */
                                               , BAS.FRE_EXPN_CNFM_DTM      /* 무료체험확정일시 LD3000P@LCFGUB*/
                                               , BAS.FRE_EXPN_PRGS_STAT_CD  /* 무료체험진행상태코드 확정(20)*/
                                               , DTL.SPP_FSH_DT             /* 배송완료일자  LD3000P@LCEXPD*/
                                               , ROW_NUMBER() OVER(ORDER BY BAS.FNL_MDFC_DTM, DTL.FRE_EXPN_DTL_SN DESC) AS RN
                                            FROM TB_SSOP_FRE_EXPN_BAS BAS /* 무료체험기본 - () */
                                            LEFT OUTER JOIN TB_SSOP_FRE_EXPN_DTL  DTL /*무료체험상세*/
                                              ON DTL.FRE_EXPN_ID = BAS.FRE_EXPN_ID
                                             AND DTL.DTA_DL_YN = 'N'
                                           WHERE 1=1
                                             AND BAS.CST_NO = T10.CNTR_CST_NO/* 고객번호*/
                                             AND BAS.DTA_DL_YN = 'N'/* 데이터삭제여부 */
                                        )
                                  WHERE RN = 1
                                  ) T47             /* 무료체험기본 - 체험시작일 */
            ON T47.CST_NO = T10.CNTR_CST_NO
         LEFT OUTER JOIN LATERAL (SELECT * /* 최근 일매출일자 */
                                     FROM (SELECT MAX(T510.CNTR_NO) KEEP(DENSE_RANK FIRST ORDER BY T510.FNL_MDFC_DTM DESC) AS CNTR_NO
                                                , MAX(T510.CNTR_SN) KEEP(DENSE_RANK FIRST ORDER BY T510.FNL_MDFC_DTM DESC) AS CNTR_SN
                                                , MAX(T510.SL_RCOG_DT) KEEP(DENSE_RANK FIRST ORDER BY T510.FNL_MDFC_DTM DESC) AS SL_DT
                                                , MAX(SUBSTR(T510.FNL_MDFC_DTM, 9,6))  KEEP(DENSE_RANK FIRST ORDER BY T510.FNL_MDFC_DTM DESC) AS SL_TM  /* 최종 수정일시 (매출일 있는 날짜) */
                                                , ROW_NUMBER() OVER(ORDER BY MAX(T510.SL_RCOG_DT) DESC) AS RN
                                            FROM TB_CBCL_WELLS_SL_CNFM_BAS T510 /* T.매출확정기본 (일매출) */
                                          WHERE 1=1
                                            AND T510.CNTR_NO = T11.CNTR_NO
                                            AND T510.CNTR_SN = T11.CNTR_SN
                                            AND T510.SL_CNFM_SN = 1
                                            AND T510.DTA_DL_YN = 'N'
                                          )
                                    WHERE RN = 1
                                  ) T51
            ON T51.CNTR_NO = T11.CNTR_NO
           AND T51.CNTR_SN = T11.CNTR_SN
          LEFT OUTER JOIN TB_SSCT_ACMPAL_CNTR_IZ T80  /* T.관계사제휴계약내역 */
            ON T80.BASE_CNTR_NO = T11.CNTR_NO  /* 계약정보 */
           AND T80.BASE_CNTR_SN = T11.CNTR_SN
           AND T80.SELL_TP_CD = '6' /*판매유형코드 : 정기배송(6)*/
           AND T80.DTA_DL_YN = 'N'
         WHERE 1=1
        <if test="@MybatisUtils@isNotEmpty(prdEnqry)">
            <choose>
                <when test='@MybatisUtils@equals(prdEnqry, "1")'> /* 접수일 */
                    AND T10.CNTR_RCP_FSH_DTM BETWEEN #{strtDt}||'000000' AND #{endDt}||'235959'
                </when>
                <when test='@MybatisUtils@equals(prdEnqry, "2")'> /* 취소일 */
                    AND T12.REQD_DT BETWEEN #{strtDt} AND #{endDt}
                </when>
                <when test='@MybatisUtils@equals(prdEnqry, "3")'> /* 매출일 */
                    AND NVL(T12.IST_DT, '') BETWEEN #{strtDt} AND #{endDt}
                </when>
                <when test='@MybatisUtils@equals(prdEnqry, "4")'> /* 만료일 */
                    AND T11.CNTR_PD_ENDDT BETWEEN #{strtDt} AND #{endDt}
                </when>
            </choose>
        </if>
        <if test="@MybatisUtils@isNotEmpty(cntrCstNo)">
           AND T10.CNTR_CST_NO = #{cntrCstNo}
        </if>
        <if test='@MybatisUtils@equals(canYn,"Y")'><!-- 취소 제외 -->
            T12.REQD_DT IS NULL
        </if>
        <if test='@MybatisUtils@equals(slYn,"Y")'>
           AND T51.SL_DT IS NOT NULL
        </if>
        <if test="@MybatisUtils@isNotEmpty(sellOgTpCd)">
           AND T10.SELL_OG_TP_CD IN (
            <foreach collection="sellOgTpCd" item="codeId" separator=",">
                   #{codeId}
            </foreach>
               )
        </if>
        <if test="@MybatisUtils@isNotEmpty(dgr1LevlOgId)">
           AND T33.DGR1_LEVL_OG_ID IN (
            <foreach collection="dgr1LevlOgId" item="codeId" separator=",">
                   #{codeId}
            </foreach>
               )
        </if>
        <if test="@MybatisUtils@isNotEmpty(dgr2LevlOgId)">
           AND T33.DGR2_LEVL_OG_ID IN (
            <foreach collection="dgr2LevlOgId" item="codeId" separator=",">
                   #{codeId}
            </foreach>
               )
        </if>
        <if test="@MybatisUtils@isNotEmpty(dgr3LevlOgId)">
           AND T33.DGR3_LEVL_OG_ID IN (
            <foreach collection="dgr3LevlOgId" item="codeId" separator=",">
                   #{codeId}
            </foreach>
               )
        </if>
        <if test="@MybatisUtils@isNotEmpty(mchnDv)">
           AND T11.SELL_TP_DTL_CD IN (
            <foreach collection="mchnDv" item="codeId" separator=",">
                   #{codeId}
            </foreach>
               )
        </if>
        <if test="@MybatisUtils@isNotEmpty(sellPrtnrNo)">
           AND T10.SELL_PRTNR_NO = #{sellPrtnrNo}
        </if>
        <if test="@MybatisUtils@isNotEmpty(cntrNo)">
           AND T11.CNTR_NO = #{cntrNo}
        </if>
        <if test="@MybatisUtils@isNotEmpty(cntrSn)">
           AND T11.CNTR_SN = #{cntrSn}
        </if>
        )
    </select>

    <update id="updateMembershipConfirmsCntrBas">
        UPDATE TB_SSCT_CNTR_BAS
        <if test='@MybatisUtils@equals(cntrCnfmYn,"N")'>
            SET CNTR_PRGS_STAT_CD = '50'
              , CNTR_CNFM_DTM = null
        </if>
        <if test='@MybatisUtils@equals(cntrCnfmYn,"Y")'>
            SET CNTR_PRGS_STAT_CD = '60'
              , CNTR_CNFM_DTM = #{cntrCnfmDtm}
        </if>
               <include refid="COMMON.updateSystemField"/>
         WHERE 1=1
           AND CNTR_NO = #{cntrNo}
    </update>

    <update id="updateMembershipConfirmsCntrDtl">
        UPDATE TB_SSCT_CNTR_DTL
        <if test='@MybatisUtils@equals(cntrCnfmYn,"N")'>
            SET CNTR_PD_STRTDT = null
        </if>
        <if test='@MybatisUtils@equals(cntrCnfmYn,"Y")'>
            SET CNTR_PD_STRTDT = #{cntrPdStrtdt}
        </if>
               <include refid="COMMON.updateSystemField"/>
         WHERE 1=1
           AND CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
    </update>

    <select id="selectCompositionProducts" resultType="com.kyowon.sms.wells.web.contract.ordermgmt.dto.WctaOrderDetailMngtDto$SearchCompositionProductsRes">
        SELECT MIN(BASE_PD_CD) AS BASE_PD_CD
             , MIN(PD_NM) AS PD_NM
             , SUM(PD_QTY) AS PD_QTY
             , SUM(FNL_VAL) AS FNL_VAL
             , SUM(CTR_VAL) AS CTR_VAL
             , MIN(OJ_PD_CD) AS OJ_PD_CD
             , MAX(VER_SN) AS VER_SN
             , MIN(PD_CLSF_NM) AS PD_CLSF_NM
          FROM (SELECT /* 정기배송 상품 목록*/
                       T1.BASE_PD_CD    /* 기준상품코드*/
                     , T2.PD_NM         /* 상품명 */
                     , T1.PD_QTY        /* 수량 */
                     , T3.FNL_VAL       /* 단가 LD3050P@LCTAMT */
                     , T3.CTR_VAL       /* 할인 LD3050P@LCRAMT */
                     , T1.OJ_PD_CD      /* 대상상품코드(계약상세의상위상품코드) 패키지코드 LD3050P@LCPKAG */
                     , T3.VER_SN        /* 패키지가격차수  LD3050P@LCPSEQ 맵핑이 없음. 패키지가격차수를 가격산출내역의@버전일련번호로 대체*/
                     , T4.PD_CLSF_NM    /* 상춤분류명 */
                  FROM TB_SSCT_CNTR_PD_REL T1           /* T.계약상품관계 */
                  LEFT OUTER JOIN TB_PDBS_PD_BAS T2          /* T.상품기본 -  */
                    ON T2.PD_CD = T1.BASE_PD_CD               /* 상품코드 */
                   AND T2.TEMP_SAVE_YN = 'N'                   /* 임시저장여부 */
                   AND T2.DTA_DL_YN = 'N'                      /* 데이터삭제여부 */
                  LEFT OUTER JOIN LATERAL (SELECT *
                                          FROM (SELECT CNTR_NO
                                                     , CNTR_SN
                                                     , CTR_VAL  --조정값
                                                     , FNL_VAL  --최종값
                                                     , VER_SN   --버전일련번호
                                                     , ROW_NUMBER() OVER(ORDER BY VER_SN DESC) AS RN
                                                  FROM TB_SSCT_CNTR_PRC_CMPT_IZ  /* 계약가격산출내역 */
                                                 WHERE 1=1
                                                   AND CNTR_SN = T1.CNTR_SN
                                                   AND PD_CD   = T1.BASE_PD_CD
                                                   AND DTA_DL_YN = 'N'
                                                )
                                          WHERE RN = 1
                                          ) T3             /* 계약가격산출내역 최신() */
                    ON T3.CNTR_NO = T1.CNTR_NO
                   AND T3.CNTR_SN = T1.CNTR_SN
                  LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS T4    /* T.상품분류기본 상품분류 */
                    ON T4.PD_CLSF_ID = T2.PD_CLSF_ID        /* 상품분류ID */
                   AND T4.DTA_DL_YN = 'N'
                --  LEFT OUTER JOIN TB_SSCT_CNTR_PRC_CMPT_IZ T3   /* 계약가격산출내역 - 할인가  */
                --    ON T3.CNTR_NO = T1.CNTR_NO
                --   AND T3.CNTR_SN = T1.CNTR_SN
                --   AND T3.DTA_DL_YN = 'N'
                --   AND T60.PD_PRC_FNL_DTL_ID = 'TODO...' /* 상품가격최종상세ID */
                --   AND T60.PRC_ID = 'TODO.가격ID'
                 WHERE 1=1
                <if test="@MybatisUtils@isNotEmpty(cntrNo)">
                   AND T1.CNTR_NO = #{cntrNo}
                </if>
                <if test="@MybatisUtils@isNotEmpty(cntrSn)">
                   AND T1.CNTR_SN = #{cntrSn}
                </if>
                   AND T1.PD_REL_TP_CD IN ('01','08')   /* 상품관계유형코드 : 복합-기준(01), 패키지(Package):08 */
                   AND TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') BETWEEN VL_STRT_DTM AND VL_END_DTM
                   AND T1.VL_END_DTM = '99991231235959' /* 유효종료일시 */
               )
         GROUP BY BASE_PD_CD
    </select>

    <select id="selectFreeGiftInformation" resultType="com.kyowon.sms.wells.web.contract.ordermgmt.dto.WctaOrderDetailMngtDto$SearchFreeGiftInformationRes">
        SELECT T0.FGPT_PD_CD /* 사은품 상품코드 */
             , T0.FGPT_QTY /* 사은품수량 */
             --, T3.SPP_FSH_RGST_DTM /* 배송송장생성일시 */
             , (SELECT MAX(T4.PD_NM) /* 상품기본.상품명 */
                  FROM TB_PDBS_PD_BAS T4 /* 상품기본 */
                  WHERE T4.PD_CD = T0.FGPT_PD_CD /* 상품기본.상품코드 = 계약상세.기준상품코드 */
                    AND T4.DTA_DL_YN = 'N' /* 상품기본.데이터삭제여부가 'Y'가 아닌 건 */
               ) AS FGPT_PD_NM /* [상품정보] */
          FROM TB_SSCT_FGPT_RCP_IZ T0 /* 사은품접수내역 */
         INNER JOIN TB_SSSO_SPP_PLAN_BAS T1 /* 배송계획기본 */
            ON T1.FGPT_RCP_ID = T0.FGPT_RCP_ID /* 배송계획기본.사은품접수ID = 사은품접수내역.사은품접수ID */
           AND T1.DTA_DL_YN = 'N'
           AND T0.DTA_DL_YN = 'N'
           AND T1.CNTR_NO = T0.DTL_CNTR_NO
           AND T1.CNTR_SN = T0.DTL_CNTR_SN
         INNER JOIN TB_SSSO_SPP_ORD_DTL T2 /* 배송주문상세 */
            ON T2.SPP_PLAN_ID = T1.SPP_PLAN_ID
           AND T2.CNTR_NO = T0.DTL_CNTR_NO
           AND T2.CNTR_SN = T0.DTL_CNTR_SN
           AND T2.DTA_DL_YN = 'N'
        -- INNER JOIN TB_SSSO_SPP_BZS_IVC_PROCS_IZ T3 /* 배송업체송장처리내역 */
        --    ON T3.CNTR_NO = T2.CNTR_NO
        --   AND T3.CNTR_SN = T2.CNTR_SN
        --   AND T3.BF_ORD_NO = T2.BFCH_SPP_ORD_NO
        --   AND T3.DTA_DL_YN = 'N'
         WHERE 1=1
        <if test="@MybatisUtils@isNotEmpty(cntrNo)">
           AND T0.DTL_CNTR_NO = #{cntrNo}
        </if>
        <if test="@MybatisUtils@isNotEmpty(cntrSn)">
           AND T0.DTL_CNTR_SN = #{cntrSn}
        </if>
    </select>
</mapper>
