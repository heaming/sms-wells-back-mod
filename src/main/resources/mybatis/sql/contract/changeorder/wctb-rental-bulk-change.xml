<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.contract.changeorder.mapper.WctbRentalBulkChangeMapper">

    <select id="selectRentalBulkChanges" resultType="com.kyowon.sms.wells.web.contract.changeorder.dvo.WctbRentalBulkChangeDvo">

        SELECT T2.CNTR_CH_RCP_ID    /* 계약변경접수ID */
             , T2.DTL_CNTR_NO       /* 계약번호 LCYEAR , LCCODE */
             , T2.DTL_CNTR_SN
             , T2.DTL_CNTR_NO ||'-'|| T2.DTL_CNTR_SN AS CNTR_DTL_NO  /* 계약상세번호 (고객코드:LCYCODE) */
             , T11.SELL_TP_CD       /* 판매유형 코드 */
             , T1.CNTR_CH_TP_CD     /* 계약변경유형코드 (처리구분 : DSPSDIV) */
             , (SELECT CST_KNM FROM TB_CUBS_CST_BAS T40 WHERE T40.CST_NO = T10.CNTR_CST_NO AND T40.DTA_DL_YN = 'N') AS CST_KNM /* 계약자정보 - 고객명(LCCNAM) */
             , T12.IST_DT           /* 설치일자 (설치일자:LCSETY, INLTDT)*/
            -------------------------------------------------------------
            <![CDATA[
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '설치년월' )        AS IST_YM   /* 설치년월 (설치년월:LCSETT ) 604 설치월면제, 613  미관리제품 설치일자 변경 */
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '의무기간 변경전' )    AS BFCH_DUTY_PTRM_N   /* 의무기간 변경전(변경전 의무기간수) (의무기간 원본:LCDUTY_OLD ) 605 의무기간 */
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '의무기간 변경후' )    AS AFCH_DUTY_PTRM_N   /* 의무기간 변경후 (의무기간 변경:LCDUTY_NEW ) 605    의무기간*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '인정실적금액' )      AS ACKMT_PERF_AMT   /* 인정실적금액 (인정실적금액:LCPAMT ) 608   인정실적 금액변경 */
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '수수료기준가격' )     AS FEE_BASE_AMT   /* 수수료기준가격 (수수료기준가격:LCGUB5 ) 609  수수료 기준가격변경*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '수수료인정건수' )     AS FEE_ACKMT_CT   /* 수수료인정건수 (인정건수:LCPCNT ) 611 수수료 인정건수 변경*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '렌탈할인금액' )      AS RENTAL_DSC_AMT   /* 렌탈할인금액 (렌탈료DC금액:LCRAM1 ) 612  렌탈료DC 변경 */
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '제품고유번호' )      AS PDCT_IDNO   /* 제품고유번호 (변경시리얼 번호:LCSRNO ) 615  시리얼 번호 변경*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '시작기간' )        AS STP_STRT_YM   /* 시작기간(중지시작년월) : 중지기간(시작) :  STRYM2  ) 616   법인 코로나 렌탈중지 , 617   법인 코로나 렌탈중지 취소*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '종료기간' )        AS STP_END_YM   /* 종료기간 (중지종료년월)  (중지기간(종료) :  ENDYM, ENDYM2  616  법인 코로나 렌탈중지*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '휴대전화1' )       AS CRAL_LOCARA_TNO   /* 휴대전화1  (휴대전화1 :  LCCNO1 616   법인 코로나 렌탈중지*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '휴대전화2' )       AS MEXNO_ENCR   /* 휴대전화2  (휴대전화2 :  LCCNO2 616    법인 코로나 렌탈중지*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '휴대전화3' )       AS CRAL_IDV_TNO   /* 휴대전화3  (휴대전화3 :  LCCNO3 616  법인 코로나 렌탈중지*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '수수료정액여부' )     AS FEE_FXAM_YN   /* 수수료정액여부  (수수료 정액여부 :  LCST13 , 618  수수료 정액여부 변경*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '프로모션할인금액' )    AS PMOT_DSC_MCN   /* 할인개월 (수수료기준가격:LCGUB5 ) 619    프로모션 렌탈료 할인  (ASIS에서 수수료기준가격과 동일한 컬럼을 사용했었음.)*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '인정실적금액' )      AS PMOT_DSC_AMT   /* 할인금액 (인정실적금액:LCPAMT ) 619   프로모션 렌탈료 할인  (ASIS에서 인정실적금액과 동일한 컬럼을 사용했었음.)*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '인정실적금액' )      AS SDING_ACKMT_PERF_AMT   /* 수당건수 인정 (인정실적금액:LCPAMT ) 621    (모종)인정실적금액변경  (ASIS에서 수수료기준가격과 동일한 컬럼을 사용했었음.)*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '수수료기준가격' )     AS SDING_FEE_BASE_AMT   /* 수수료기준가격 (수수료기준가격:LCGUB5 ) 622    (모종)수수료기준가격변경  (ASIS에서 수수료기준가격과 동일한 컬럼을 사용했었음.)*/
             , T11.FEE_ACKMT_CT AS BFCH_FEE_ACKMT_CT    /* 수수료기준가격(현재,변경전) 626  (모종)수수료 인정건수 변경 */
             , T12.BFSVC_BZS_DV_CD                      /* BS업체구분코드  (업체BS구분 : LC349.LCFLG1,  0 - 일반BS, 1:업체BS  2:배송없음－요청시배송  ) 711  BS업체구분값 변경*/
             , T12.SPLY_BZS_DV_CD                       /* 조달업체구분코드 (업체구분 : LC349.LCFLG2 , 키위에서 사용  ) 711 BS업체구분값 변경*/
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 수수료정액여부 : Y|렌탈할인금액 : 123|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '컨택코드' )        AS CTT_TP_CD   /* 컨택유형코드 (컨택코드:LCCCDE ) 602    컨택코드 - 사용하지는 변경유형코드 */
             , (SELECT V /* MIG 데이타 기준 변경요청시 값 추출 EX) 예정일자 : 20230101|  */
                  FROM (SELECT TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 1)) AS K
                             , TRIM(REGEXP_SUBSTR(REGEXP_SUBSTR(T2.CNTR_CH_AK_CN, '[^|]+', 1, ROWNUM), '[^:]+', 1, 2)) AS V
                          FROM DUAL CONNECT BY ROWNUM <= LENGTH(NVL(REGEXP_REPLACE(T2.CNTR_CH_AK_CN, '[^|]+', ''), 0)) + 1 )
                  WHERE 1=1 AND K = '예정일자' )        AS DUEDT   /* 예정일자 (예정일자:LCDEMT ) 603  예정일자 - 사용하지는 변경유형코드 */
             ]]>
                 -------------------------------------------------------------
             , T1.CNTR_CH_AK_CN /* 계약변경요청내용 : (비고 : LCMEMO)*/
             , RPAD(T2.FST_RGST_DTM, 14, '0') AS FST_RGST_DTM
             , T2.FST_RGST_USR_ID   /* 최초등록사용자 (등록자 : REGNO) */
             , F_CMZ_USR_NM(T2.FST_RGST_USR_ID) AS FST_RGST_USR_NM /* 최초등록사용자명 (이름 : ISCNAM)*/
          FROM TB_SSCT_CNTR_CH_RCP_BAS T1          /* T.계약변경접수기본 (ASIS:RNTL_BNDE_CHNG) */
         INNER JOIN TB_SSCT_CNTR_CH_RCP_DTL T2    /* T.계약변경접수상세 (ASIS:RNTL_BNDE_CHNG) */
            ON T2.CNTR_CH_RCP_ID = T1.CNTR_CH_RCP_ID
           AND T2.DTA_DL_YN = 'N'
         INNER JOIN TB_SSCT_CNTR_BAS T10            /* T.계약기본 */
            ON T10.CNTR_NO = T2.DTL_CNTR_NO
           AND T10.DTA_DL_YN = 'N'
         INNER JOIN TB_SSCT_CNTR_DTL T11            /* T.계약상세  LC3100P*/
            ON T11.CNTR_NO = T2.DTL_CNTR_NO
           AND T11.CNTR_SN = T2.DTL_CNTR_SN
           AND T11.DTA_DL_YN = 'N'
          LEFT OUTER  JOIN TB_SSCT_CNTR_WELLS_DTL T12  /* T.WELLS상세 */
            ON T12.CNTR_NO = T11.CNTR_NO
           AND T12.CNTR_SN = T11.CNTR_SN
           AND T12.DTA_DL_YN = 'N'
         WHERE T1.DTA_DL_YN = 'N'
           AND T11.SELL_TP_CD = '2' /*판매유형코드 : 렌탈/리스(2) */
           AND T1.CNTR_CH_TP_CD  = #{cntrChTpCd} /* P1.기본조회조건 : 계약변경유형코드(필수) */
           <choose>
               <when test='@MybatisUtils@equals(srchDiv, "2")'>
                    /* P3.구분상세 : 계약번호 선택시 */
                    AND T2.DTL_CNTR_NO  = #{cntrNo}
                    AND T2.DTL_CNTR_SN  = #{cntrSn}
               </when>
               <otherwise>
                   /* P2.구분상세 : 반영년월 선택시 : 등록일자 기간 */
                   AND T2.FST_RGST_DTM BETWEEN  #{srchDt}||'01000000' AND #{srchDt}|| '31235959'
               </otherwise>
           </choose>
         ORDER BY T2.FST_RGST_DTM DESC
    </select>
    <select id="selectBulkChangeContractsInfs" resultType="com.kyowon.sms.wells.web.contract.changeorder.dto.WctbRentalBulkChangeDto$SearchCntrRes">
        SELECT (SELECT RCGVP_KNM
          FROM TB_SSCT_CNTR_ADRPC_BAS
         WHERE DTA_DL_YN = 'N'
           AND CNTR_ADRPC_ID = T3.CNTR_ADRPC_ID
             ) AS RCGVP_KNM /*수령자명*/
             , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'COPN_DV_CD', COPN_DV_CD)
                  FROM TB_SSCT_CNTR_ADRPC_BAS
                 WHERE DTA_DL_YN = 'N'
                   AND CNTR_ADRPC_ID = T3.CNTR_ADRPC_ID
                ) AS COPN_DV_CD 	/*법인격구분코드*/
             , T1.CNTR_PD_STRTDT /*계약상품시작일자 - 매출일*/
             , CASE WHEN T1.CNTR_PD_STRTDT IS NULL THEN NULL
                    ELSE
               CASE WHEN STPL_PTRM_UNIT_CD = 10 THEN ADD_MONTHS(T1.CNTR_PD_STRTDT, 12 * STPL_PTRM)
            		WHEN STPL_PTRM_UNIT_CD = 20 THEN ADD_MONTHS(T1.CNTR_PD_STRTDT, STPL_PTRM)
            		WHEN STPL_PTRM_UNIT_CD = 30 THEN TO_DATE(T1.CNTR_PD_STRTDT, 'YYYYMMDD') + (STPL_PTRM * 7)
            		WHEN STPL_PTRM_UNIT_CD = 40 THEN TO_DATE(T1.CNTR_PD_STRTDT, 'YYYYMMDD') + STPL_PTRM
               END
               END AS STPL_END_DT	/*약정종료일*/
             , CASE WHEN T1.CNTR_PD_STRTDT IS NULL THEN NULL
                    ELSE
               CASE WHEN CNTR_PTRM_UNIT_CD = 10 THEN ADD_MONTHS(T1.CNTR_PD_STRTDT, 12 * CNTR_PTRM)
            	    WHEN CNTR_PTRM_UNIT_CD = 20 THEN ADD_MONTHS(T1.CNTR_PD_STRTDT, CNTR_PTRM)
            		WHEN CNTR_PTRM_UNIT_CD = 30 THEN TO_DATE(T1.CNTR_PD_STRTDT, 'YYYYMMDD') + (CNTR_PTRM * 7)
            		WHEN CNTR_PTRM_UNIT_CD = 40 THEN TO_DATE(T1.CNTR_PD_STRTDT, 'YYYYMMDD') + CNTR_PTRM
               END
               END AS CNTR_END_DT /*계약만료일*/
             , T1.CNTR_PD_ENDDT AS CNTR_PD_CANDT /*취소일자*/
             , T1.CNTR_DTL_STAT_CD	/*계약상세상태코드-해지여부*/
             , (SELECT CASE WHEN COUNT(*) > 0 THEN 'Y'
                            ELSE 'N'
                       END
                  FROM TB_CBCL_WELLS_SL_MM_CL_IZ
                 WHERE DTA_DL_YN = 'N'
                   AND CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
               ) AS CL_CRT_YN	/*매출생성여부*/
             , (SELECT CASE WHEN COUNT(*) > 0 THEN 'Y'
                            ELSE 'N'
                       END
                  FROM TB_CBCL_WELLS_SL_MM_CL_IZ
                 WHERE DTA_DL_YN = 'N'
                   AND CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
                   AND SL_CL_YM = SUBSTR(T1.CNTR_PD_STRTDT, 1, 6)
                   AND (THM_ATAM_DP_AMT > 0 OR THM_ATAM_RFND_AMT > 0)
               ) AS CL_DP_YN	/*매출입금여부*/
             , T1.SPP_DUEDT /*배송예정일자*/
             , T2.IST_MM_BIL_MTHD_TP_CD	/*설치월청구방식유형코드*/
             , T1.SELL_TP_DTL_CD	/*판매유형상세코드-리스구분*/
             , T1.STPL_PTRM 	/*약정기간*/
             , T1.ISTM_MCN 		/*할부개월수*/
             , T1.BASE_PD_CD 	/*제품코드*/
             , T1.CTT_RS_CD 	/*캔택결과코드*/
             , T1.CNTR_NO||'-'||T1.CNTR_SN AS CNTR_DTL_NO /* 계약상세번호 */
             , T1.CNTR_NO
             , T1.CNTR_SN
             , TO_CHAR(SYSDATE, 'YYYYMM') AS CUR_YM	/*현재년월*/
             , (SELECT CASE WHEN COUNT(*) > 0 THEN 'Y' ELSE 'N' END
                  FROM TB_RVDW_SL_CTR_BAS /*매출조정기본*/
                 WHERE DTA_DL_YN = 'N'
                   AND CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
                   AND SL_CTR_SELL_TP_CD = '2'		/*매출조정판매유형코드 2:렌탈/리스*/
                   AND SL_CTR_MTR_DV_CD = '1'		/*매출조정자료구분코드 1:매출*/
                   AND SL_CTR_MTR_TP_CD = '3'		/*매출조정자료유형코드 - 설치월면제 */
               ) AS EXMT_YN		/*청구여부*/
             , (SELECT PD_PRP_VAL02 AS IST_BZS_CD
		           --, F_CMZ_CD_NM('TNT_WELLS', 'IST_BZS_CD', PD_PRP_VAL02) AS NM
		          FROM TB_PDBS_PD_ECOM_PRP_DTL A
                 WHERE 1=1
		           AND PD_CD = T1.BASE_PD_CD
		           AND PD_EXTS_PRP_GRP_CD = 'SPP'
		           AND PD_PRP_VAL02 IS NOT NULL
                     ) AS IST_BZS_CD /*설치업체*/
             , T2.IST_DT 		/*설치일자*/
             , T4.CNTR_RCP_FSH_DTM 	/*계약접수완료일시*/
             , T4.CNTR_CNFM_DTM 	/*주문확정일자*/
             , T1.SELL_DSC_CTR_AMT	/*판매할인조정금액-렌탈할인*/
             , (SELECT PD_PRP_VAL11 AS ENVR_ELHM_YN
                  FROM TB_PDBS_PD_ECOM_PRP_DTL A
                  WHERE 1=1
                   AND PD_CD = T1.BASE_PD_CD
                   AND PD_EXTS_PRP_GRP_CD = 'IND'
                   AND PD_PRP_VAL11 IS NOT NULL
               ) AS ENVR_ELHM_YN 	/*환경가전여부*/
             , (SELECT F_CMZ_CD_NM('TNT_WELLS', 'SV_IST_PCSV_DV_CD', PD_PRP_VAL01)
                     --, PD_PRP_VAL01 AS IST_PCSV_TP_CD
                  FROM TB_PDBS_PD_ECOM_PRP_DTL A
                 WHERE 1=1
                   AND PD_CD = T1.BASE_PD_CD
                   AND PD_EXTS_PRP_GRP_CD = 'SPP'
                   AND PD_PRP_VAL01 IS NOT NULL
               ) AS IST_PCSV_TP_CD	/*설치택배구분*/
             , T1.CNTR_PD_ENDDT 	/*계약상품종료일자*/
             , (SELECT CASE WHEN COUNT(*) > 0 THEN 'Y' ELSE 'N' END
                  FROM TB_SSSO_PDCT_IDNO_OSTR_IZ	/*제품고유번호출고내역*/
                 WHERE DTA_DL_YN = 'N'
                   AND CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
                   AND OSTR_SN = 0
                   AND SELL_TP_CD = '2'
               ) AS SERL_YN		/*시리얼파일 존재여부*/
             , (SELECT CASE WHEN ((B.EOT_UC_AMT - B.BTD_UC_AMT) - A.THM_ATAM_DP_AMT) > 0  THEN ((B.EOT_UC_AMT - B.BTD_UC_AMT) - A.THM_ATAM_DP_AMT) 		/*렌탈 전월연체금(기말미수금 - 기초미수금), 선수금(당월선수금입금금액)*/
                            ELSE 0
                       END
                  FROM TB_CBCL_WELLS_SL_MM_CL_IZ A
                  LEFT OUTER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ B
                    ON B.DTA_DL_YN ='N'
                   AND B.SL_CL_YM = TO_CHAR(ADD_MONTHS(SYSDATE, -1), 'YYYYMM')
                   AND B.CNTR_NO = A.CNTR_NO
                   AND B.CNTR_SN = A.CNTR_SN
                 WHERE A.DTA_DL_YN = 'N'
                   AND A.CNTR_NO = T1.CNTR_NO
                   AND A.CNTR_SN = T1.CNTR_SN
                   AND A.SL_CL_YM = TO_CHAR(SYSDATE, 'YYYYMM')
               ) AS DLQ_AMT		/*연체금*/
             , (SELECT SL_CL_YM
                  FROM TB_CBCL_WELLS_SL_MM_CL_IZ
                 ORDER BY SL_CL_YM DESC
                 FETCH FIRST 1 ROWS ONLY
               )  AS LASTLCPAY /*마지막 매출 집계 년월*/
             , (SELECT BOR_AMT
                  FROM TB_SSCT_CNTR_RSG_PROCS_IZ
                 WHERE DTA_DL_YN = 'N'
                   AND CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
               ) AS BOR_AMT 	/*위약금*/
             , T2.REQD_DT 		/*철거일자*/
             , '' AS CURSLEYN /*이번달 매출 생성 여부 TODO : 컬럼 미정 */
             , (SELECT BASE_DTL_CNTR_NO||BASE_DTL_CNTR_SN
                  FROM TB_SSCT_CNTR_REL
                 WHERE DTA_DL_YN = 'N'
                   AND OJ_DTL_CNTR_NO = T1.CNTR_NO
                   AND OJ_DTL_CNTR_SN = T1.CNTR_SN
                   AND CNTR_REL_DTL_CD = '216'	/*216:모종결합*/
               ) AS SDING_CNTR				/*모종결합계약번호*/
             , (SELECT CNTR_STAT_CH_RSON_CD		/*계약상태변경사유코드*/
                  FROM TB_SSCT_CNTR_RSG_PROCS_IZ
                 WHERE DTA_DL_YN = 'N'
                   AND CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
               ) AS CNTR_STAT_CH_RSON_CD		/*계약상태변경사유코드-취소유형*/
             , T1.ALNCMP_CD AS ALNCMP_CD /* 제휴사코드 */
             , T1.BOO_SELL_TP_CD AS BOO_SELL_TP_CD /* 예약판매유형코드 */
             , T1.CNTR_PTRM /* 계약기간 */
             , T1.BF_ORD_NO /* 이전주문번호 */
             , T1.ACKMT_PERF_AMT /* 인정실적금액 */
             , T1.FEE_ACKMT_BASE_AMT AS FEE_ACKMT_AMT /* 수수료인정기준금액 */
             , T1.FEE_ACKMT_CT /* 수수료인정건수 */
             , ( SELECT PDCT_IDNO
                   FROM TB_SSSO_PDCT_IDNO_OSTR_IZ
                  WHERE DTA_DL_YN = 'N'
		            AND CNTR_NO = T1.CNTR_NO
 		            AND CNTR_SN = T1.CNTR_SN
     	            AND SELL_TP_CD = '2'
                    AND OSTR_SN = '0') AS PDCT_IDNO /* 출고일련번호 */
             , T1.FEE_FXAM_YN AS FEE_FXAM /* 수수료정액여부 */
             , T1.DSC_AMT AS CNTR_DSC_AMT /* 할인금액 */
             , T1.ALNCMP_CNTR_DRM_VAL AS ALNCMP_CNTR_DRM_VAL /* 제휴사계약식별값 */
             , T2.PRM_APY_DV_CD AS PRM_APY_DV_CD /* 선납적용구분코드 */
             , T2.BFSVC_BZS_DV_CD
             , T2.SPLY_BZS_DV_CD	/*조달업체구분코드*/
          FROM TB_SSCT_CNTR_DTL T1	/*계약상세*/
         INNER JOIN TB_SSCT_CNTR_WELLS_DTL T2 /*계약WELLS상세*/
            ON T2.CNTR_NO = T1.CNTR_NO
           AND T2.CNTR_SN = T1.CNTR_SN
           AND T2.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SSCT_CNTR_ADR_REL T3	/*계약주소관계*/
            ON T3.DTL_CNTR_NO = T1.CNTR_NO
           AND T3.DTL_CNTR_SN = T1.CNTR_SN
           AND T3.ADRPC_TP_CD = '3'  /*3:설치주소*/
           AND T3.VL_END_DTM = '99991231235959'
           AND T3.DTA_DL_YN = 'N'
         INNER JOIN TB_SSCT_CNTR_BAS T4	/*계약기본*/
            ON T4.CNTR_NO = T1.CNTR_NO
           AND T1.DTA_DL_YN = 'N'
         WHERE T1.DTA_DL_YN = 'N'
           AND T1.CNTR_NO = #{cntrNo}
           AND T1.CNTR_SN = #{cntrSn}
        --변경유형 621,622,626 일때는 정기배송포함
           AND T1.SELL_TP_CD = '2'
        <if test='@MybatisUtils@equals(procsDv, "621") or @MybatisUtils@equals(procsDv, "622") or @MybatisUtils@equals(procsDv, "626")'>
            OR (    T1.SELL_TP_CD = '6'
                AND T1.BASE_PD_CD IN
                  ( SELECT A2.PD_CD                            /* 상품코드 */
	                  FROM TB_PDBS_PD_CLSF_BAS A1           /* T.상품분류기본 상품분류ID =참조상품분류값 */
	                 INNER JOIN TB_PDBS_PD_BAS A2           /* T.상품기본 */
	                    ON A2.PD_CLSF_ID = A1.PD_CLSF_ID    /* 상품분류ID */
	                   AND A2.DTA_DL_YN = 'N'
	                 WHERE 1=1
	                   AND A1.DTA_DL_YN = 'N'
	                   AND A1.USE_YN = 'Y'
	                   AND A1.PD_TP_CD = 'P'
	                   AND A1.TEMP_SAVE_YN = 'N'
	                   AND A1.REF_PD_CLSF_VAL = '05001001' /*웰스팜 */
	              )
               )
        </if>
    </select>
    <!-- 데이터의 INSERT/UPDATE/유효시작일시/유효종료일시를 일관되게 맞추기 위해, 미리 조회해온다. -->
    <select id="selectDateTime" resultType="com.kyowon.sms.wells.web.contract.changeorder.dvo.WctbRentalBulkChangeDvo">
        /* 데이터의 INSERT/UPDATE/유효시작일시/유효종료일시를 일관되게 맞추기 위해, 미리 조회해온다. */
        SELECT TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') AS FST_RGST_DTM
             , #{session.userId} AS FST_RGST_USR_ID
             , #{session.pageId} AS FST_RGST_PRG_ID
             , #{session.ogId} AS FST_RGST_DEPT_ID
             , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') AS FNL_MDFC_DTM
             , #{session.userId} AS FNL_MDFC_USR_ID
             , #{session.pageId} AS FNL_MDFC_PRG_ID
             , #{session.ogId} AS FNL_MDFC_DEPT_ID
          FROM DUAL
    </select>

    <!-- 매출조정_기간별 매출 조정 등록 여부 -->
    <select id="selectRegyn" resultType="java.lang.String">
        SELECT (CASE WHEN COUNT(*)  > 0 THEN 'Y' ELSE 'N' END) AS REGYN
          FROM TB_RVDW_SL_CTR_BAS
         WHERE DTA_DL_YN = 'N'
           AND CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
           AND SL_CTR_SELL_TP_CD = '2'
	       AND SL_CTR_DSC_TP_CD = '31' /*31:법인코로나렌탈중지*/
        <if test='@MybatisUtils@equals(procsDv, "616")'>
           AND SL_CTR_STRT_YM BETWEEN #{stpPrdStrtYm} AND #{stpPrdEndYm}
        </if>
        <if test='@MybatisUtils@equals(procsDv, "617")'>
           AND SL_CTR_STRT_YM = #{stpCanYm}
        </if>
    </select>
    <!-- 렌탈취소원복시 이전 상태 조회 -->
    <select id="selectBfCntrDtlStatCd" resultType="java.lang.String">
        SELECT CNTR_DTL_STAT_CD        /*계약상세상태코드*/
          FROM TB_SSCT_CNTR_DCH_HIST
         WHERE 1=1
           AND CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
           AND HIST_END_DTM = (
                        SELECT T1.FNL_MDFC_DTM
                          FROM TB_SSCT_CNTR_CH_RCP_DTL T1
                         INNER JOIN TB_SSCT_CNTR_CH_RCP_BAS T2
                            ON T2.DTA_DL_YN = 'N'
                           AND T2.CNTR_CH_RCP_ID = T1.CNTR_CH_RCP_ID
                         WHERE T1.DTA_DL_YN = 'N'
                           AND T1.CNTR_CH_SN = 1
                           AND T1.DTL_CNTR_NO = #{cntrNo}
                           AND T1.DTL_CNTR_SN = #{cntrSn}
                           AND T2.CNTR_CH_TP_CD = '607'    /*607:접수취소*/
                             )
    </select>
    <!-- 매출조정_주문별 특정 유형 기간 합계 -->
    <select id="selectRegMm" resultType="int">
        SELECT NVL(SUM(MONTHS_BETWEEN(TO_DATE(SL_CTR_END_YM, 'YYYYMM'),  TO_DATE(SL_CTR_STRT_YM, 'YYYYMM')) + 1), 0) AS REGYN	/*매출조정종료년월 - 매출조정시작년월 + 1*/
		  FROM TB_RVDW_SL_CTR_BAS
		 WHERE DTA_DL_YN = 'N'
		   AND CNTR_NO = #{cntrNo}
		   AND CNTR_SN = #{cntrSn}
		   AND SL_CTR_SELL_TP_CD = '2'
		   AND SL_CTR_DSC_TP_CD = '31' /*31:법인코로나렌탈중지*/
    </select>
    <select id="selectLifeCstCdStatus" resultType="com.kyowon.sms.wells.web.contract.changeorder.dvo.WctbRentalBulkChangeDvo">
        SELECT /*kr.co.wells.mapper.as400.cust.CustMapper.getKL3000PInfo*/
		       KLYEAR,	--KL30_YEAR
               KLCODE,  --KL30_CODE
			   KLETC6/*41:포인트플러스,51:플래너상조제휴*/,
			   KLICDE,
			   KLFLG8,
			   KLFLG9,
			   KLREVY,
			   KLCANY,
			   CASE WHEN KLFLG8 = SUBSTR(#{bfOrdNo},1,4) THEN 1 ELSE 2 END AS KLFLG8_GUBUN1,
			   CASE WHEN KLFLG9 = SUBSTR(#{bfOrdNo},5) THEN 1 ELSE 2 END AS KLFLG8_GUBUN2,
               CASE WHEN KLICDE IN ('2018','2028') THEN '54'
												WHEN KLETC6 = '51' THEN '70'
												ELSE '55'
											END AS ALNCMP_CD
										 , KLYEAR||KLCODE AS ALNCMP_CNTR_DRM_VAL
		  FROM TB_IFIN_LIF_ORD_RCV_ETXT LIF_MST /*ZA_라이프주문수신전문*/
		 WHERE KLYEAR = SUBSTR(#{lifeCstCd},1,4)
	       AND  KLCODE = SUBSTR(#{lifeCstCd},5)
    </select>
    <select id="selectOtherLifeCstCdMapping" resultType="com.kyowon.sms.wells.web.contract.changeorder.dvo.WctbRentalBulkChangeDvo">
        SELECT T1.CNTR_NO
			 , T1.CNTR_SN
			 , T1.ALNCMP_CD	/*제휴사코드*/
			 , T3.PRM_APY_DV_CD	/*선납적용구분코드*/
			 , T1.ALNCMP_CNTR_DRM_VAL /*제휴사계약식별값*/
			 , T2.CNTR_CST_NO
		  FROM TB_SSCT_CNTR_DTL T1
		 INNER JOIN TB_SSCT_CNTR_BAS T2
		    ON T2.DTA_DL_YN ='N'
		   AND T2.CNTR_NO = T1.CNTR_NO
		 INNER JOIN TB_SSCT_CNTR_WELLS_DTL T3
		    ON T3.DTA_DL_YN ='N'
		   AND T3.CNTR_NO = T1.CNTR_NO
		   AND T3.CNTR_SN = T1.CNTR_SN
		 WHERE T1.DTA_DL_YN = 'N'
		<if test='@MybatisUtils@isEmpty(klyear)'>
		   AND T1.CNTR_NO = #{cntrNo}
		   AND T1.CNTR_SN = #{cntrSn}
		</if>
		<if test='@MybatisUtils@isNotEmpty(klyear)'>
		   AND T1.ALNCMP_CNTR_DRM_VAL = RPAD(#{lifeCstCd},14,'0')
		   AND NOT ( T1.CNTR_NO = #{cntrNo}
                 AND T1.CNTR_SN = #{cntrSn})
		</if>
    </select>

    <!-- 계약상세업데이트 -->
    <update id="updateCntrDtl">
        UPDATE TB_SSCT_CNTR_DTL /* 계약상세 */
           SET FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
        <if test='@MybatisUtils@equals(procsDv, "601")'>
             , CNTR_DTL_STAT_CD = #{cntrDtlStatCd}
        </if>
        <if test='@MybatisUtils@equals(procsDv, "605")'>
             , STPL_PTRM = #{dutyPtrmEnd}
        </if>
        <if test='@MybatisUtils@equals(procsDv, "607")'>
             , CNTR_DTL_STAT_CD = '303'
        </if>
        <if test='@MybatisUtils@equals(procsDv, "608") or @MybatisUtils@equals(procsDv, "621")'>
             , ACKMT_PERF_AMT = #{pdAccRslt}
        </if>
        <if test='@MybatisUtils@equals(procsDv, "609") or @MybatisUtils@equals(procsDv, "622")'>
             , FEE_ACKMT_BASE_AMT = #{feeAckmtBaseAmt}
        </if>
        <if test='@MybatisUtils@equals(procsDv, "611") or @MybatisUtils@equals(procsDv, "626")'>
             , FEE_ACKMT_CT = #{feeAckmtCnt}
        </if>
        <if test='@MybatisUtils@equals(procsDv, "616") or @MybatisUtils@equals(procsDv, "617")'>
             , STPL_PTRM = #{stplPtrm}
		     , CNTR_PTRM = #{cntrPtrm}
		     , CNTR_PD_ENDDT = #{cntrPdEnddt}
        </if>
        <if test='@MybatisUtils@equals(procsDv, "618")'>
             , FEE_FXAM_YN = #{feeFxamYn}
        </if>
        <if test='@MybatisUtils@equals(procsDv, "619")'>
             , DSC_AMT = #{dscAmt}
             --입력 할인개월 => TODO:매핑없음
        </if>
        <if test='@MybatisUtils@equals(procsDv, "624") or @MybatisUtils@equals(procsDv, "625")'>
             , (ALNCMP_CD,ALNCMP_CNTR_DRM_VAL)=(
									SELECT CASE WHEN A.KLICDE IN ('2018','2028') THEN '54'
												WHEN A.KLETC6 = '51' THEN '70'
												ELSE '55'
											END AS ALNCMP_CD
										 , KLYEAR||KLCODE AS ALNCMP_CNTR_DRM_VAL
									  FROM TB_IFIN_LIF_ORD_RCV_ETXT A /*ZA_라이프주문수신전문*/
									 WHERE A.KLYEAR=#{klyear} AND A.KLCODE=#{klcode}
									)
        </if>
         WHERE CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
    </update>
    <!-- 계약wells상세 업데이트 -->
    <update id="updateCntrWellsDtl">
        UPDATE TB_SSCT_CNTR_WELLS_DTL /* 계약wells상세 */
           SET FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
        <if test='@MybatisUtils@equals(procsDv, "604")'>
             , IST_MM_BIL_MTHD_TP_CD = '2' /*2:익월부터*/
        </if>
        <if test='@MybatisUtils@equals(procsDv, "613")'>
             , IST_DT = #{paramIstDt}
        </if>
        <if test='@MybatisUtils@equals(procsDv, "624") or @MybatisUtils@equals(procsDv, "625")'>
             , PRM_APY_DV_CD = '2'        /* 선납적용구분코드 2:렌탈전기간불가*/
        </if>
        <if test='@MybatisUtils@equals(procsDv, "711")'>
            <if test='@MybatisUtils@isNotEmpty(modBfsvcBzsDvCd)'>
                 , BFSVC_BZS_DV_CD = #{modBfsvcBzsDvCd} /* BS업체구분코드 */
            </if>
            <if test='@MybatisUtils@isNotEmpty(modSplyBzsDvCd)'>
                 , SPLY_BZS_DV_CD = #{modSplyBzsDvCd} /* 조달업체구분코드 */
            </if>
        </if>
         WHERE CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
    </update>
    <!-- 제품고유번호출고내역 업데이트 -->
    <update id="updatePdctIdnoOstrIz">
        UPDATE TB_SSSO_PDCT_IDNO_OSTR_IZ
		   SET PDCT_IDNO = #{serialNo}
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
		 WHERE DTA_DL_YN = 'N'
		   AND CNTR_NO = #{cntrNo}
 		   AND CNTR_SN = #{cntrSn}
           AND OSTR_SN = '0'
     	   AND SELL_TP_CD = '2'
    </update>

    <update id="updateCntrDtlClear">
	    UPDATE TB_SSCT_CNTR_DTL
		   SET ALNCMP_CD = NULL
		     , ALNCMP_CNTR_DRM_VAL = NULL
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
		 WHERE CNTR_NO = #{cntrNo}
		   AND CNTR_SN = #{cntrSn}
	</update>
    <insert id="insertAcmpalCntrIz">
		INSERT INTO TB_SSCT_ACMPAL_CNTR_IZ (  /* 관계사제휴계약내역 */
		       ACMPAL_CNTR_ID   /* 관계사제휴계약ID */
		     , BASE_CNTR_NO     /* 기준계약번호 */
		     , BASE_CNTR_SN     /* 기준계약일련번호 */
		     , OJ_ORD_NO        /* 대상주문번호 */
		     , SELL_TP_CD       /* 판매유형코드 */
		     , ALNCMP_CD        /* 제휴사코드 */
		     , ALNC_STAT_TP_CD  /* 제휴상태유형코드 */
		     --, ALNC_CNTR_DT     /* 제휴계약일자 */
		     --, ALNC_CAN_DT      /* 제휴취소일자 */
		     --, ALNC_CAN_RSON_CD /* 제휴취소사유코드 */
		     --, ALNC_J_AC_N      /* 제휴가입계좌수 */
		     --, DTA_DL_YN        /* 데이터삭제여부 */
		<include refid="COMMON.insertSystemField" />)
		  VALUES (
		           ( SELECT NVL(MAX(ACMPAL_CNTR_ID), 0) + 1
		               FROM TB_SSCT_ACMPAL_CNTR_IZ
		           )
		       , #{cntrNo}
		       , #{cntrSn}
		       , #{라이프고객코드}
		       , '2'		/*2:렌탈/리스*/
		       , '70'		/*70:플래너상조제휴*/
		       , '10'		/*10:제휴정상*/
		       --, #{alncCntrDt}
		       --, #{alncCanDt}
		       --, #{alncCanRsonCd}
		       --, #{alncJAcN}
		       --, #{dtaDlYn}
                 , #{fstRgstDtm}
                 , #{fstRgstUsrId}
                 , #{fstRgstPrgId}
                 , #{fstRgstDeptId}
                 , #{fnlMdfcDtm}
                 , #{fnlMdfcUsrId}
                 , #{fnlMdfcPrgId}
                 , #{fnlMdfcDeptId})
	</insert>
    <!-- 계약변경접수기본 생성 -->
    <insert id="insertCntrChRcpBas">
		<selectKey keyProperty="info.cntrChRcpId" resultType="java.lang.String" order="BEFORE">
            SELECT LPAD(TO_CHAR(NVL(MAX(TO_NUMBER(CNTR_CH_RCP_ID)), 0)+1),15,0)
              FROM TB_SSCT_CNTR_CH_RCP_BAS
        </selectKey>
		INSERT INTO TB_SSCT_CNTR_CH_RCP_BAS (  /* 계약변경접수기본 */
			  CNTR_CH_RCP_ID       /* 계약변경접수ID */
			, CNTR_CH_RCP_DTM      /* 계약변경접수일시 */
			, CNTR_CH_TP_CD        /* 계약변경유형코드 */
			, CH_RQR_DV_CD         /* 변경요청자구분코드 */
			, CNTR_CH_AK_CN        /* 계약변경요청내용 */
			, CNTR_CH_PRGS_STAT_CD /* 계약변경진행상태코드 */
			--, CH_RCST_DV_CD        /* 변경접수자구분코드 */
			, CH_RCP_USR_ID        /* 변경접수사용자ID */
			, APR_DTM              /* 승인일시 */
			, APR_USR_ID           /* 승인사용자ID */
			, CNTR_CH_FSH_DTM      /* 계약변경완료일시 */
			<include refid="COMMON.insertSystemField" />)
		VALUES (
			  #{info.cntrChRcpId}
			, #{info.fstRgstDtm}			/*작업일시*/
			, #{info.procsDv}   			/*처리구분 선택값 : 계약변경유형 710 ~ 711 */
			, '2'							/*2:교원*/
			, #{info.cntrChAkCn}
			, '50'							/*50:처리완료*/
			--, 변경접수자구분코드
			, #{session.employeeIDNumber}	/*로그인유저ID*/
			, #{info.fstRgstDtm}				/*작업일시*/
			, #{session.employeeIDNumber}	/*로그인유저ID*/
			, #{info.fstRgstDtm}			/*작업일시*/
			, #{info.fstRgstDtm}
            , #{info.fstRgstUsrId}
            , #{info.fstRgstPrgId}
            , #{info.fstRgstDeptId}
            , #{info.fnlMdfcDtm}
            , #{info.fnlMdfcUsrId}
            , #{info.fnlMdfcPrgId}
            , #{info.fnlMdfcDeptId}  )
	</insert>
	<!-- 계약변경접수상세 생성 -->
	<insert id="insertCntrChRcpDtl">
		INSERT INTO TB_SSCT_CNTR_CH_RCP_DTL (  /* 계약변경접수상세 */
			  CNTR_CH_RCP_ID     /* 계약변경접수ID */
			, CNTR_CH_SN         /* 계약변경일련번호 */
			, CNTR_UNIT_TP_CD    /* 계약단위유형코드 */
			, DTL_CNTR_NO        /* 상세계약번호 */
			, DTL_CNTR_SN        /* 상세계약일련번호 */
			, CNTR_CH_AK_CN      /* 계약변경요청내용 */
			, BFCH_CN            /* 변경전내용 */
			, PROCS_YN           /* 처리여부 */
			, PROCS_FSH_DTM      /* 처리완료일시 */
			<include refid="COMMON.insertSystemField" />)
		VALUES (
			  #{info.cntrChRcpId}		/*계약변경기본에서 생성한 ID */
			, 1							/*순번 */
			, '020'						/*020:계약상세*/
			, #{info.cntrNo}
			, #{info.cntrSn}
			, #{info.cntrChAkCn}
			, #{info.bfchCn}
			, 'Y'
			, #{info.fstRgstDtm}     /*작업일시*/
			, #{info.fstRgstDtm}
            , #{info.fstRgstUsrId}
            , #{info.fstRgstPrgId}
            , #{info.fstRgstDeptId}
            , #{info.fnlMdfcDtm}
            , #{info.fnlMdfcUsrId}
            , #{info.fnlMdfcPrgId}
            , #{info.fnlMdfcDeptId} )
	</insert>

    <!-- 계약WELLS상세변경이력 -->
    <update id="updateCntrWellsDchHist">
        UPDATE TB_SSCT_CNTR_WELLS_DCH_HIST /* 계약WELLS상세변경이력 */
           SET HIST_END_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
           AND HIST_END_DTM = '99991231235959'
    </update>
    <insert id="insertCntrWellsDchHist">
        INSERT INTO TB_SSCT_CNTR_WELLS_DCH_HIST (
              CNTR_NO
            , CNTR_SN
            , HIST_STRT_DTM
            , HIST_END_DTM
            , FRISU_BFSVC_PTRM_UNIT_CD
            , FRISU_BFSVC_PTRM_N
            , FRISU_AS_PTRM_UNIT_CD
            , FRISU_AS_PTRM_N
            , IST_DT
            , REQD_DT
            , CPS_DT
            , PRM_APY_DV_CD
            , PRM_PTRM_MCN
            , SELL_EV_CD
            , BFSVC_BZS_DV_CD
            , SPLY_BZS_DV_CD
            , OCO_CPS_BZS_DV_CD
            , HCR_DV_CD
            , FMMB_N
            , FRISU_RCVRY_TP_CD
            , IST_PLC_TP_CD
            , WRFR_IST_MTH_CD
            , WTQLTY_TST_YN
            , SRCWT_TP_CD
            , WPRS_ITST_TP_CD
            , USE_ELECT_TP_CD
            , TBHS_EYN
            , STVLV_EYN
            , KUMON_ITRDT_DV_CD
            , KUMON_CST_IDK_VAL
            , KUMON_RCOMR_IDK_VAL
            , OTSD_LK_DRM_VAL
            , FRISU_MSH_CRT_YN
            , IST_MM_BIL_MTHD_TP_CD
            , CO_IST_DV_CD
            , CO_IST_MNGT_DV_CD
            , CO_IST_USWY_CD
            , IST_AK_ARTC_MO_CN
            , SCON_CN
            , DTA_DL_YN
            <include refid="COMMON.insertSystemField" />
        ) SELECT CNTR_NO
               , CNTR_SN
               , #{fstRgstDtm}
               , '99991231235959'
               , FRISU_BFSVC_PTRM_UNIT_CD
               , FRISU_BFSVC_PTRM_N
               , FRISU_AS_PTRM_UNIT_CD
               , FRISU_AS_PTRM_N
               , IST_DT
               , REQD_DT
               , CPS_DT
               , PRM_APY_DV_CD
               , PRM_PTRM_MCN
               , SELL_EV_CD
               , BFSVC_BZS_DV_CD
               , SPLY_BZS_DV_CD
               , OCO_CPS_BZS_DV_CD
               , HCR_DV_CD
               , FMMB_N
               , FRISU_RCVRY_TP_CD
               , IST_PLC_TP_CD
               , WRFR_IST_MTH_CD
               , WTQLTY_TST_YN
               , SRCWT_TP_CD
               , WPRS_ITST_TP_CD
               , USE_ELECT_TP_CD
               , TBHS_EYN
               , STVLV_EYN
               , KUMON_ITRDT_DV_CD
               , KUMON_CST_IDK_VAL
               , KUMON_RCOMR_IDK_VAL
               , OTSD_LK_DRM_VAL
               , FRISU_MSH_CRT_YN
               , IST_MM_BIL_MTHD_TP_CD
               , CO_IST_DV_CD
               , CO_IST_MNGT_DV_CD
               , CO_IST_USWY_CD
               , IST_AK_ARTC_MO_CN
               , SCON_CN
               , DTA_DL_YN
               , #{fstRgstDtm}
               , #{fstRgstUsrId}
               , #{fstRgstPrgId}
               , #{fstRgstDeptId}
               , #{fnlMdfcDtm}
               , #{fnlMdfcUsrId}
               , #{fnlMdfcPrgId}
               , #{fnlMdfcDeptId}
            FROM TB_SSCT_CNTR_WELLS_DTL
           WHERE CNTR_NO = #{cntrNo}
             AND CNTR_SN = #{cntrSn}
    </insert>
    <!-- 계약상세변경이력 -->
    <update id="updateCntrDchHist" >
        UPDATE TB_SSCT_CNTR_DCH_HIST /* 계약상세변경이력 */
           SET HIST_END_DTM        = #{fnlMdfcDtm}      /* 이력종료일시 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND CNTR_NO             = #{cntrNo}              /* 계약번호 */
           AND CNTR_SN             = #{cntrSn}              /* 계약일련번호 */
           AND HIST_END_DTM        = '99991231235959'
    </update>
    <insert id="insertCntrDchHist" >
        INSERT INTO TB_SSCT_CNTR_DCH_HIST  (  /* 계약상세변경이력 */
              CNTR_NO             /* 계약번호 */
            , HIST_STRT_DTM       /* 이력시작일시 */
            , CNTR_SN             /* 계약일련번호 */
            , HIST_END_DTM        /* 이력종료일시 */
            , BASE_PD_CD          /* 기준상품코드 */
            , HGR_PD_CD           /* 상위상품코드 */
            , PD_QTY              /* 상품수량 */
            , SELL_TP_CD          /* 판매유형코드 */
            , SELL_TP_DTL_CD      /* 판매유형상세코드 */
            , CNTR_DTL_STAT_CD    /* 계약상세상태코드 */
            , CNTR_PTRM_UNIT_CD   /* 계약기간단위코드 */
            , CNTR_PTRM           /* 계약기간 */
            , CNTR_PD_STRTDT      /* 계약상품시작일자 */
            , CNTR_PD_ENDDT       /* 계약상품종료일자 */
            , STPL_PTRM_UNIT_CD   /* 약정기간단위코드 */
            , STPL_PTRM           /* 약정기간 */
            , SV_PTRM_UNIT_CD     /* 서비스기간단위코드 */
            , SV_PRD              /* 서비스주기 */
            , CNTRW_TP_CD         /* 계약서유형코드 */
            , BLG_CRP_CD          /* 소속법인코드 */
            , RVE_CRP_CD          /* 수납법인코드 */
            , CO_CD               /* 회사코드 */
            , BOO_SELL_TP_CD      /* 예약판매유형코드 */
            , PD_GD_CD            /* 상품등급코드 */
            , PD_HCLSF_ID         /* 상품대분류ID */
            , PD_MCLSF_ID         /* 상품중분류ID */
            , PD_LCLSF_ID         /* 상품소분류ID */
            , PD_DCLSF_ID         /* 상품세분류ID */
            , SELL_DSC_DV_CD      /* 판매할인구분코드 */
            , SELL_DSCR_CD        /* 판매할인율코드 */
            , SELL_DSC_CTR_AMT    /* 판매할인조정금액 */
            , SELL_DSC_TP_CD      /* 판매할인유형코드 */
            , STLM_TP_CD          /* 결제유형코드 */
            , CRNCY_DV_CD         /* 통화구분코드 */
            , APY_EXCR            /* 적용환율 */
            , PD_BASE_AMT         /* 상품기준금액 */
            , SELL_AMT            /* 판매금액 */
            , DSC_AMT             /* 할인금액 */
            , FNL_AMT             /* 최종금액 */
            , VAT                 /* 부가가치세 */
            , CNTR_AMT            /* 계약금액 */
            , CNTRAM_DSC_AMT      /* 계약금할인금액 */
            , ISTM_MCN            /* 할부개월수 */
            , ISTM_PCAM_AMT       /* 할부원금금액 */
            , ISTM_INT_AMT        /* 할부이자금액 */
            , MM_ISTM_AMT         /* 월할부금액 */
            , CRP_UC_AMT          /* 법인미수금액 */
            , SELL_FEE            /* 판매수수료 */
            , CNTR_TAM            /* 계약총액 */
            , ACKMT_PERF_RT       /* 인정실적율 */
            , ACKMT_PERF_AMT      /* 인정실적금액 */
            , CVT_PERF_AMT        /* 환산실적금액 */
            , FEE_ACKMT_CT        /* 수수료인정건수 */
            , FEE_ACKMT_BASE_AMT  /* 수수료인정기준금액 */
            , FEE_FXAM_YN         /* 수수료정액여부 */
            , SPP_DUEDT           /* 배송예정일자 */
            , RESUB_YN            /* 재구독여부 */
            , RSTL_YN             /* 재약정여부 */
            , FRISU_YN            /* 무상여부 */
            , FRISU_DSB_TP_CD     /* 무상지급유형코드 */
            , TXINV_PBL_OJ_YN     /* 세금계산서발행대상여부 */
            , ALNCMP_CD           /* 제휴사코드 */
            , ALNCMP_CNTR_DRM_VAL /* 제휴사계약식별값 */
            , SMTPL_ID            /* 스마트플랜ID */
            , SMTPL_SN            /* 스마트플랜일련번호 */
            , CTT_OJ_ID           /* 컨택대상ID */
            , CTT_RS_CD           /* 컨택결과코드 */
            , CTT_PSIC_ID         /* 컨택담당자ID */
            , BF_ORD_NO           /* 이전주문번호 */
            , CNTR_CH_RCP_ID      /* 계약변경접수ID */
            , CNTR_CH_SN          /* 계약변경일련번호 */
            , CNTR_CH_DTL_AK_CN   /* 계약변경상세요청내용 */
            , DTA_DL_YN           /* 데이터삭제여부 */
            <include refid="COMMON.insertSystemField" />)
       SELECT CNTR_NO             /* 계약번호 */
            , #{fstRgstDtm}       /* 이력시작일시 */
            , CNTR_SN             /* 계약일련번호 */
            , '99991231235959'        /* 이력종료일시 */
            , BASE_PD_CD          /* 기준상품코드 */
            , HGR_PD_CD           /* 상위상품코드 */
            , PD_QTY              /* 상품수량 */
            , SELL_TP_CD          /* 판매유형코드 */
            , SELL_TP_DTL_CD      /* 판매유형상세코드 */
            , CNTR_DTL_STAT_CD    /* 계약상세상태코드 */
            , CNTR_PTRM_UNIT_CD   /* 계약기간단위코드 */
            , CNTR_PTRM           /* 계약기간 */
            , CNTR_PD_STRTDT      /* 계약상품시작일자 */
            , CNTR_PD_ENDDT       /* 계약상품종료일자 */
            , STPL_PTRM_UNIT_CD   /* 약정기간단위코드 */
            , STPL_PTRM           /* 약정기간 */
            , SV_PTRM_UNIT_CD     /* 서비스기간단위코드 */
            , SV_PRD              /* 서비스주기 */
            , CNTRW_TP_CD         /* 계약서유형코드 */
            , BLG_CRP_CD          /* 소속법인코드 */
            , RVE_CRP_CD          /* 수납법인코드 */
            , CO_CD               /* 회사코드 */
            , BOO_SELL_TP_CD      /* 예약판매유형코드 */
            , PD_GD_CD            /* 상품등급코드 */
            , PD_HCLSF_ID         /* 상품대분류ID */
            , PD_MCLSF_ID         /* 상품중분류ID */
            , PD_LCLSF_ID         /* 상품소분류ID */
            , PD_DCLSF_ID         /* 상품세분류ID */
            , SELL_DSC_DV_CD      /* 판매할인구분코드 */
            , SELL_DSCR_CD        /* 판매할인율코드 */
            , SELL_DSC_CTR_AMT    /* 판매할인조정금액 */
            , SELL_DSC_TP_CD      /* 판매할인유형코드 */
            , STLM_TP_CD          /* 결제유형코드 */
            , CRNCY_DV_CD         /* 통화구분코드 */
            , APY_EXCR            /* 적용환율 */
            , PD_BASE_AMT         /* 상품기준금액 */
            , SELL_AMT            /* 판매금액 */
            , DSC_AMT             /* 할인금액 */
            , FNL_AMT             /* 최종금액 */
            , VAT                 /* 부가가치세 */
            , CNTR_AMT            /* 계약금액 */
            , CNTRAM_DSC_AMT      /* 계약금할인금액 */
            , ISTM_MCN            /* 할부개월수 */
            , ISTM_PCAM_AMT       /* 할부원금금액 */
            , ISTM_INT_AMT        /* 할부이자금액 */
            , MM_ISTM_AMT         /* 월할부금액 */
            , CRP_UC_AMT          /* 법인미수금액 */
            , SELL_FEE            /* 판매수수료 */
            , CNTR_TAM            /* 계약총액 */
            , ACKMT_PERF_RT       /* 인정실적율 */
            , ACKMT_PERF_AMT      /* 인정실적금액 */
            , CVT_PERF_AMT        /* 환산실적금액 */
            , FEE_ACKMT_CT        /* 수수료인정건수 */
            , FEE_ACKMT_BASE_AMT  /* 수수료인정기준금액 */
            , FEE_FXAM_YN         /* 수수료정액여부 */
            , SPP_DUEDT           /* 배송예정일자 */
            , RESUB_YN            /* 재구독여부 */
            , RSTL_YN             /* 재약정여부 */
            , FRISU_YN            /* 무상여부 */
            , FRISU_DSB_TP_CD     /* 무상지급유형코드 */
            , TXINV_PBL_OJ_YN     /* 세금계산서발행대상여부 */
            , ALNCMP_CD           /* 제휴사코드 */
            , ALNCMP_CNTR_DRM_VAL /* 제휴사계약식별값 */
            , SMTPL_ID            /* 스마트플랜ID */
            , SMTPL_SN            /* 스마트플랜일련번호 */
            , CTT_OJ_ID           /* 컨택대상ID */
            , CTT_RS_CD           /* 컨택결과코드 */
            , CTT_PSIC_ID         /* 컨택담당자ID */
            , BF_ORD_NO           /* 이전주문번호 */
            , CNTR_CH_RCP_ID      /* 계약변경접수ID */
            , CNTR_CH_SN          /* 계약변경일련번호 */
            , CNTR_CH_DTL_AK_CN   /* 계약변경상세요청내용 */
            , DTA_DL_YN           /* 데이터삭제여부 */
            , #{fstRgstDtm}
            , #{fstRgstUsrId}
            , #{fstRgstPrgId}
            , #{fstRgstDeptId}
            , #{fnlMdfcDtm}
            , #{fnlMdfcUsrId}
            , #{fnlMdfcPrgId}
            , #{fnlMdfcDeptId}
         FROM TB_SSCT_CNTR_DTL    /* 계약상세 */
        WHERE 1 = 1
          AND CNTR_NO = #{cntrNo} /* 계약번호 */
          AND CNTR_SN = #{cntrSn} /* 계약일련번호 */
    </insert>
    <!-- 계약상세상태변경이력 -->
    <update id="updateCntrDtlStatChangeHist">
        UPDATE TB_SSCT_CNTR_DTL_STAT_CH_HIST
           SET HIST_END_DTM             = #{fnlMdfcDtm}  /* 이력종료일시 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND CNTR_NO                  = #{cntrNo}                  /* 계약번호 */
           AND CNTR_SN                  = #{cntrSn}                  /* 계약일련번호 */
           AND HIST_END_DTM             = '99991231235959'           /* 이력종료일시 */
     </update>
    <insert id="insertCntrDtlStatChangeHist">
         INSERT INTO TB_SSCT_CNTR_DTL_STAT_CH_HIST (
                CNTR_NO
              , CNTR_SN
              , HIST_STRT_DTM
              , HIST_END_DTM
              , CNTR_DTL_STAT_CD
              , CNTR_DTL_STAT_CH_RSON_CD
              , CNTR_DTL_STAT_CH_MO_CN
              , DTA_DL_YN
              <include refid="COMMON.insertSystemField" />)
         SELECT CNTR_NO
              , CNTR_SN
              , #{fstRgstDtm}
              , '99991231235959'
              , CNTR_DTL_STAT_CD
              , ''
              , CNTR_CH_DTL_AK_CN
              , 'N'
              , #{fstRgstDtm}
              , #{fstRgstUsrId}
              , #{fstRgstPrgId}
              , #{fstRgstDeptId}
              , #{fnlMdfcDtm}
              , #{fnlMdfcUsrId}
              , #{fnlMdfcPrgId}
              , #{fnlMdfcDeptId}
           FROM TB_SSCT_CNTR_DTL
          WHERE CNTR_NO = #{cntrNo}
            AND CNTR_SN = #{cntrSn}
     </insert>
    <!-- 계약변경접수변경이력 -->
    <insert id="insertCntrChRcchHist">
         INSERT INTO TB_SSCT_CNTR_CH_RCCH_HIST (  /* 계약변경접수변경이력 */
              CNTR_CH_RCP_ID       /* 계약변경접수ID */
            , HIST_STRT_DTM        /* 이력시작일시 */
            , HIST_END_DTM         /* 이력종료일시 */
            , CNTR_CH_RCP_DTM      /* 계약변경접수일시 */
            , CNTR_CH_TP_CD        /* 계약변경유형코드 */
            , CH_RQR_DV_CD         /* 변경요청자구분코드 */
            , CH_RQR_NM            /* 변경요청자명 */
            , CST_NO               /* 고객번호 */
            , CNTR_CH_AK_CN        /* 계약변경요청내용 */
            , CNTR_CH_PRGS_STAT_CD /* 계약변경진행상태코드 */
            , CNTR_CH_PRGS_MO_CN   /* 계약변경진행메모내용 */
            , CH_RCST_DV_CD        /* 변경접수자구분코드 */
            , CH_RCP_USR_ID        /* 변경접수사용자ID */
            , APR_DTM              /* 승인일시 */
            , APR_USR_ID           /* 승인사용자ID */
            , CNTR_CH_FSH_DTM      /* 계약변경완료일시 */
            , BIZ_TF_ID            /* 업무이관ID */
            , DTA_DL_YN            /* 데이터삭제여부 */
            <include refid="COMMON.insertSystemField" />)
         SELECT CNTR_CH_RCP_ID       /* 계약변경접수ID */
                , #{fstRgstDtm} AS HIST_STRT_DTM
                , '99991231235959'
                , CNTR_CH_RCP_DTM      /* 계약변경접수일시 */
                , CNTR_CH_TP_CD        /* 계약변경유형코드 */
                , CH_RQR_DV_CD         /* 변경요청자구분코드 */
                , CH_RQR_NM            /* 변경요청자명 */
                , CST_NO               /* 고객번호 */
                , CNTR_CH_AK_CN        /* 계약변경요청내용 */
                , CNTR_CH_PRGS_STAT_CD /* 계약변경진행상태코드 */
                , CNTR_CH_PRGS_MO_CN   /* 계약변경진행메모내용 */
                , CH_RCST_DV_CD        /* 변경접수자구분코드 */
                , CH_RCP_USR_ID        /* 변경접수사용자ID */
                , APR_DTM              /* 승인일시 */
                , APR_USR_ID           /* 승인사용자ID */
                , CNTR_CH_FSH_DTM      /* 계약변경완료일시 */
                , BIZ_TF_ID            /* 업무이관ID */
                , DTA_DL_YN            /* 데이터삭제여부 */
                , #{fstRgstDtm}
                , #{fstRgstUsrId}
                , #{fstRgstPrgId}
                , #{fstRgstDeptId}
                , #{fnlMdfcDtm}
                , #{fnlMdfcUsrId}
                , #{fnlMdfcPrgId}
                , #{fnlMdfcDeptId}
           FROM TB_SSCT_CNTR_CH_RCP_BAS
          WHERE CNTR_CH_RCP_ID = #{cntrChRcpId}
    </insert>
    <!-- 계약변경접수상세변경이력 -->
    <insert id="insertCntrChRcpDchHist">
        INSERT INTO TB_SSCT_CNTR_CH_RCP_DCH_HIST /* 계약변경접수상세변경이력 */
             ( CNTR_CH_RCP_ID /* 계약변경접수ID */
             , HIST_STRT_DTM /* 이력시작일시 */
             , CNTR_CH_SN /* 계약변경일련번호 */
             , HIST_END_DTM /* 이력종료일시 */
             , CNTR_UNIT_TP_CD /* 계약단위유형코드 */
             , CNTR_NO /* 계약번호 */
             , DTL_CNTR_NO /* 상세계약번호 */
             , DTL_CNTR_SN /* 상세계약일련번호 */
             , CNTR_CH_RSON_DV_CD /* 계약변경사유구분코드 */
             , CNTR_CH_RSON_CD /* 계약변경사유코드 */
             , CNTR_CH_ATC_DV_CD /* 계약변경항목구분코드 */
             , CH_APY_STRTDT /* 변경적용시작일자 */
             , CH_APY_ENDDT /* 변경적용종료일자 */
             , CH_PD_CD /* 변경상품코드 */
             , CH_QTY /* 변경수량 */
             , CH_AMT /* 변경금액 */
             , CH_PTRM_UNIT_CD /* 변경기간단위코드 */
             , CH_PTRM_N /* 변경기간수 */
             , CNTR_CH_AK_CN /* 계약변경요청내용 */
             , CNTR_ADRPC_ID /* 계약주소지ID */
             , CNTR_STLM_ID /* 계약결제ID */
             , PROCS_YN /* 처리여부 */
             , BFCH_CN /* 변경전내용 */
             , PROCS_DUEDT /* 처리예정일자 */
             , PROCS_FSH_DTM /* 처리완료일시 */
             , DTA_DL_YN /* 데이터삭제여부 */
             <include refid="COMMON.insertSystemField"/>
             )
        SELECT CNTR_CH_RCP_ID /* 계약변경접수ID */
             , #{fstRgstDtm} /* 이력시작일시 */
             , CNTR_CH_SN /* 계약변경일련번호 */
             , '99991231235959' /* 이력종료일시 */
             , CNTR_UNIT_TP_CD /* 계약단위유형코드 */
             , CNTR_NO /* 계약번호 */
             , DTL_CNTR_NO /* 상세계약번호 */
             , DTL_CNTR_SN /* 상세계약일련번호 */
             , CNTR_CH_RSON_DV_CD /* 계약변경사유구분코드 */
             , CNTR_CH_RSON_CD /* 계약변경사유코드 */
             , CNTR_CH_ATC_DV_CD /* 계약변경항목구분코드 */
             , CH_APY_STRTDT /* 변경적용시작일자 */
             , CH_APY_ENDDT /* 변경적용종료일자 */
             , CH_PD_CD /* 변경상품코드 */
             , CH_QTY /* 변경수량 */
             , CH_AMT /* 변경금액 */
             , CH_PTRM_UNIT_CD /* 변경기간단위코드 */
             , CH_PTRM_N /* 변경기간수 */
             , CNTR_CH_AK_CN /* 계약변경요청내용 */
             , CNTR_ADRPC_ID /* 계약주소지ID */
             , CNTR_STLM_ID /* 계약결제ID */
             , PROCS_YN /* 처리여부 */
             , BFCH_CN /* 변경전내용 */
             , PROCS_DUEDT /* 처리예정일자 */
             , PROCS_FSH_DTM /* 처리완료일시 */
             , DTA_DL_YN /* 데이터삭제여부 */
             , #{fstRgstDtm}
             , #{fstRgstUsrId}
             , #{fstRgstPrgId}
             , #{fstRgstDeptId}
             , #{fnlMdfcDtm}
             , #{fnlMdfcUsrId}
             , #{fnlMdfcPrgId}
             , #{fnlMdfcDeptId}
          FROM TB_SSCT_CNTR_CH_RCP_DTL /* 계약변경접수상세 */
         WHERE CNTR_CH_RCP_ID = #{cntrChRcpId} /* 계약변경접수ID = 입력받은 계약변경접수ID */
           AND CNTR_CH_SN     = 1   /* 계약변경일련번호 */
    </insert>
</mapper>
