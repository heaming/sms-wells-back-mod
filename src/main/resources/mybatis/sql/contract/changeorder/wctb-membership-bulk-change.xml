<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.contract.changeorder.mapper.WctbMembershipBulkChangeMapper">
    <select id="selectMembershipBulkChanges" resultType="com.kyowon.sms.wells.web.contract.changeorder.dto.WctbMembershipBulkChangeDto$SearchRes">
        SELECT T1.CNTR_NO||'-'||T1.CNTR_SN AS CNTR_DTL_NO	/*상세계약번호*/
             , (SELECT CST_KNM FROM TB_CUBS_CST_BAS WHERE CST_NO = T2.CNTR_CST_NO) AS CST_KNM /* 계약자명 */
             , T2.SELL_INFLW_CHNL_DTL_CD	/*판매유입채널상세 - 판매구분*/
             , T1.SELL_TP_DTL_CD	/*판매유형상세코드 - 판매유형*/
             , T2.SELL_PRTNR_NO		/*판매파트너번호-대리인코드*/
             , (SELECT PRTNR_KNM FROM TB_OGBS_PRTNR_BAS WHERE PRTNR_NO = T2.SELL_PRTNR_NO AND  OG_TP_CD = T2.SELL_OG_TP_CD AND DTA_DL_YN='N') AS PRTNR_NM	/*판매파트너명*/
             , (SELECT RVE_CD FROM TB_OGBS_PRTNR_DTL WHERE OG_TP_CD = T2.SELL_OG_TP_CD AND PRTNR_NO = T2.SELL_PRTNR_NO) AS RVE_CD	/*수납코드*/
             , T3.REQD_DT	/*철거일자*/
             , T5.CNTR_CH_RCP_DTM	/*접수일-변경요청접수일*/
             , T3.IST_DT	/*설치일*/
             , T2.CNTR_STLM_FSH_DTM	/*계약결제완료일시-매출일자*/
             , T1.SV_PRD	/*서비스주기*/
             , '' AS USEYN /* 용도구분 TODO : 매핑안됨 */
             , T1.BASE_PD_CD	/*기준상품코드*/
             , (SELECT PD_NM FROM TB_PDBS_PD_BAS WHERE PD_CD = T1.BASE_PD_CD) AS PD_NM /* 상품명 */
             , T1.FNL_AMT		/*멤버쉽회비*/
             , T1.STLM_TP_CD	/*결제유형코드-납입방법*/
             , T3.FRISU_BFSVC_PTRM_N	/*무상BS기간수-멤버십무상*/
             , T1.CNTRW_TP_CD	/*계약서유형코드-멤버십구분*/
             , T1.STPL_PTRM		/*약정기간-멤버십기간*/
             , T2.CNTR_CNFM_APR_DTM	/*계약확정승인일시-확정일*/
             , (SELECT MIN(CAN_DT) KEEP(DENSE_RANK FIRST ORDER BY SL_CL_YM)
                   FROM TB_CBCL_WELLS_SL_MM_CL_IZ
                  WHERE DTA_DL_YN = 'N'
                    AND CNTR_NO = T1.CNTR_NO
                    AND CNTR_SN = T1.CNTR_SN
                ) AS CAN_DT 	/*취소일자*/
             , T1.SPP_DUEDT AS DUEDT /* 예정일(홈케어)-매핑후처리필요 계약상세변경이력:배송예정일자 */
             , T2.CNTR_CNFM_DTM		/*계약확정일시 -가입일:AS-IS대비 확인필요' */
             , (SELECT HIST_STRT_DTM
                  FROM TB_SSCT_CNTR_DTL_STAT_CH_HIST
                 WHERE CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
                   AND HIST_END_DTM = '99991231235959'
                   AND CNTR_DTL_STAT_CD IN ('301','302','303','401','402')
                ) AS WDWAL_DT    /*탈퇴일*/
             , (SELECT F_CMZ_CD_NM(#{session.tenantId}, 'SV_VST_PRD_CD', PD_PRP_VAL02)
                  FROM TB_PDBS_PD_ECOM_PRP_DTL
                 WHERE 1=1
                   AND PD_CD = T1.BASE_PD_CD
                   AND PD_EXTS_PRP_GRP_CD = 'SCHD'
                   AND PD_PRP_VAL03 IS NOT NULL )  AS VST_PRD	/*방문주기 */
             , F_CMZ_CD_NM(#{session.tenantId}, 'LC_CTT_RS_CD', T1.CTT_RS_CD) AS CTT_RS_NM	/*컨택코드*/
             , T1.CTT_PSIC_ID	/*컨택담당*/
             , (SELECT PRTNR_KNM FROM TB_OGBS_PRTNR_BAS WHERE PRTNR_NO = T1.CTT_PSIC_ID AND DTA_DL_YN = 'N') AS CTT_PSIC_NM	/*컨택담당명*/
             , T3.HCR_DV_CD		/*홈케어구분코드-상품구분*/
             , T1.FEE_FXAM_YN	/*수수료정액여부-정액여부(Y:수당제외)*/
             , T1.FEE_ACKMT_BASE_AMT	/*수수료인정기준금액-수수료기준금액*/
             , T1.SELL_DSC_DV_CD	/*판매할인구분코드-할인구분*/
             , T1.SELL_DSCR_CD	/*판매할인율코드-할인유형*/
             , '' AS GRP_GBN /* 그룹구분 TODO : 컬럼확인 필요 */
             , T1.FST_RGST_DTM	/*최초등록일시-입력일자*/
             , T1.FST_RGST_USR_ID	/*최초등록사용자ID-입력담당*/
             , (SELECT USR_NM FROM T_CMP_USR_ACO_M WHERE USR_ID = T1.FST_RGST_USR_ID) AS FST_RGST_USR_NM /*입력담당자명*/
             , T1.FNL_MDFC_DTM		/*최종수정일시-수정일자*/
             , T1.FNL_MDFC_USR_ID	/*최종수정사용자ID-수정담당*/
             , (SELECT USR_NM FROM T_CMP_USR_ACO_M WHERE USR_ID = T1.FNL_MDFC_USR_ID) AS FNL_MDFC_USR_NM	/*수정담당자명*/
             , T5.CNTR_CH_PRGS_MO_CN AS CNTR_CH_AK_CN /* 변경사유 */
          FROM TB_SSCT_CNTR_CH_RCP_DTL T4 	/*계약변경접수상세*/
         INNER JOIN TB_SSCT_CNTR_CH_RCP_BAS T5 	/*계약변경접수기본*/
            ON T5.DTA_DL_YN = 'N'
           AND T4.DTA_DL_YN = 'N'
           AND T5.CNTR_CH_RCP_ID = T4.CNTR_CH_RCP_ID
         INNER JOIN TB_SSCT_CNTR_DCH_HIST T1		/*계약상세변경이력*/
            ON T1.CNTR_NO = T4.DTL_CNTR_NO
           AND T1.CNTR_SN = T4.DTL_CNTR_SN
           AND T1.HIST_STRT_DTM <![CDATA[<=]]> T5.CNTR_CH_FSH_DTM
           AND T1.HIST_END_DTM <![CDATA[>]]> T5.CNTR_CH_FSH_DTM
           AND T1.DTA_DL_YN = 'N'
         INNER JOIN TB_SSCT_CNTR_CH_HIST T2	/*계약변경이력*/
            ON T2.CNTR_NO = T4.DTL_CNTR_NO
           AND T2.HIST_STRT_DTM <![CDATA[<=]]> T5.CNTR_CH_FSH_DTM
           AND T2.HIST_END_DTM <![CDATA[>]]> T5.CNTR_CH_FSH_DTM
           AND T2.CNTR_NO = T1.CNTR_NO
           AND T2.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SSCT_CNTR_WELLS_DCH_HIST T3  /*계약WELLS상세변경이력*/
            ON T3.CNTR_NO = T1.CNTR_NO
           AND T3.CNTR_SN = T1.CNTR_SN
           AND T3.DTA_DL_YN = 'N'
           AND T3.HIST_STRT_DTM <![CDATA[<=]]> T5.CNTR_CH_FSH_DTM
           AND T3.HIST_END_DTM <![CDATA[>]]> T5.CNTR_CH_FSH_DTM
         WHERE 1=1
           AND T1.SELL_TP_CD = '3'	/*멤버십*/
        <if test='@MybatisUtils@isNotEmpty(cntrNo)'>
            --조회조건 : 계약번호
           AND T1.CNTR_NO = #{cntrNo}
        </if>
        <if test='@MybatisUtils@isNotEmpty(cntrSn)'>
           AND T1.CNTR_SN = #{cntrSn}
        </if>
        <if test='@MybatisUtils@isNotEmpty(rfdt)'>
            -- 조회조건 : 반영년월
           AND SUBSTR(T5.CNTR_CH_FSH_DTM, 1, 8) = #{rfdt}
        </if>
         ORDER BY T1.CNTR_NO, T1.CNTR_SN, T5.CNTR_CH_RCP_DTM
    </select>
    <select id="selectMembershipBulkChangesContracts" resultType="com.kyowon.sms.wells.web.contract.changeorder.dto.WctbMembershipBulkChangeDto$SearchCntrRes">
        SELECT T1.CNTR_NO||'-'||T1.CNTR_SN	AS CNTR_DTL_NO /*계약상세번호*/
             , T1.CNTR_NO	/*계약번호*/
             , T1.CNTR_SN	/*계약일련번호*/
             , T2.SELL_INFLW_CHNL_DTL_CD	/*판매유입채널상세 - 판매구분*/
             , T1.SELL_TP_DTL_CD	/*판매유형상세코드 - 판매유형*/
             , T2.SELL_PRTNR_NO		/*판매파트너번호-대리인코드*/
             , (SELECT RVE_CD FROM TB_OGBS_PRTNR_DTL WHERE OG_TP_CD = T2.SELL_OG_TP_CD AND PRTNR_NO = T2.SELL_PRTNR_NO) AS RVE_CD	/*수납코드*/
             , T3.REQD_DT	/*철거일자*/
             , '' AS RCP_D    /* 접수일-변경요청접수일 */
             , T3.IST_DT	/*설치일*/
             , T1.CNTR_PD_STRTDT	/*계약상품시작일자-매출일자*/
             , (SELECT CST_KNM FROM TB_CUBS_CST_BAS WHERE CST_NO = T2.CNTR_CST_NO) AS CST_KNM	/*고객명*/
             , T1.SV_PRD	/*서비스주기*/
             , '' AS USEYN /* 용도구분-매핑안됨 */
             , T1.BASE_PD_CD	/*기준상품코드*/
             , (SELECT PD_NM FROM TB_PDBS_PD_BAS WHERE PD_CD = T1.BASE_PD_CD) AS PD_NM /* 상품명 */
             , T1.FNL_AMT		/*멤버쉽회비*/
             , T1.STLM_TP_CD	/*결제유형코드-납입방법*/
             , T3.FRISU_BFSVC_PTRM_N	/*무상BS기간수-멤버십무상*/
             , T1.CNTRW_TP_CD	/*계약서유형코드-멤버십구분*/
             , T1.STPL_PTRM		/*약정기간-멤버십기간*/
             , F_CMZ_CD_NM(#{session.tenantId}, 'STPL_PTRM_UNIT_CD', T1.STPL_PTRM_UNIT_CD) AS STPL_PTRM_UNIT_NM /*약정기간단위*/
             , T1.CNTR_PD_STRTDT AS DTRM_DATE	/*계약상품시작일자-확정일*/
             , T2.CNTR_CAN_DTM 		/*계약취소일시-취소일시*/
             --, T3.REQD_DT	/*철거일자-취소일자*/
             , '' AS DUEDT /* 예정일(홈케어)-매핑후처리필요 */
             , T2.CNTR_CNFM_DTM		/*계약확정일시 -가입일 TODO : 추후 재확인 필요 */
             , (SELECT HIST_STRT_DTM
                  FROM TB_SSCT_CNTR_DTL_STAT_CH_HIST
                 WHERE CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
                   AND HIST_END_DTM = '99991231235959'
                   AND CNTR_DTL_STAT_CD IN ('301','302','303','401','402')
                ) AS WDWAL_DT    /*탈퇴일*/
             , (SELECT F_CMZ_CD_NM(#{session.tenantId}, 'SV_VST_PRD_CD', PD_PRP_VAL02)
                  FROM TB_PDBS_PD_ECOM_PRP_DTL
                 WHERE 1=1
                   AND PD_CD = T1.BASE_PD_CD
                   AND PD_EXTS_PRP_GRP_CD = 'SCHD'
                   AND PD_PRP_VAL03 IS NOT NULL )  AS VST_PRD	/*방문주기 */
             , T1.CTT_RS_CD 	/*컨택코드*/
             , F_CMZ_CD_NM(#{session.tenantId}, 'LC_CTT_RS_CD', T1.CTT_RS_CD) AS CTT_RS_NM	/*컨택코드*/
             , T1.CTT_PSIC_ID	/*컨택담당*/
             , (SELECT USR_NM FROM T_CMP_USR_ACO_M WHERE USR_ID = T1.CTT_PSIC_ID) AS CTT_PSIC_NM	/*컨택담당명*/
             , T3.HCR_DV_CD	/*홈케어구분코드-상품구분*/
             , T1.FEE_FXAM_YN	/*수수료정액여부-정액여부(Y:수당제외)*/
             , T1.FEE_ACKMT_BASE_AMT	/*수수료인정기준금액-수수료기준금액*/
             , T1.SELL_DSC_DV_CD	/*판매할인구분코드-할인구분*/
             , T1.SELL_DSCR_CD	/*판매할인율코드-할인유형*/
             , T1.FST_RGST_DTM	/*최초등록일시-입력일자*/
             , T1.FST_RGST_USR_ID	/*최초등록사용자ID-입력담당*/
             , (SELECT USR_NM FROM T_CMP_USR_ACO_M WHERE USR_ID = T1.FST_RGST_USR_ID) AS FST_RGST_USR_NM /*입력담당자명*/
             , T1.FNL_MDFC_DTM		/*최종수정일시-수정일자*/
             , T1.FNL_MDFC_USR_ID	/*최종수정사용자ID-수정담당*/
             , (SELECT USR_NM FROM T_CMP_USR_ACO_M WHERE USR_ID = T1.FNL_MDFC_USR_ID) AS FNL_MDFC_USR_NM	/*수정담당자명*/
          FROM TB_SSCT_CNTR_DTL T1		/*계약상세*/
         INNER JOIN TB_SSCT_CNTR_BAS T2	/*계약기본*/
            ON T2.CNTR_NO = T1.CNTR_NO
           AND T2.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SSCT_CNTR_WELLS_DTL T3  /*계약WELLS상세*/
            ON T3.CNTR_NO = T1.CNTR_NO
           AND T3.CNTR_SN = T1.CNTR_SN
           AND T3.DTA_DL_YN = 'N'
         WHERE 1=1
           AND T1.DTA_DL_YN = 'N'
           AND T1.SELL_TP_CD = '3'	/*멤버십*/
        --조회조건 : 계약번호
           AND T1.CNTR_NO = #{cntrNo}
           AND T1.CNTR_SN = #{cntrSn}
    </select>
    <select id="selectFirstBznsYn" resultType="java.lang.String">
        SELECT CASE WHEN BASE_D = TO_CHAR(SYSDATE, 'DD')
                    THEN 'Y'
                    ELSE 'N'
               END AS FIRST_BZNS_YN	/* 현재일이 현재월의 첫영업일인지 여부 */
          FROM TB_RVCL_BIL_CLND_BAS	/*청구달력기본*/
         WHERE DTA_DL_YN = 'N'
           AND NVL(DF_YN, 'N') = 'N'
           AND NVL(PHLD_YN, 'N') = 'N'
           AND BASE_Y = TO_CHAR(SYSDATE, 'YYYY')
	       AND BASE_MM = TO_CHAR(SYSDATE, 'MM')
         ORDER BY BASE_D
         FETCH FIRST 1 ROW ONLY
    </select>
    <select id="selectDateTime" resultType="com.kyowon.sms.wells.web.contract.changeorder.dvo.WctbMembershipBulkChangeDvo">
        /* 데이터의 INSERT/UPDATE/유효시작일시/유효종료일시를 일관되게 맞추기 위해, 미리 조회해온다. */
        SELECT TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') AS FST_RGST_DTM
             , #{session.userId} AS FST_RGST_USR_ID
             , #{session.pageId} AS FST_RGST_PRG_ID
             , #{session.ogId} AS FST_RGST_DEPT_ID
             , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') AS FNL_MDFC_DTM
             , #{session.userId} AS FNL_MDFC_USR_ID
             , #{session.pageId} AS FNL_MDFC_PRG_ID
             , #{session.ogId} AS FNL_MDFC_DEPT_ID
          FROM DUAL
    </select>
    <select id="selectLstmmLstDays" resultType="java.lang.String">
        SELECT (TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('20230701','YYYY-MM-DD'), -1)), 'YYYYMMDD')) AS LSTMM_LST_DAYS/*확정일자 - 변경가입일자의 전월말일*/
	      FROM DUAL
    </select>
    <update id="updateCntrDtlSvcCncl">
        UPDATE TB_SSCT_CNTR_DTL /* 계약상세 */
           SET CTT_RS_CD = #{cttRsCd} /* 컨택결과코드 */
             , CNTR_DTL_STAT_CD = '303' /* 계약상세상태코드 303:계약취소 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND DTA_DL_YN = 'N'
           AND CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
    </update>
    <update id="updateCntrWellsDtlHomeCareJDtCh">
        UPDATE TB_SSCT_CNTR_WELLS_DTL /* 계약WELLS상세 */
           SET IST_DT = #{subsDt} /* 설치일자 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND DTA_DL_YN = 'N'
           AND CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
    </update>
    <update id="updateCntrDtlHomeCareJDtCh">
        UPDATE TB_SSCT_CNTR_DTL /* 계약상세 */
           SET CNTR_PD_STRTDT = #{subsDt} /* 계약상품시작일자 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND DTA_DL_YN = 'N'
           AND CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
    </update>
    <update id="updateCntrBasHomeCareJDtCh">
        UPDATE TB_SSCT_CNTR_BAS /* 계약기본 */
           SET CNTR_CNFM_DTM = #{subsDt} /* 계약확정일시 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND DTA_DL_YN = 'N'
           AND CNTR_NO = #{cntrNo}
    </update>
    <update id="updateCntrBasGeMshJDtCh">
        UPDATE TB_SSCT_CNTR_BAS /* 계약기본 */
           SET CNTR_CNFM_DTM = #{lstmmLstDays} /* 계약확정일시 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND DTA_DL_YN = 'N'
           AND CNTR_NO = #{cntrNo}
    </update>
    <update id="updateCntrDtlGeMshJDtCh">
        UPDATE TB_SSCT_CNTR_DTL /* 계약상세 */
           SET CNTR_PD_STRTDT = #{subsDt} /* 계약상품시작일자 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND DTA_DL_YN = 'N'
           AND CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
    </update>
    <update id="updateCntrDtlreceiptCncl">
        UPDATE TB_SSCT_CNTR_DTL /* 계약상세 */
           SET CNTR_PD_ENDDT = TO_CHAR(SYSDATE, 'YYYYMMDD') /* 계약상품종료일자 */
             , CTT_RS_CD = #{cttRsCd} /* 컨택결과코드 */
             , CNTR_DTL_STAT_CD = '303' /* 계약상세상태코드 303:계약취소 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND DTA_DL_YN = 'N'
           AND CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
    </update>
    <update id="updateCntrDtlStdFeeAmt">
        UPDATE TB_SSCT_CNTR_DTL /* 계약상세 */
           SET FEE_FXAM_YN = #{fxamYnCh} /* 수수료정액여부 */
             , FEE_ACKMT_BASE_AMT = #{pdStdFee} /* 수수료인정기준금액 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND DTA_DL_YN = 'N'
           AND CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
    </update>
    <insert id="insertCntrChRcpBas">
		<selectKey keyProperty="item.cntrChRcpId" resultType="java.lang.String" order="BEFORE">
            SELECT LPAD(TO_CHAR(NVL(MAX(TO_NUMBER(CNTR_CH_RCP_ID)), 0)+1),15,0)
              FROM TB_SSCT_CNTR_CH_RCP_BAS
        </selectKey>
		INSERT INTO TB_SSCT_CNTR_CH_RCP_BAS (  /* 계약변경접수기본 */
			  CNTR_CH_RCP_ID       /* 계약변경접수ID */
			, CNTR_CH_RCP_DTM      /* 계약변경접수일시 */
			, CNTR_CH_TP_CD        /* 계약변경유형코드 */
			, CH_RQR_DV_CD         /* 변경요청자구분코드 */
			, CNTR_CH_AK_CN        /* 계약변경요청내용 */
			, CNTR_CH_PRGS_STAT_CD /* 계약변경진행상태코드 */
            , CNTR_CH_PRGS_MO_CN   /* 계약변경진행메모내용 */
			--, CH_RCST_DV_CD        /* 변경접수자구분코드 TODO : 추후 확인 필요*/
			, CH_RCP_USR_ID        /* 변경접수사용자ID */
			, APR_DTM              /* 승인일시 */
			, APR_USR_ID           /* 승인사용자ID */
			, CNTR_CH_FSH_DTM      /* 계약변경완료일시 */
			<include refid="COMMON.insertSystemField" />)
		VALUES (
			  #{item.cntrChRcpId}
			, #{item.fstRgstDtm}			/*작업일시*/
			, #{item.procsDv}   			/*801:홈케어멤버십 서비스 취소, 802:홈케어멤버십 가입일자 변경, 803:일반멤버십 가입일자 변경, 804:접수 후 취소, 805:정액여부/기준수수료 변경 */
			, '2'							/*2:교원*/
			, #{item.cntrChAkCn}
			, '50'							/*50:처리완료*/
            , #{item.chRson}                /* 변경사유 */
			--, 'chRcstDvCd'
			, #{item.fstRgstUsrId}	/*로그인유저ID*/
			, #{item.fstRgstDtm}				/*작업일시*/
			, #{item.fstRgstUsrId}	/*로그인유저ID*/
			, #{item.fstRgstDtm}			/*작업일시		*/
			, #{item.fstRgstDtm}
            , #{item.fstRgstUsrId}
            , #{item.fstRgstPrgId}
            , #{item.fstRgstDeptId}
            , #{item.fnlMdfcDtm}
            , #{item.fnlMdfcUsrId}
            , #{item.fnlMdfcPrgId}
            , #{item.fnlMdfcDeptId} )
	</insert>
	<insert id="insertCntrChRcpDtl">
		INSERT INTO TB_SSCT_CNTR_CH_RCP_DTL (  /* 계약변경접수상세 */
			  CNTR_CH_RCP_ID     /* 계약변경접수ID */
			, CNTR_CH_SN         /* 계약변경일련번호 */
			, CNTR_UNIT_TP_CD    /* 계약단위유형코드 */
			, DTL_CNTR_NO        /* 상세계약번호 */
			, DTL_CNTR_SN        /* 상세계약일련번호 */
			--, CNTR_CH_RSON_DV_CD /* 계약변경사유구분코드 */
			--, CNTR_CH_RSON_CD    /* 계약변경사유코드 */
			--, CNTR_CH_ATC_DV_CD  /* 계약변경항목구분코드 */
			, CNTR_CH_AK_CN      /* 계약변경요청내용 */
			, BFCH_CN            /* 변경전내용 */
			, PROCS_YN           /* 처리여부 */
			, PROCS_FSH_DTM      /* 처리완료일시 */
			<include refid="COMMON.insertSystemField" />)
		VALUES (
			  #{item.cntrChRcpId}		/*계약변경기본에서 생성한 ID */
			, 1							/*순번 */
			, '020'						/*020:계약상세*/
			, #{item.cntrNo}
			, #{item.cntrSn}
			--, 'cntrChRsonDvCd'
			--, 'cntrChRsonCd'
			--, 'cntrChAtcDvCd'
			, #{item.cntrChAkCn}
			, #{item.bfchCn}
			, 'Y'
			, #{item.fstRgstDtm}     /*작업일시		*/
			, #{item.fstRgstDtm}
            , #{item.fstRgstUsrId}
            , #{item.fstRgstPrgId}
            , #{item.fstRgstDeptId}
            , #{item.fnlMdfcDtm}
            , #{item.fnlMdfcUsrId}
            , #{item.fnlMdfcPrgId}
            , #{item.fnlMdfcDeptId} )
	</insert>
    <update id="updateCntrDetailStatChangeHist">
        UPDATE TB_SSCT_CNTR_DTL_STAT_CH_HIST
           SET HIST_END_DTM             = #{fnlMdfcDtm}  /* 이력종료일시 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND CNTR_NO                  = #{cntrNo}                  /* 계약번호 */
           AND CNTR_SN                  = #{cntrSn}                  /* 계약일련번호 */
           AND HIST_END_DTM             = '99991231235959'           /* 이력종료일시 */
     </update>
    <insert id="insertCntrDetailStatChangeHist">
         INSERT INTO TB_SSCT_CNTR_DTL_STAT_CH_HIST (
                CNTR_NO
              , CNTR_SN
              , HIST_STRT_DTM
              , HIST_END_DTM
              , CNTR_DTL_STAT_CD
              , CNTR_DTL_STAT_CH_RSON_CD
              , CNTR_DTL_STAT_CH_MO_CN
              , DTA_DL_YN
              <include refid="COMMON.insertSystemField" />)
         SELECT CNTR_NO
              , CNTR_SN
              , #{fstRgstDtm}
              , '99991231235959'
              , CNTR_DTL_STAT_CD
              , ''
              , CNTR_CH_DTL_AK_CN
              , 'N'
              , #{fstRgstDtm}
              , #{fstRgstUsrId}
              , #{fstRgstPrgId}
              , #{fstRgstDeptId}
              , #{fnlMdfcDtm}
              , #{fnlMdfcUsrId}
              , #{fnlMdfcPrgId}
              , #{fnlMdfcDeptId}
           FROM TB_SSCT_CNTR_DTL
          WHERE CNTR_NO = #{cntrNo}
            AND CNTR_SN = #{cntrSn}
     </insert>
    <update id="updateCntrDchHist" >
        UPDATE TB_SSCT_CNTR_DCH_HIST /* 계약상세변경이력 */
           SET HIST_END_DTM        = #{fnlMdfcDtm}      /* 이력종료일시 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND CNTR_NO             = #{cntrNo}              /* 계약번호 */
           AND CNTR_SN             = #{cntrSn}              /* 계약일련번호 */
           AND HIST_END_DTM        = '99991231235959'
    </update>
    <insert id="insertCntrDchHist" >
        INSERT INTO TB_SSCT_CNTR_DCH_HIST  (  /* 계약상세변경이력 */
              CNTR_NO             /* 계약번호 */
            , HIST_STRT_DTM       /* 이력시작일시 */
            , CNTR_SN             /* 계약일련번호 */
            , HIST_END_DTM        /* 이력종료일시 */
            , BASE_PD_CD          /* 기준상품코드 */
            , HGR_PD_CD           /* 상위상품코드 */
            , PD_QTY              /* 상품수량 */
            , SELL_TP_CD          /* 판매유형코드 */
            , SELL_TP_DTL_CD      /* 판매유형상세코드 */
            , CNTR_DTL_STAT_CD    /* 계약상세상태코드 */
            , CNTR_PTRM_UNIT_CD   /* 계약기간단위코드 */
            , CNTR_PTRM           /* 계약기간 */
            , CNTR_PD_STRTDT      /* 계약상품시작일자 */
            , CNTR_PD_ENDDT       /* 계약상품종료일자 */
            , STPL_PTRM_UNIT_CD   /* 약정기간단위코드 */
            , STPL_PTRM           /* 약정기간 */
            , SV_PTRM_UNIT_CD     /* 서비스기간단위코드 */
            , SV_PRD              /* 서비스주기 */
            , CNTRW_TP_CD         /* 계약서유형코드 */
            , BLG_CRP_CD          /* 소속법인코드 */
            , RVE_CRP_CD          /* 수납법인코드 */
            , CO_CD               /* 회사코드 */
            , BOO_SELL_TP_CD      /* 예약판매유형코드 */
            , PD_GD_CD            /* 상품등급코드 */
            , PD_HCLSF_ID         /* 상품대분류ID */
            , PD_MCLSF_ID         /* 상품중분류ID */
            , PD_LCLSF_ID         /* 상품소분류ID */
            , PD_DCLSF_ID         /* 상품세분류ID */
            , SELL_DSC_DV_CD      /* 판매할인구분코드 */
            , SELL_DSCR_CD        /* 판매할인율코드 */
            , SELL_DSC_CTR_AMT    /* 판매할인조정금액 */
            , SELL_DSC_TP_CD      /* 판매할인유형코드 */
            , STLM_TP_CD          /* 결제유형코드 */
            , CRNCY_DV_CD         /* 통화구분코드 */
            , APY_EXCR            /* 적용환율 */
            , PD_BASE_AMT         /* 상품기준금액 */
            , SELL_AMT            /* 판매금액 */
            , DSC_AMT             /* 할인금액 */
            , FNL_AMT             /* 최종금액 */
            , VAT                 /* 부가가치세 */
            , CNTR_AMT            /* 계약금액 */
            , CNTRAM_DSC_AMT      /* 계약금할인금액 */
            , ISTM_MCN            /* 할부개월수 */
            , ISTM_PCAM_AMT       /* 할부원금금액 */
            , ISTM_INT_AMT        /* 할부이자금액 */
            , MM_ISTM_AMT         /* 월할부금액 */
            , CRP_UC_AMT          /* 법인미수금액 */
            , SELL_FEE            /* 판매수수료 */
            , CNTR_TAM            /* 계약총액 */
            , ACKMT_PERF_RT       /* 인정실적율 */
            , ACKMT_PERF_AMT      /* 인정실적금액 */
            , CVT_PERF_AMT        /* 환산실적금액 */
            , FEE_ACKMT_CT        /* 수수료인정건수 */
            , FEE_ACKMT_BASE_AMT  /* 수수료인정기준금액 */
            , FEE_FXAM_YN         /* 수수료정액여부 */
            , SPP_DUEDT           /* 배송예정일자 */
            , RESUB_YN            /* 재구독여부 */
            , RSTL_YN             /* 재약정여부 */
            , FRISU_YN            /* 무상여부 */
            , FRISU_DSB_TP_CD     /* 무상지급유형코드 */
            , TXINV_PBL_OJ_YN     /* 세금계산서발행대상여부 */
            , ALNCMP_CD           /* 제휴사코드 */
            , ALNCMP_CNTR_DRM_VAL /* 제휴사계약식별값 */
            , SMTPL_ID            /* 스마트플랜ID */
            , SMTPL_SN            /* 스마트플랜일련번호 */
            , CTT_OJ_ID           /* 컨택대상ID */
            , CTT_RS_CD           /* 컨택결과코드 */
            , CTT_PSIC_ID         /* 컨택담당자ID */
            , BF_ORD_NO           /* 이전주문번호 */
            , CNTR_CH_RCP_ID      /* 계약변경접수ID */
            , CNTR_CH_SN          /* 계약변경일련번호 */
            , CNTR_CH_DTL_AK_CN   /* 계약변경상세요청내용 */
            , DTA_DL_YN           /* 데이터삭제여부 */
            <include refid="COMMON.insertSystemField" />)
       SELECT CNTR_NO             /* 계약번호 */
            , #{fstRgstDtm}       /* 이력시작일시 */
            , CNTR_SN             /* 계약일련번호 */
            , '99991231235959'        /* 이력종료일시 */
            , BASE_PD_CD          /* 기준상품코드 */
            , HGR_PD_CD           /* 상위상품코드 */
            , PD_QTY              /* 상품수량 */
            , SELL_TP_CD          /* 판매유형코드 */
            , SELL_TP_DTL_CD      /* 판매유형상세코드 */
            , CNTR_DTL_STAT_CD    /* 계약상세상태코드 */
            , CNTR_PTRM_UNIT_CD   /* 계약기간단위코드 */
            , CNTR_PTRM           /* 계약기간 */
            , CNTR_PD_STRTDT      /* 계약상품시작일자 */
            , CNTR_PD_ENDDT       /* 계약상품종료일자 */
            , STPL_PTRM_UNIT_CD   /* 약정기간단위코드 */
            , STPL_PTRM           /* 약정기간 */
            , SV_PTRM_UNIT_CD     /* 서비스기간단위코드 */
            , SV_PRD              /* 서비스주기 */
            , CNTRW_TP_CD         /* 계약서유형코드 */
            , BLG_CRP_CD          /* 소속법인코드 */
            , RVE_CRP_CD          /* 수납법인코드 */
            , CO_CD               /* 회사코드 */
            , BOO_SELL_TP_CD      /* 예약판매유형코드 */
            , PD_GD_CD            /* 상품등급코드 */
            , PD_HCLSF_ID         /* 상품대분류ID */
            , PD_MCLSF_ID         /* 상품중분류ID */
            , PD_LCLSF_ID         /* 상품소분류ID */
            , PD_DCLSF_ID         /* 상품세분류ID */
            , SELL_DSC_DV_CD      /* 판매할인구분코드 */
            , SELL_DSCR_CD        /* 판매할인율코드 */
            , SELL_DSC_CTR_AMT    /* 판매할인조정금액 */
            , SELL_DSC_TP_CD      /* 판매할인유형코드 */
            , STLM_TP_CD          /* 결제유형코드 */
            , CRNCY_DV_CD         /* 통화구분코드 */
            , APY_EXCR            /* 적용환율 */
            , PD_BASE_AMT         /* 상품기준금액 */
            , SELL_AMT            /* 판매금액 */
            , DSC_AMT             /* 할인금액 */
            , FNL_AMT             /* 최종금액 */
            , VAT                 /* 부가가치세 */
            , CNTR_AMT            /* 계약금액 */
            , CNTRAM_DSC_AMT      /* 계약금할인금액 */
            , ISTM_MCN            /* 할부개월수 */
            , ISTM_PCAM_AMT       /* 할부원금금액 */
            , ISTM_INT_AMT        /* 할부이자금액 */
            , MM_ISTM_AMT         /* 월할부금액 */
            , CRP_UC_AMT          /* 법인미수금액 */
            , SELL_FEE            /* 판매수수료 */
            , CNTR_TAM            /* 계약총액 */
            , ACKMT_PERF_RT       /* 인정실적율 */
            , ACKMT_PERF_AMT      /* 인정실적금액 */
            , CVT_PERF_AMT        /* 환산실적금액 */
            , FEE_ACKMT_CT        /* 수수료인정건수 */
            , FEE_ACKMT_BASE_AMT  /* 수수료인정기준금액 */
            , FEE_FXAM_YN         /* 수수료정액여부 */
            , SPP_DUEDT           /* 배송예정일자 */
            , RESUB_YN            /* 재구독여부 */
            , RSTL_YN             /* 재약정여부 */
            , FRISU_YN            /* 무상여부 */
            , FRISU_DSB_TP_CD     /* 무상지급유형코드 */
            , TXINV_PBL_OJ_YN     /* 세금계산서발행대상여부 */
            , ALNCMP_CD           /* 제휴사코드 */
            , ALNCMP_CNTR_DRM_VAL /* 제휴사계약식별값 */
            , SMTPL_ID            /* 스마트플랜ID */
            , SMTPL_SN            /* 스마트플랜일련번호 */
            , CTT_OJ_ID           /* 컨택대상ID */
            , CTT_RS_CD           /* 컨택결과코드 */
            , CTT_PSIC_ID         /* 컨택담당자ID */
            , BF_ORD_NO           /* 이전주문번호 */
            , CNTR_CH_RCP_ID      /* 계약변경접수ID */
            , CNTR_CH_SN          /* 계약변경일련번호 */
            , CNTR_CH_DTL_AK_CN   /* 계약변경상세요청내용 */
            , DTA_DL_YN           /* 데이터삭제여부 */
            , #{fstRgstDtm}
            , #{fstRgstUsrId}
            , #{fstRgstPrgId}
            , #{fstRgstDeptId}
            , #{fnlMdfcDtm}
            , #{fnlMdfcUsrId}
            , #{fnlMdfcPrgId}
            , #{fnlMdfcDeptId}
         FROM TB_SSCT_CNTR_DTL    /* 계약상세 */
        WHERE 1 = 1
          AND CNTR_NO = #{cntrNo} /* 계약번호 */
          AND CNTR_SN = #{cntrSn} /* 계약일련번호 */
    </insert>
    <update id="updateContractWellsDetailHist">
        UPDATE TB_SSCT_CNTR_WELLS_DCH_HIST /* 계약WELLS상세변경이력 */
           SET HIST_END_DTM        = #{fnlMdfcDtm}      /* 이력종료일시 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND CNTR_NO                  = #{cntrNo}                  /* 계약번호 */
           AND CNTR_SN                  = #{cntrSn}                  /* 계약일련번호 */
           AND HIST_END_DTM             = '99991231235959'           /* 이력종료일시 */
    </update>
    <insert id="insertContractWellsDetailHist">
        INSERT INTO TB_SSCT_CNTR_WELLS_DCH_HIST (  /* 계약WELLS상세변경이력 */
              CNTR_NO                  /* 계약번호 */
            , CNTR_SN                  /* 계약일련번호 */
            , HIST_STRT_DTM            /* 이력시작일시 */
            , HIST_END_DTM             /* 이력종료일시 */
            , FRISU_BFSVC_PTRM_UNIT_CD /* 무상BS기간단위코드 */
            , FRISU_BFSVC_PTRM_N       /* 무상BS기간수 */
            , FRISU_AS_PTRM_UNIT_CD    /* 무상AS기간단위코드 */
            , FRISU_AS_PTRM_N          /* 무상AS기간수 */
            , IST_DT                   /* 설치일자 */
            , REQD_DT                  /* 철거일자 */
            , CPS_DT                   /* 보상일자 */
            , PRM_APY_DV_CD            /* 선납적용구분코드 */
            , PRM_PTRM_MCN             /* 선납기간개월수 */
            , SELL_EV_CD               /* 판매행사코드 */
            , BFSVC_BZS_DV_CD          /* BS업체구분코드 */
            , SPLY_BZS_DV_CD           /* 조달업체구분코드 */
            , OCO_CPS_BZS_DV_CD        /* 타사보상업체구분코드 */
            , HCR_DV_CD                /* 홈케어구분코드 */
            , FMMB_N                   /* 가구원수 */
            , FRISU_RCVRY_TP_CD        /* 무상복구유형코드 */
            , IST_PLC_TP_CD            /* 설치장소유형코드 */
            , WRFR_IST_MTH_CD          /* 정수기설치방법코드 */
            , WTQLTY_TST_YN            /* 수질검사여부 */
            , SRCWT_TP_CD              /* 상수원유형코드 */
            , WPRS_ITST_TP_CD          /* 수압강도유형코드 */
            , USE_ELECT_TP_CD          /* 사용전력유형코드 */
            , TBHS_EYN                 /* 튜빙호수유무 */
            , STVLV_EYN                /* 지수전유무 */
            , KUMON_ITRDT_DV_CD        /* 구몬소개구분코드 */
            , KUMON_CST_IDK_VAL        /* 구몬고객식별키값 */
            , KUMON_RCOMR_IDK_VAL      /* 구몬소개자식별키값 */
            , OTSD_LK_DRM_VAL          /* 외부연계식별값 */
            , FRISU_MSH_CRT_YN         /* 무상멤버십생성여부 */
            , IST_MM_BIL_MTHD_TP_CD    /* 설치월청구방식유형코드 */
            , CO_IST_DV_CD             /* 회사설치구분코드 */
            , CO_IST_MNGT_DV_CD        /* 회사설치관리구분코드 */
            , CO_IST_USWY_CD           /* 회사설치용도코드 */
            , IST_AK_ARTC_MO_CN        /* 설치요청사항메모내용 */
            , SCON_CN                  /* 특약내용 */
            , DTA_DL_YN                /* 데이터삭제여부 */
            <include refid="COMMON.insertSystemField" />)
       SELECT CNTR_NO                  /* 계약번호 */
            , CNTR_SN                  /* 계약일련번호 */
            , #{fstRgstDtm}             /* 이력시작일시 */
            , '99991231235959'         /* 이력종료일시 */
            , FRISU_BFSVC_PTRM_UNIT_CD /* 무상BS기간단위코드 */
            , FRISU_BFSVC_PTRM_N       /* 무상BS기간수 */
            , FRISU_AS_PTRM_UNIT_CD    /* 무상AS기간단위코드 */
            , FRISU_AS_PTRM_N          /* 무상AS기간수 */
            , IST_DT                   /* 설치일자 */
            , REQD_DT                  /* 철거일자 */
            , CPS_DT                   /* 보상일자 */
            , PRM_APY_DV_CD            /* 선납적용구분코드 */
            , PRM_PTRM_MCN             /* 선납기간개월수 */
            , SELL_EV_CD               /* 판매행사코드 */
            , BFSVC_BZS_DV_CD          /* BS업체구분코드 */
            , SPLY_BZS_DV_CD           /* 조달업체구분코드 */
            , OCO_CPS_BZS_DV_CD        /* 타사보상업체구분코드 */
            , HCR_DV_CD                /* 홈케어구분코드 */
            , FMMB_N                   /* 가구원수 */
            , FRISU_RCVRY_TP_CD        /* 무상복구유형코드 */
            , IST_PLC_TP_CD            /* 설치장소유형코드 */
            , WRFR_IST_MTH_CD          /* 정수기설치방법코드 */
            , WTQLTY_TST_YN            /* 수질검사여부 */
            , SRCWT_TP_CD              /* 상수원유형코드 */
            , WPRS_ITST_TP_CD          /* 수압강도유형코드 */
            , USE_ELECT_TP_CD          /* 사용전력유형코드 */
            , TBHS_EYN                 /* 튜빙호수유무 */
            , STVLV_EYN                /* 지수전유무 */
            , KUMON_ITRDT_DV_CD        /* 구몬소개구분코드 */
            , KUMON_CST_IDK_VAL        /* 구몬고객식별키값 */
            , KUMON_RCOMR_IDK_VAL      /* 구몬소개자식별키값 */
            , OTSD_LK_DRM_VAL          /* 외부연계식별값 */
            , FRISU_MSH_CRT_YN         /* 무상멤버십생성여부 */
            , IST_MM_BIL_MTHD_TP_CD    /* 설치월청구방식유형코드 */
            , CO_IST_DV_CD             /* 회사설치구분코드 */
            , CO_IST_MNGT_DV_CD        /* 회사설치관리구분코드 */
            , CO_IST_USWY_CD           /* 회사설치용도코드 */
            , IST_AK_ARTC_MO_CN        /* 설치요청사항메모내용 */
            , SCON_CN                  /* 특약내용 */
            , DTA_DL_YN                /* 데이터삭제여부 */
            , #{fstRgstDtm}
            , #{fstRgstUsrId}
            , #{fstRgstPrgId}
            , #{fstRgstDeptId}
            , #{fnlMdfcDtm}
            , #{fnlMdfcUsrId}
            , #{fnlMdfcPrgId}
            , #{fnlMdfcDeptId}
         FROM TB_SSCT_CNTR_WELLS_DTL
        WHERE CNTR_NO = #{cntrNo}
          AND CNTR_SN = #{cntrSn}
    </insert>
    <update id="updateCntrChHist">
        UPDATE TB_SSCT_CNTR_CH_HIST
           SET HIST_END_DTM        = #{fnlMdfcDtm}      /* 이력종료일시 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE CNTR_NO = #{cntrNo}
           AND HIST_END_DTM = '99991231235959'
    </update>
    <insert id="insertCntrChHist">
        INSERT INTO TB_SSCT_CNTR_CH_HIST(
              CNTR_NO
             , HIST_STRT_DTM
             , HIST_END_DTM
             , CNTR_CST_NO
             , COPN_DV_CD
             , SELL_INFLW_CHNL_DTL_CD
             , SELL_OG_TP_CD
             , SELL_PRTNR_NO
             , CNTR_TP_CD
             , CNTR_NAT_CD
             , CNTR_PRGS_STAT_CD
             , CST_STLM_IN_MTH_CD
             , PRR_RCP_CNTR_YN
             , CNTR_TEMP_SAVE_DTM
             , CNTR_RCP_FSH_DTM
             , CNTR_STLM_FSH_DTM
             , CNTR_CNFM_APR_AK_DTM
             , CNTR_CNFM_APR_DTM
             , CNTR_CNFM_DTM
             , CNTR_CAN_DTM
             , CNTR_CAN_RSON_CD
             , CNTR_PRGS_STAT_MO_CN
             , DSB_GUR_TP_CD
             , CNTR_INFLW_PH_DV_CD
             , PSPC_CST_ID
             , CNTR_CH_RCP_ID
             , DCEVDN_DOC_ID
             , DTA_DL_YN
             <include refid="COMMON.insertSystemField"/>
        )
        SELECT CNTR_NO
             , #{fstRgstDtm}       /* 이력시작일시 */
             , '99991231235959'
             , CNTR_CST_NO
             , COPN_DV_CD
             , SELL_INFLW_CHNL_DTL_CD
             , SELL_OG_TP_CD
             , SELL_PRTNR_NO
             , CNTR_TP_CD
             , CNTR_NAT_CD
             , CNTR_PRGS_STAT_CD
             , CST_STLM_IN_MTH_CD
             , PRR_RCP_CNTR_YN
             , CNTR_TEMP_SAVE_DTM
             , CNTR_RCP_FSH_DTM
             , CNTR_STLM_FSH_DTM
             , CNTR_CNFM_APR_AK_DTM
             , CNTR_CNFM_APR_DTM
             , CNTR_CNFM_DTM
             , CNTR_CAN_DTM
             , CNTR_CAN_RSON_CD
             , CNTR_PRGS_STAT_MO_CN
             , DSB_GUR_TP_CD
             , CNTR_INFLW_PH_DV_CD
             , PSPC_CST_ID
             , CNTR_CH_RCP_ID
             , DCEVDN_DOC_ID
             , DTA_DL_YN
             , #{fstRgstDtm}
             , #{fstRgstUsrId}
             , #{fstRgstPrgId}
             , #{fstRgstDeptId}
             , #{fnlMdfcDtm}
             , #{fnlMdfcUsrId}
             , #{fnlMdfcPrgId}
             , #{fnlMdfcDeptId}
          FROM TB_SSCT_CNTR_BAS
         WHERE CNTR_NO = #{cntrNo}
    </insert>
    <update id="updateCntrChRcchHist">
        UPDATE TB_SSCT_CNTR_CH_RCCH_HIST /* 계약변경접수변경이력 */
           SET HIST_END_DTM = #{fnlMdfcDtm} /* 이력종료일시=현재일시 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND CNTR_CH_RCP_ID = #{cntrChRcpId} /* 계약변경접수ID */
           AND HIST_END_DTM = '99991231235959'
           AND DTA_DL_YN = 'N'
    </update>
    <insert id="insertCntrChRcchHist">
         INSERT INTO TB_SSCT_CNTR_CH_RCCH_HIST (  /* 계약변경접수변경이력 */
              CNTR_CH_RCP_ID       /* 계약변경접수ID */
            , HIST_STRT_DTM        /* 이력시작일시 */
            , HIST_END_DTM         /* 이력종료일시 */
            , CNTR_CH_RCP_DTM      /* 계약변경접수일시 */
            , CNTR_CH_TP_CD        /* 계약변경유형코드 */
            , CH_RQR_DV_CD         /* 변경요청자구분코드 */
            , CH_RQR_NM            /* 변경요청자명 */
            , CST_NO               /* 고객번호 */
            , CNTR_CH_AK_CN        /* 계약변경요청내용 */
            , CNTR_CH_PRGS_STAT_CD /* 계약변경진행상태코드 */
            , CNTR_CH_PRGS_MO_CN   /* 계약변경진행메모내용 */
            , CH_RCST_DV_CD        /* 변경접수자구분코드 */
            , CH_RCP_USR_ID        /* 변경접수사용자ID */
            , APR_DTM              /* 승인일시 */
            , APR_USR_ID           /* 승인사용자ID */
            , CNTR_CH_FSH_DTM      /* 계약변경완료일시 */
            , BIZ_TF_ID            /* 업무이관ID */
            , DTA_DL_YN            /* 데이터삭제여부 */
            <include refid="COMMON.insertSystemField" />)
         SELECT CNTR_CH_RCP_ID       /* 계약변경접수ID */
                , #{fstRgstDtm} AS HIST_STRT_DTM
                , '99991231235959'
                , CNTR_CH_RCP_DTM      /* 계약변경접수일시 */
                , CNTR_CH_TP_CD        /* 계약변경유형코드 */
                , CH_RQR_DV_CD         /* 변경요청자구분코드 */
                , CH_RQR_NM            /* 변경요청자명 */
                , CST_NO               /* 고객번호 */
                , CNTR_CH_AK_CN        /* 계약변경요청내용 */
                , CNTR_CH_PRGS_STAT_CD /* 계약변경진행상태코드 */
                , CNTR_CH_PRGS_MO_CN   /* 계약변경진행메모내용 */
                , CH_RCST_DV_CD        /* 변경접수자구분코드 */
                , CH_RCP_USR_ID        /* 변경접수사용자ID */
                , APR_DTM              /* 승인일시 */
                , APR_USR_ID           /* 승인사용자ID */
                , CNTR_CH_FSH_DTM      /* 계약변경완료일시 */
                , BIZ_TF_ID            /* 업무이관ID */
                , DTA_DL_YN            /* 데이터삭제여부 */
                , #{fstRgstDtm}
                , #{fstRgstUsrId}
                , #{fstRgstPrgId}
                , #{fstRgstDeptId}
                , #{fnlMdfcDtm}
                , #{fnlMdfcUsrId}
                , #{fnlMdfcPrgId}
                , #{fnlMdfcDeptId}
           FROM TB_SSCT_CNTR_CH_RCP_BAS
          WHERE CNTR_CH_RCP_ID = #{cntrChRcpId}
    </insert>
    <update id="updateCntrChRcpDchHist">
        UPDATE TB_SSCT_CNTR_CH_RCP_DCH_HIST /* 계약변경접수상세변경이력 */
           SET HIST_END_DTM = #{fnlMdfcDtm} /* 이력종료일시=현재일시 */
             , FNL_MDFC_DTM = #{fnlMdfcDtm}
             , FNL_MDFC_USR_ID = #{fnlMdfcUsrId}
             , FNL_MDFC_PRG_ID = #{fnlMdfcPrgId}
             , FNL_MDFC_DEPT_ID = #{fnlMdfcDeptId}
         WHERE 1 = 1
           AND CNTR_CH_RCP_ID = #{cntrChRcpId} /* 계약변경접수ID  */
           AND CNTR_CH_SN     = #{cntrChSn}   /* 계약변경일련번호 */
           AND HIST_END_DTM = '99991231235959'
           AND DTA_DL_YN = 'N'
    </update>
    <insert id="insertCntrChRcpDchHist">
        INSERT INTO TB_SSCT_CNTR_CH_RCP_DCH_HIST /* 계약변경접수상세변경이력 */
             ( CNTR_CH_RCP_ID /* 계약변경접수ID */
             , HIST_STRT_DTM /* 이력시작일시 */
             , CNTR_CH_SN /* 계약변경일련번호 */
             , HIST_END_DTM /* 이력종료일시 */
             , CNTR_UNIT_TP_CD /* 계약단위유형코드 */
             , CNTR_NO /* 계약번호 */
             , DTL_CNTR_NO /* 상세계약번호 */
             , DTL_CNTR_SN /* 상세계약일련번호 */
             , CNTR_CH_RSON_DV_CD /* 계약변경사유구분코드 */
             , CNTR_CH_RSON_CD /* 계약변경사유코드 */
             , CNTR_CH_ATC_DV_CD /* 계약변경항목구분코드 */
             , CH_APY_STRTDT /* 변경적용시작일자 */
             , CH_APY_ENDDT /* 변경적용종료일자 */
             , CH_PD_CD /* 변경상품코드 */
             , CH_QTY /* 변경수량 */
             , CH_AMT /* 변경금액 */
             , CH_PTRM_UNIT_CD /* 변경기간단위코드 */
             , CH_PTRM_N /* 변경기간수 */
             , CNTR_CH_AK_CN /* 계약변경요청내용 */
             , CNTR_ADRPC_ID /* 계약주소지ID */
             , CNTR_STLM_ID /* 계약결제ID */
             , PROCS_YN /* 처리여부 */
             , BFCH_CN /* 변경전내용 */
             , PROCS_DUEDT /* 처리예정일자 */
             , PROCS_FSH_DTM /* 처리완료일시 */
             , DTA_DL_YN /* 데이터삭제여부 */
             <include refid="COMMON.insertSystemField"/>
             )
        SELECT CNTR_CH_RCP_ID /* 계약변경접수ID */
             , #{fstRgstDtm} /* 이력시작일시 */
             , CNTR_CH_SN /* 계약변경일련번호 */
             , '99991231235959' /* 이력종료일시 */
             , CNTR_UNIT_TP_CD /* 계약단위유형코드 */
             , CNTR_NO /* 계약번호 */
             , DTL_CNTR_NO /* 상세계약번호 */
             , DTL_CNTR_SN /* 상세계약일련번호 */
             , CNTR_CH_RSON_DV_CD /* 계약변경사유구분코드 */
             , CNTR_CH_RSON_CD /* 계약변경사유코드 */
             , CNTR_CH_ATC_DV_CD /* 계약변경항목구분코드 */
             , CH_APY_STRTDT /* 변경적용시작일자 */
             , CH_APY_ENDDT /* 변경적용종료일자 */
             , CH_PD_CD /* 변경상품코드 */
             , CH_QTY /* 변경수량 */
             , CH_AMT /* 변경금액 */
             , CH_PTRM_UNIT_CD /* 변경기간단위코드 */
             , CH_PTRM_N /* 변경기간수 */
             , CNTR_CH_AK_CN /* 계약변경요청내용 */
             , CNTR_ADRPC_ID /* 계약주소지ID */
             , CNTR_STLM_ID /* 계약결제ID */
             , PROCS_YN /* 처리여부 */
             , BFCH_CN /* 변경전내용 */
             , PROCS_DUEDT /* 처리예정일자 */
             , PROCS_FSH_DTM /* 처리완료일시 */
             , DTA_DL_YN /* 데이터삭제여부 */
             , #{fstRgstDtm}
             , #{fstRgstUsrId}
             , #{fstRgstPrgId}
             , #{fstRgstDeptId}
             , #{fnlMdfcDtm}
             , #{fnlMdfcUsrId}
             , #{fnlMdfcPrgId}
             , #{fnlMdfcDeptId}
          FROM TB_SSCT_CNTR_CH_RCP_DTL /* 계약변경접수상세 */
         WHERE CNTR_CH_RCP_ID = #{cntrChRcpId} /* 계약변경접수ID = 입력받은 계약변경접수ID */
           AND CNTR_CH_SN     = #{cntrChSn}   /* 계약변경일련번호 */
    </insert>
</mapper>
