<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.common.mapper.WsnzHistoryMapper">
    <!-- TB_SVPD_CST_SVAS_IST_OJ_IZ -> TB_SVPD_CST_SVAS_IST_OJ_HIST -->
    <sql id="insertCstSvasIstOjHist">
        INSERT INTO TB_SVPD_CST_SVAS_IST_OJ_HIST (
               AS_IST_OJ_NO
             , HIST_CH_DTM
             , CNTR_NO
             , CNTR_SN
             , CNTR_CST_NO
             , IN_CHNL_DV_CD
             , SV_BIZ_HCLSF_CD
             , SV_BIZ_DCLSF_CD
             , RCP_SV_BIZ_DCLSF_CD
             , RCPDT
             , RCP_HH
             , URGT_YN
             , VST_RQDT
             , VST_AK_HH
             , CNSL_TP_HCLSF_CD
             , CNSL_TP_MCLSF_CD
             , CNSL_TP_LCLSF_CD
             , AS_REFRI_DV_CD
             , BFSVC_REFRI_DV_CD
             , SMS_FW_YN
             , DP_DV_CD
             , SV_ET_AMT
             , SV_CNR_OG_ID
             , MTR_STAT_CD
             , PD_CD
             , PD_GD_CD
             , PD_USWY_CD
             , CST_SV_ASN_NO
             , CNSL_MO_CN
             , CNSL_DTLP_TP_CD
             , AS_AK_DV_CD1
             , AS_AK_DV_CD2
             , ISTLL_KNM
             , ADR_DV_CD
             , IST_ADR
             , IST_DTL_ADR
             , DTA_DL_YN
             , FST_RGST_DTM
             , FST_RGST_USR_ID
             , FST_RGST_PRG_ID
             , FST_RGST_DEPT_ID
             , FNL_MDFC_DTM
             , FNL_MDFC_USR_ID
             , FNL_MDFC_PRG_ID
             , FNL_MDFC_DEPT_ID
        )
        SELECT AS_IST_OJ_NO
             , FNL_MDFC_DTM AS HIST_CH_DTM
             , CNTR_NO
             , CNTR_SN
             , CNTR_CST_NO
             , IN_CHNL_DV_CD
             , SV_BIZ_HCLSF_CD
             , SV_BIZ_DCLSF_CD
             , RCP_SV_BIZ_DCLSF_CD
             , RCPDT
             , RCP_HH
             , URGT_YN
             , VST_RQDT
             , VST_AK_HH
             , CNSL_TP_HCLSF_CD
             , CNSL_TP_MCLSF_CD
             , CNSL_TP_LCLSF_CD
             , AS_REFRI_DV_CD
             , BFSVC_REFRI_DV_CD
             , SMS_FW_YN
             , DP_DV_CD
             , SV_ET_AMT
             , SV_CNR_OG_ID
             , MTR_STAT_CD
             , PD_CD
             , PD_GD_CD
             , PD_USWY_CD
             , CST_SV_ASN_NO
             , CNSL_MO_CN
             , CNSL_DTLP_TP_CD
             , AS_AK_DV_CD1
             , AS_AK_DV_CD2
             , ISTLL_KNM
             , ADR_DV_CD
             , IST_ADR
             , IST_DTL_ADR
             , DTA_DL_YN
             , FST_RGST_DTM
             , FST_RGST_USR_ID
             , FST_RGST_PRG_ID
             , FST_RGST_DEPT_ID
             , FNL_MDFC_DTM
             , FNL_MDFC_USR_ID
             , FNL_MDFC_PRG_ID
             , FNL_MDFC_DEPT_ID
          FROM TB_SVPD_CST_SVAS_IST_OJ_IZ
         WHERE 1=1
    </sql>
    <insert id="insertCstSvasIstOjHistByPk">
        <include refid="insertCstSvasIstOjHist" />
        AND AS_IST_OJ_NO = #{asIstOjNo}
    </insert>

    <!-- TB_SVPD_CST_SVAS_IST_ASN_IZ -> TB_SVPD_CST_SVAS_IST_ASN_HIST -->
    <sql id="insertCstSvasIstAsnHist">
        INSERT INTO TB_SVPD_CST_SVAS_IST_ASN_HIST (
               CST_SV_ASN_NO
             , HIST_CH_DTM
             , CNTR_NO
             , CNTR_SN
             , CNTR_CST_NO
             , VST_CNFMDT
             , VST_CNFM_HH
             , BIL_AMT
             , LSTMM_CRDOVR_YN
             , VST_DUEDT
             , VST_EXP_HH
             , VST_TP_DV_CD
             , MNGR_DV_CD
             , SV_BIZ_HCLSF_CD
             , SV_BIZ_MCLSF_CD
             , SV_BIZ_DCLSF_CD
             , VST_CAN_RSON_CD
             , VST_OJ_LOCARA_CD
             , RERGN_DV_CD
             , ASN_GD_CD
             , MTR_STAT_CD
             , WK_INSTR_DV_CD
             , SV_CNR_OG_ID
             , SV_ASN_DV_CD
             , PRTNR_DSN_DT
             , EGER_ASN_DT
             , EGER_ASN_HH
             , EGER_PSTN_CD
             , EGER_RSB_CD
             , ICHR_OG_TP_CD
             , ICHR_PRTNR_NO
             , RGLVL_GD_CD
             , LOCARA_CHAOS_GD_CD
             , RPB_LOCARA_CD
             , SITE_AW_PD_GRP_CD
             , SITE_AW_SV_TP_CD
             , SITE_AW_ATC_CD
             , WK_ACPTE_STAT_CD
             , WK_ACPTE_DT
             , WK_ACPTE_HH
             , WK_REJ_RSON_CD
             , WK_REJ_ARBIT_DV_CD
             , WK_REJ_ARBIT_RSON_CD
             , WK_REJ_ARBIT_DT
             , WK_REJ_ARBIT_HH
             , DTM_CH_CAUS_CD
             , DTM_CH_RSON_CD
             , DTM_CH_RSON_DTL_CN
             , WK_GRP_CD
             , WK_PRGS_STAT_CD
             , WK_RS_ARBIT_DV_CD
             , WK_EXCN_DT
             , WK_EXCN_HH
             , WK_PRTNR_OG_TP_CD
             , WK_PRTNR_NO
             , ASN_TF_DV_CD
             , ARV_DT
             , ARV_HH
             , WK_CAN_RSON_CD
             , WK_CAN_MO_CN
             , DTA_DL_YN
             , FST_RGST_DTM
             , FST_RGST_USR_ID
             , FST_RGST_PRG_ID
             , FST_RGST_DEPT_ID
             , FNL_MDFC_DTM
             , FNL_MDFC_USR_ID
             , FNL_MDFC_PRG_ID
             , FNL_MDFC_DEPT_ID
        )
        SELECT CST_SV_ASN_NO
             , FNL_MDFC_DTM AS HIST_CH_DTM
             , CNTR_NO
             , CNTR_SN
             , CNTR_CST_NO
             , VST_CNFMDT
             , VST_CNFM_HH
             , BIL_AMT
             , LSTMM_CRDOVR_YN
             , VST_DUEDT
             , VST_EXP_HH
             , VST_TP_DV_CD
             , MNGR_DV_CD
             , SV_BIZ_HCLSF_CD
             , SV_BIZ_MCLSF_CD
             , SV_BIZ_DCLSF_CD
             , VST_CAN_RSON_CD
             , VST_OJ_LOCARA_CD
             , RERGN_DV_CD
             , ASN_GD_CD
             , MTR_STAT_CD
             , WK_INSTR_DV_CD
             , SV_CNR_OG_ID
             , SV_ASN_DV_CD
             , PRTNR_DSN_DT
             , EGER_ASN_DT
             , EGER_ASN_HH
             , EGER_PSTN_CD
             , EGER_RSB_CD
             , ICHR_OG_TP_CD
             , ICHR_PRTNR_NO
             , RGLVL_GD_CD
             , LOCARA_CHAOS_GD_CD
             , RPB_LOCARA_CD
             , SITE_AW_PD_GRP_CD
             , SITE_AW_SV_TP_CD
             , SITE_AW_ATC_CD
             , WK_ACPTE_STAT_CD
             , WK_ACPTE_DT
             , WK_ACPTE_HH
             , WK_REJ_RSON_CD
             , WK_REJ_ARBIT_DV_CD
             , WK_REJ_ARBIT_RSON_CD
             , WK_REJ_ARBIT_DT
             , WK_REJ_ARBIT_HH
             , DTM_CH_CAUS_CD
             , DTM_CH_RSON_CD
             , DTM_CH_RSON_DTL_CN
             , WK_GRP_CD
             , WK_PRGS_STAT_CD
             , WK_RS_ARBIT_DV_CD
             , WK_EXCN_DT
             , WK_EXCN_HH
             , WK_PRTNR_OG_TP_CD
             , WK_PRTNR_NO
             , ASN_TF_DV_CD
             , ARV_DT
             , ARV_HH
             , WK_CAN_RSON_CD
             , WK_CAN_MO_CN
             , DTA_DL_YN
             , FST_RGST_DTM
             , FST_RGST_USR_ID
             , FST_RGST_PRG_ID
             , FST_RGST_DEPT_ID
             , FNL_MDFC_DTM
             , FNL_MDFC_USR_ID
             , FNL_MDFC_PRG_ID
             , FNL_MDFC_DEPT_ID
          FROM TB_SVPD_CST_SVAS_IST_ASN_IZ
         WHERE 1=1
    </sql>
    <insert id="insertCstSvasIstAsnHistByPk">
        <include refid="insertCstSvasIstAsnHist" />
        AND CST_SV_ASN_NO = #{cstSvAsnNo}
    </insert>

    <!-- TB_SVPD_CST_SV_BFSVC_ASN_IZ -> TB_SVPD_CST_SV_BFSVC_ASN_HIST -->
    <sql id="insertCstSvBfsvcAsnHist">
        INSERT INTO TB_SVPD_CST_SV_BFSVC_ASN_HIST (
               BFSVC_EXCN_ASN_IZ_ID
             , CST_SV_ASN_NO
             , ASN_OJ_YM
             , CNTR_NO
             , CNTR_SN
             , SV_BIZ_MCLSF_CD
             , SV_BIZ_DCLSF_CD
             , WK_SN
             , ASN_PSIC_MNGT_DV_CD
             , ASN_PSIC_DV_CD
             , ASN_PSIC_PRTNR_OG_TP_CD
             , ASN_PSIC_PRTNR_NO
             , CNFM_PSIC_MNGT_DV_CD
             , CNFM_PSIC_ASN_DT
             , CNFM_PSIC_ASN_HH
             , CNFM_PSIC_DV_CD
             , CNFM_PSIC_PRTNR_OG_TP_CD
             , CNFM_PSIC_PRTNR_NO
             , EGER_PSTN_CD
             , EGER_RSB_CD
             , VST_CNFMDT
             , VST_CNFM_HH
             , VST_OJ_LOCARA_CD
             , MNGER_RGLVL_DV_CD
             , LSTMM_CRDOVR_YN
             , LSTMM_VST_CNFMDT
             , LSTMM_VST_CNFM_HH
             , VST_DUEDT
             , VST_EXP_HH
             , VST_PRGS_STAT_CD
             , WK_EXCN_DT
             , WK_CAN_RSON_CD
             , ASN_TF_DV_CD
             , SITE_AW_PD_GRP_CD
             , SITE_AW_SV_TP_CD
             , SITE_AW_ATC_CD
             , CST_CNTC_DT
             , CNTC_ICHR_PRTNR_OG_TP_CD
             , CNTC_ICHR_PRTNR_NO
             , CST_CNTC_CD
             , CST_CNTC_MO_CN
             , SPC_AS_TP_CD
             , HPCALL_FW_YN
             , ICHR_LOCARA_DV_CD
             , ARV_DT
             , ARV_HH
             , WK_GRP_CD
             , LOCARA_GD_CD
             , LOCARA_CHAOS_GD_CD
             , DTA_DL_YN
             , FST_RGST_DTM
             , FST_RGST_USR_ID
             , FST_RGST_PRG_ID
             , FST_RGST_DEPT_ID
             , FNL_MDFC_DTM
             , FNL_MDFC_USR_ID
             , FNL_MDFC_PRG_ID
             , FNL_MDFC_DEPT_ID
        )
        SELECT TO_CHAR(SYSDATE, 'YYYYMMDD') || LPAD(SQ_SVPD_CST_SV_BFSVC_ASN_HIST$BFSVC_EXCN_ASN_IZ_ID.NEXTVAL, 12, 0) AS BFSVC_EXCN_ASN_IZ_ID
             , CST_SV_ASN_NO
             , ASN_OJ_YM
             , CNTR_NO
             , CNTR_SN
             , SV_BIZ_MCLSF_CD
             , SV_BIZ_DCLSF_CD
             , WK_SN
             , ASN_PSIC_MNGT_DV_CD
             , ASN_PSIC_DV_CD
             , ASN_PSIC_PRTNR_OG_TP_CD
             , ASN_PSIC_PRTNR_NO
             , CNFM_PSIC_MNGT_DV_CD
             , CNFM_PSIC_ASN_DT
             , CNFM_PSIC_ASN_HH
             , CNFM_PSIC_DV_CD
             , CNFM_PSIC_PRTNR_OG_TP_CD
             , CNFM_PSIC_PRTNR_NO
             , EGER_PSTN_CD
             , EGER_RSB_CD
             , VST_CNFMDT
             , VST_CNFM_HH
             , VST_OJ_LOCARA_CD
             , MNGER_RGLVL_DV_CD
             , LSTMM_CRDOVR_YN
             , LSTMM_VST_CNFMDT
             , LSTMM_VST_CNFM_HH
             , VST_DUEDT
             , VST_EXP_HH
             , VST_PRGS_STAT_CD
             , WK_EXCN_DT
             , WK_CAN_RSON_CD
             , ASN_TF_DV_CD
             , SITE_AW_PD_GRP_CD
             , SITE_AW_SV_TP_CD
             , SITE_AW_ATC_CD
             , CST_CNTC_DT
             , CNTC_ICHR_PRTNR_OG_TP_CD
             , CNTC_ICHR_PRTNR_NO
             , CST_CNTC_CD
             , CST_CNTC_MO_CN
             , SPC_AS_TP_CD
             , HPCALL_FW_YN
             , ICHR_LOCARA_DV_CD
             , ARV_DT
             , ARV_HH
             , WK_GRP_CD
             , LOCARA_GD_CD
             , LOCARA_CHAOS_GD_CD
             , DTA_DL_YN
             , FST_RGST_DTM
             , FST_RGST_USR_ID
             , FST_RGST_PRG_ID
             , FST_RGST_DEPT_ID
             , FNL_MDFC_DTM
             , FNL_MDFC_USR_ID
             , FNL_MDFC_PRG_ID
             , FNL_MDFC_DEPT_ID
          FROM TB_SVPD_CST_SV_BFSVC_ASN_IZ
         WHERE 1=1
    </sql>
    <insert id="insertCstSvBfsvcAsnHistByPk">
        <include refid="insertCstSvBfsvcAsnHist" />
        AND CST_SV_ASN_NO = #{cstSvAsnNo}
    </insert>

    <!-- TB_SSCT_CNTR_DTL -> TB_SSCT_CNTR_DCH_HIST (insertCntrDchHist 후행필요) -->
    <update id="updateCntrDchHistByPk">
        UPDATE TB_SSCT_CNTR_DCH_HIST
           SET HIST_END_DTM = (SELECT FNL_MDFC_DTM
                                 FROM TB_SSCT_CNTR_DTL
                                WHERE CNTR_NO = #{cntrNo}
                                  AND CNTR_SN = #{cntrSn})
         WHERE CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
           AND HIST_STRT_DTM = (SELECT MAX(HIST_STRT_DTM)
                                  FROM TB_SSCT_CNTR_DCH_HIST
                                 WHERE CNTR_NO = #{cntrNo}
                                   AND CNTR_SN = #{cntrSn}
                                   AND HIST_END_DTM = '99991231235959')
           AND HIST_END_DTM = '99991231235959'
    </update>
    <!-- TB_SSCT_CNTR_DTL -> TB_SSCT_CNTR_DCH_HIST (updateCntrDchHist 선행필요) -->
    <insert id="insertCntrDchHistByPk">
        INSERT INTO TB_SSCT_CNTR_DCH_HIST (
               CNTR_NO
             , HIST_STRT_DTM
             , CNTR_SN
             , HIST_END_DTM
             , BASE_PD_CD
             , HGR_PD_CD
             , PD_QTY
             , STPL_PTRM_UNIT_CD
             , STPL_PTRM
             , ISTM_MCN
             , CNTR_PD_STRTDT
             , CNTR_PD_ENDDT
             , CNTR_DTL_STAT_CD
             , SELL_TP_CD
             , DSC_APY_TP_CD
             , DSC_APY_DTL_CD
             , DSC_APY_DRM_VAL
             , SV_PTRM_UNIT_CD
             , SV_PRD
             , CNTRW_TP_CD
             , BLG_CRP_CD
             , RVE_CRP_CD
             , CO_CD
             , BOO_SELL_TP_CD
             , PD_GD_CD
             , PD_HCLSF_ID
             , PD_MCLSF_ID
             , PD_LCLSF_ID
             , PD_DCLSF_ID
             , STLM_TP_CD
             , CRNCY_DV_CD
             , APY_EXCR
             , PD_BASE_AMT
             , FNL_AMT
             , VAT
             , SELL_AMT
             , CNTR_AMT
             , ISTM_PCAM_AMT
             , ISTM_INT_AMT
             , MM_ISTM_AMT
             , ACKMT_PERF_RT
             , ACKMT_PERF_AMT
             , CVT_PERF_AMT
             , SPP_DUEDT
             , RESUB_YN
             , RSTL_YN
             , FRISU_YN
             , FRISU_DSB_TP_CD
             , FEE_ACKMT_CT
             , FEE_ACKMT_BASE_AMT
             , FEE_FXAM_YN
             , TXINV_PBL_OJ_YN
             , SMTPL_ID
             , SMTPL_SN
             , BF_ORD_NO
             , CNTR_CH_RCP_ID
             , CNTR_CH_SN
             , CNTR_CH_DTL_AK_CN
             , DTA_DL_YN
             , FST_RGST_DTM
             , FST_RGST_USR_ID
             , FST_RGST_PRG_ID
             , FST_RGST_DEPT_ID
             , FNL_MDFC_DTM
             , FNL_MDFC_USR_ID
             , FNL_MDFC_PRG_ID
             , FNL_MDFC_DEPT_ID
        )
        SELECT CNTR_NO
             , FNL_MDFC_DTM AS HIST_STRT_DTM
             , CNTR_SN
             , '99991231235959' AS HIST_END_DTM
             , BASE_PD_CD
             , HGR_PD_CD
             , PD_QTY
             , STPL_PTRM_UNIT_CD
             , STPL_PTRM
             , ISTM_MCN
             , CNTR_PD_STRTDT
             , CNTR_PD_ENDDT
             , CNTR_DTL_STAT_CD
             , SELL_TP_CD
             , DSC_APY_TP_CD
             , DSC_APY_DTL_CD
             , DSC_APY_DRM_VAL
             , SV_PTRM_UNIT_CD
             , SV_PRD
             , CNTRW_TP_CD
             , BLG_CRP_CD
             , RVE_CRP_CD
             , CO_CD
             , BOO_SELL_TP_CD
             , PD_GD_CD
             , PD_HCLSF_ID
             , PD_MCLSF_ID
             , PD_LCLSF_ID
             , PD_DCLSF_ID
             , STLM_TP_CD
             , CRNCY_DV_CD
             , APY_EXCR
             , PD_BASE_AMT
             , FNL_AMT
             , VAT
             , SELL_AMT
             , CNTR_AMT
             , ISTM_PCAM_AMT
             , ISTM_INT_AMT
             , MM_ISTM_AMT
             , ACKMT_PERF_RT
             , ACKMT_PERF_AMT
             , CVT_PERF_AMT
             , SPP_DUEDT
             , RESUB_YN
             , RSTL_YN
             , FRISU_YN
             , FRISU_DSB_TP_CD
             , FEE_ACKMT_CT
             , FEE_ACKMT_BASE_AMT
             , FEE_FXAM_YN
             , TXINV_PBL_OJ_YN
             , SMTPL_ID
             , SMTPL_SN
             , BF_ORD_NO
             , CNTR_CH_RCP_ID
             , CNTR_CH_SN
             , CNTR_CH_DTL_AK_CN
             , DTA_DL_YN
             , FST_RGST_DTM
             , FST_RGST_USR_ID
             , FST_RGST_PRG_ID
             , FST_RGST_DEPT_ID
             , FNL_MDFC_DTM
             , FNL_MDFC_USR_ID
             , FNL_MDFC_PRG_ID
             , FNL_MDFC_DEPT_ID
          FROM TB_SSCT_CNTR_DTL
         WHERE CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
    </insert>

    <!-- TB_SSOP_CTT_BAS -> TB_SSOP_CTT_CH_HIST (insertCttChHistByPk 후행필요) -->
    <update id="updateCttChHistByPk">
        UPDATE TB_SSOP_CTT_CH_HIST
           SET HIST_END_DTM = (SELECT FNL_MDFC_DTM
                                 FROM TB_SSOP_CTT_BAS
                                WHERE CTT_OJ_ID = #{cttOjId})
         WHERE CTT_OJ_ID = #{cttOjId}
           AND HIST_STRT_DTM = (SELECT MAX(HIST_STRT_DTM)
                                  FROM TB_SSOP_CTT_CH_HIST
                                 WHERE CTT_OJ_ID = #{cttOjId}
                                   AND HIST_END_DTM = '99991231235959')
           AND HIST_END_DTM = '99991231235959'
    </update>
    <!-- TB_SSOP_CTT_BAS -> TB_SSOP_CTT_CH_HIST (updateCntrDchHistByPk 선행필요) -->
    <insert id="insertCttChHistByPk">
        INSERT INTO TB_SSOP_CTT_CH_HIST (
               CTT_OJ_ID
             , HIST_STRT_DTM
             , HIST_END_DTM
             , CST_NO
             , CTT_CHNL_TP_CD
             , CTT_TP_CD
             , CTT_AK_RSON_CD
             , CTT_SELL_TP_CD
             , CNTR_NO
             , CTT_PRGS_STAT_CD
             , CTT_RCP_DTM
             , CTT_FSH_DTM
             , UC_TOT_AMT
             , CTT_AOFFCE_CD
             , CTT_PSIC_ID
             , CTT_DUEDT
             , CTT_EXP_DV_CD
             , CTT_RS_CD
             , CTT_MO_CN
             , OTSD_LK_DRM_VAL
             , DTA_DL_YN
             , FST_RGST_DTM
             , FST_RGST_USR_ID
             , FST_RGST_PRG_ID
             , FST_RGST_DEPT_ID
             , FNL_MDFC_DTM
             , FNL_MDFC_USR_ID
             , FNL_MDFC_PRG_ID
             , FNL_MDFC_DEPT_ID
        )
        SELECT CTT_OJ_ID
             , FNL_MDFC_DTM AS HIST_STRT_DTM
             , '99991231235959' AS HIST_END_DTM
             , CST_NO
             , CTT_CHNL_TP_CD
             , CTT_TP_CD
             , CTT_AK_RSON_CD
             , CTT_SELL_TP_CD
             , CNTR_NO
             , CTT_PRGS_STAT_CD
             , CTT_RCP_DTM
             , CTT_FSH_DTM
             , UC_TOT_AMT
             , CTT_AOFFCE_CD
             , CTT_PSIC_ID
             , CTT_DUEDT
             , CTT_EXP_DV_CD
             , CTT_RS_CD
             , CTT_MO_CN
             , OTSD_LK_DRM_VAL
             , DTA_DL_YN
             , FST_RGST_DTM
             , FST_RGST_USR_ID
             , FST_RGST_PRG_ID
             , FST_RGST_DEPT_ID
             , FNL_MDFC_DTM
             , FNL_MDFC_USR_ID
             , FNL_MDFC_PRG_ID
             , FNL_MDFC_DEPT_ID
          FROM TB_SSOP_CTT_BAS
         WHERE CTT_OJ_ID = #{cttOjId}
    </insert>
</mapper>
